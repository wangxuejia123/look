(function(v,w,I,f,n){var o={};f.sortAllZoneModule=function(){v(".elemZoneModule").each(function(K,L){t(v(L))})};f.sortModuleZone=function(){t(v("#fk-webHeaderZone"));t(v("#fk-webBannerZone"));t(v("#fk-webFooterZone"));t(v(".fk-inBannerListZone"))};f.sortPackModule=function(){v(".J_packContent").each(function(K,L){t(v(L))})};f.sortOneZoneModule=function(K){var L=K.hasClass("elemZoneModule")?K:K.find(".elemZoneModule");if(L.length>0){t(L)}};f.destroySortOneZoneModule=function(K){var L=K.hasClass("elemZoneModule")?K:K.find(".elemZoneModule");if(L.length>0){L.sortable("destroy")}};f.changeZoneEditPrompt=function(K,L){p(K,L)};f.initAllPackAddModuleBtn=function(){v(".J_packContent, .J_popupZoneContent, .J_bottomFloatLayerContent").each(function(K,L){x(this)})};f.initAddModuleBtn=function(K){if(K.length>0){x(K)}};f.refreshZoneEditBtn=function(K){A(K)};f.removeZoneEditBtn=function(K){K.find(".J_zoneEditBtn").remove()};f.refreshFooterHeight=function(){C()};f.refreshFooterHeightForManage=function(K){C();Fai.top._footerStyleChanged++;Site.styleChanged();Site.setRefreshInfo("siteStyleSetting",true);Site.scrollToModuleDiv(K)};function t(O){var N=".elemZoneModule:visible:not(.J_popupZoneContent):not(.jz_elem_zone_no_connect), .J_moduleZone:visible, .column:visible, .J_packContent:visible, .formTabButtonList,.formTabButtonYList,.formTabContent,.fullmeasureContent:visible,.J_placeholderStyle";var K,L=false,M=O.hasClass("jz_elem_zone_no_connect");if(M||O.hasClass("J_popupZoneContent")||O.hasClass("J_subNavPack")){N=false}O.sortable("destroy");O.sortable({items:'.form:not(".fk_form_unsortable"), .J_tmp_form',cancel:'.formLockEdit, input, textarea, select, .fk_form_unsortable, embed[type="application/x-shockwave-flash"], object[type="application/x-shockwave-flash"], .addNewModule, .siteFormMiddle, .msgPanel_N, .msgAddText_N, .msgCaptcha_N, .msgAddButton_N',connectWith:N,distance:3,tolerance:"pointer",dropOnEmpty:true,scrollSensitivity:5,placeholder:"J_placeholder",zIndex:0,scroll:M?false:true,smartguides:".form:not(.moduleSortableHelper, .tmpForm):visible, #fk-webHeaderZone",containment:M?O:n,create:function(P,Q){},beforeStart:function(P,R){var Q=Site.checkNestModule(v(R.item));O.sortable("option","smartguides",".form:not(.moduleSortableHelper, .tmpForm):visible, #fk-webHeaderZone");if(w.getFrom()=="drag"){g(P,R,this)}else{if(Fai.top.dragToAddModule){O.sortable("option","smartguides","");J(P,R,this)}else{z(P,R,this)}}L=true;K=Site.undoGetElemInfo(v(R.item),"sort")},start:function(P,Q){if(v(Q.item).hasClass("formStyle97")||Site.isCartModule(v(Q.item))){if(v(Q.item).hasClass("formStyle97")){O.sortable("option","connectWith",".J_moduleZone:visible:not(.fk-inBannerListZone), .J_packContent:visible, .elemZone:visible:not(.fk-inBannerListZone)")}else{O.sortable("option","connectWith",".J_moduleZone:visible, .J_packContent:visible, .elemZone:visible")}}else{O.sortable("option","connectWith",N)}if(w.getFrom()=="drag"){}else{if(Fai.top.dragToAddModule){B(P,Q,this)}else{G(P,Q,this)}}if(M&&v(Q.item).hasClass("form")){Site.boundary.init(v(Q.item))}},over:function(P,Q){if(w.getFrom()=="drag"){}else{if(Fai.top.dragToAddModule){b(P,Q,this)}else{r(P,Q,this)}}},out:function(P,Q){if(w.getFrom()=="drag"){e(P,Q,this)}else{if(Fai.top.dragToAddModule){E(P,Q,this)}else{y(P,Q,this)}}},sort:function(P,Q){if(w.getFrom()=="drag"){d(P,Q,this)}else{if(Fai.top.dragToAddModule){D(P,Q,this)}else{q(P,Q,this)}}if(M&&v(Q.item).hasClass("form")){Site.boundary.refresh(v(Q.item))}},receive:function(P,Q){if(f.isZoneDisableModule(Q.item)){if(Fai.top.dragToAddModule){a(P,Q,this);Fai.ing("添加失败，容器内无法添加排版模块，请移动到其他位置",200)}else{Fai.ing("移动失败，容器内无法添加排版模块，请移动到其他位置",200)}Q.sender.sortable("cancel");A(this);Fai.top._cancelAdd=true;return}else{Fai.top._cancelAdd=false}if(w.getFrom()=="drag"){j(P,Q,this)}else{if(!Q.placeholder){return}if(Fai.top.dragToAddModule){a(P,Q,this)}else{s(P,Q,this)}}},update:function(P,Q){if(w.getFrom()=="drag"){}else{if(!Q.placeholder){return}}},beforeStop:function(P,Q){if(w.getFrom()=="drag"){}else{if(Fai.top.dragToAddModule){h(P,Q,this)}else{H(P,Q,this)}}v(".J_placeholder_stay_at_home").remove()},stop:function(P,X){var aa=Fai.top.$(".J_zoneEditTip:visible");if(aa.length>0&&!aa.parent().is(v(this))){return false}var Y=v("#bottomFloatLayerForms"),R=Y.find(".J_zoneEditTip:visible");if(R.length&&!Y.is(v(this))){return}var S=w.getReceiveParent(),Q=w.getReceiveId(),V,U,T=false,W,Z;if(w.getFrom()=="drag"){W=l(P,X,this)}else{if(!X.placeholder){return}if(Fai.top.dragToAddModule){return c(P,X,this)}else{T=true;Site.logDog(200084,1);W=F(P,X,this)}}if(L){var ab=Fai.top.sortSysModuleFail;Fai.top.sortSysModuleFail=false}if(L&&T&&W!==false){V=v.extend({},K),U=Site.undoGetElemInfo(v(X.item),"sort");Z=Site.checkNestModule(v(X.item));if(U&&K){if(Z.inTab&&U.parent&&(U.parent.hasClass("formTabButtonList")||U.parent.hasClass("formTabCntId"))){U.parent=U.parent.parent()}if(U.parent.hasClass("formTabCntId")){U.parent=U.parent.parent()}V.removeWrapPack=W=="needNewWrapPack";if(!ab){Site.undoRun(function(){},{type:"module",detail:"elemZoneSortStop",id:parseInt(v(X.item).attr("_moduleid")),undoSame:false,redoSame:false,undoFn:Fai.top._undo.moduleSortStopUndo,redoFn:Fai.top._undo.moduleSortStopUndo,undoArgs:[V],redoArgs:[U]})}}}if(W=="needNewWrapPack"){W=n}L=false;if(M&&v(X.item).hasClass("form")){Site.boundary.reset(v(X.item))}return W}})}function x(K){if(v(K).find(".J_packContent").length>0||v(K).hasClass("J_packContent")){k(K)}else{if(v(K).find(".J_popupZoneContent").length>0||v(K).hasClass("J_popupZoneContent")){i(K)}else{if(v(K).find(".J_bottomFloatLayerContent").length>0||v(K).hasClass("J_bottomFloatLayerContent")){k(K)}}}}function i(O){var M="",K=v(O).hasClass("elemZoneModule")?v(O):v(O).find(".elemZoneModule"),L="",N="";if(K.children(".J_zoneEditBtn").length>0){A(O);return}if(K.find(".form:visible").length>0){N="style='display:none;'"}M+="<div class='J_zoneEditBtn f-zoneEditBtn' "+N+">";M+="<div class='J_addContent f-addContent'>";M+="<span>拖动模块到这里<span>";M+="</div>";M+="</div>";K.append(M)}function k(O){var M="",K=v(O).hasClass("elemZoneModule")?v(O):v(O).find(".elemZoneModule"),L="",N="";if(K.length<1){return}if(K.children(".J_zoneEditBtn").length>0){A(O);return}addModuleEvent="jzUtils.run({'name':'goToFunPanel'}, 0);";if(K.find(".form").filter(function(){return this.style.display!="none"}).length>0){N="style='display:none;'"}L+="Fai.top._appendArea='"+K.attr("id")+"';";L+="Fai.top._appendModule=-1;";L+="Fai.top.choiceAppendLocation=1;";L+=addModuleEvent;if(!K.hasClass("jz_bottom_float_layer")){L+="Site.inFullmeasueAnimation.fmAddModuleStopCarousel("+K.attr("id").replace("elemZone","").replace("fk-packContent","")+");"}M+="<div class='J_zoneEditBtn f-zoneEditBtn' "+N+">";M+="<div class='J_addContent f-addContent'>";M+="<div class='f-addDiv' onclick=\""+L+'"></div>';M+="<div class='f-addText' onclick=\""+L+'"><span>容器内模块可以随意拖动哦<span></div>';M+="</div>";M+="</div>";K.append(M)}function A(L){var K=v(L).hasClass("elemZoneModule")?v(L):v(L).find(".J_packContent, .elemZoneModule, .J_bottomFloatLayerContent");if(K.children(".J_zoneEditBtn").length<1){k(L)}if(K.children(".form:not('.J_floatDragModuleHelper')").filter(function(){return this.style.display!="none"}).length>0){K.children(".J_zoneEditBtn").hide()}else{K.children(".J_zoneEditBtn").show()}}function z(K,Q,L){var M=v(Q.item),S=Site.checkNestModule(M),O=v(L),P=O.attr("id"),R;M.append("<div class='J_moduleOverlay fk-moduleOverlay'></div>");Site.disableEditLayer();Fai.stopInterval(null);Fai.top.$("body").disableSelection();Fai.top.$("#g_main").find(".J_placeholder").remove();Fai.top.$(".fillContentRelative").css("z-index","10");if(M.hasClass("formStyle32")){M.attr("_width",M.width())}v(".formTabCntId").sortable("option","disabled",true);v(".formTabCntId").children(".form").addClass("fk_form_unsortable");v(".formTab").sortable("option","disabled",true);v(".column .form, .floatForms .form, .absForms .form").each(function(){if(v(this).hasClass("formStyle35")){v(this).find(".form .formTab").removeClass("column")}});if(S.parentId>0){Site.setModuleAttrDataChange(S.parentId)}w.setOriginalParentId(P);w.setOriginalParent(O);w.setCloneHelper(Site.sortableHelper.cloneHelper(Q,K));w.setReceiveId(P);w.setReceiveParent(O);w.setOverParentId(P);w.setOverParent(O);w.setPrevModule(M.prevAll(".form").first());w.setFrom("elemZone");w.setWidth(M.width());w.setHeight(M.height());var N="<div class='jz_placeholder_stay_at_home J_placeholder_stay_at_home' style = 'width:100%;height:100%;'></div>";M.parent().append(N)}function G(L,M,N){var K;if(w.getOriginalParentId()==v(N).attr("id")){v(M.helper).show();w.getCloneHelper().hide()}else{v(M.helper).hide();w.getCloneHelper().show()}v(N).sortable("refresh");if(v(M.item).hasClass("formStyle79")&&!!Site.removeHoverEftDialog){K=v(M.item).attr("id");if(K){Site.removeHoverEftDialog(K.replace("module",""))}}}function r(O,P,Q){var L=v(Q),K=L.attr("id"),M=w.getOverParent();w.setOverParentId(K);w.setOverParent(L);p("over",Q,P.item);var L=v(Q);if(L.hasClass("J_packContent")){var N=v("#module"+L.attr("id").replace("fk-packContent",""));if(N.parent().hasClass("column")&&N.parent().children(".form").last().is(N)){v(".J_tmp_form").remove();N.after(v('<div class="f_tmp_form J_tmp_form"></div>'))}}}function y(M,N,O){p("out",O);A(O);if(w.getOriginalParentId()!=v(O).attr("id")){v(N.helper).hide();w.getCloneHelper()&&w.getCloneHelper().show();p("originZoneOut",O)}else{v(N.helper).show();w.getCloneHelper()&&w.getCloneHelper().hide()}var K=v(O);if(K.hasClass("J_packContent")){var L=v("#module"+K.attr("id").replace("fk-packContent",""));if(L.parent().hasClass("column")&&L.parent().children(".form").last().is(L)){v(".J_tmp_form").remove()}}}function D(K,L,M){p("sort",M,L.item);v(L.placeholder).show()}function q(K,T,N){v(".moduleSortableHelperWrap").show();Site.sortableHelper.cloneHelperMove(T);var X=v(T.placeholder).show();v(".J_placeholder_wrap").removeClass("J_placeholder_wrap jz_placeholder_wrap");X.parent().addClass("J_placeholder_wrap jz_placeholder_wrap");v(".J_placeholder").removeClass("jz_placeholder jz_placeholder_disabled");X.addClass("jz_placeholder");if(v(T.helper).hasClass("formStyle97")||Site.isCartModule(v(T.helper))||!Site.hasCommonForms()){var O=v(T.item),M=O.width(),Y=O.height(),Q=w.getOriginalParent(),L=Q.width(),V=Q.height(),Z=Q.offset().left,W=Q.offset().top,P=T.offset.left,R=T.offset.top,U=Site.checkNestModule(O);moduleMoveOffset=T.offset;if(w.getOriginalParentId()==w.getOverParentId()){if((P+M<Z)||(P>Z+L)||(R+Y<W)||(R>W+V)){w.getCloneHelper()&&w.getCloneHelper().show();if(!U.inPopupZone){p("originZoneOut",N)}return}else{v(T.helper).show();w.getCloneHelper()&&w.getCloneHelper().hide()}}else{v(T.helper).hide();w.getCloneHelper()&&w.getCloneHelper().show();p("originZoneOut",N)}}else{if(w.getOriginalParentId()==w.getOverParentId()){v(T.helper).show();w.getCloneHelper()&&w.getCloneHelper().hide()}else{v(T.helper).hide();w.getCloneHelper()&&w.getCloneHelper().show();p("originZoneOut",N)}}p("sort",N,T.item);S(T);v(container).sortable("refreshPositions");Site.move_formStyle97(v(T.helper),false);v(T.item).find(".ui-resizable-handle").show();Fai.top.$(".J_fkEditor_tool").hide();function S(ac){var ab=null,aa=null;if(v(ac.placeholder).parent().hasClass("formTabButtonList")||v(ac.placeholder).parent().hasClass("formTabButtonYList")){ab=v("#formTabContent"+v(ac.placeholder).parents(".form").attr("_moduleid"));ab=ab.find(".jz_placeholder_stay_at_home").length>0?ab.find(".jz_placeholder_stay_at_home"):ab}else{if(v(ac.placeholder).parent().hasClass("formTabContent")){ab=v("#formTabButtonList"+v(ac.placeholder).parents(".form").attr("_moduleid"))}}if(ab){ab.addClass("J_placeholder_wrap jz_placeholder_wrap");aa=ab.children(".J_placeholder__clone");if(!aa.length){v(".J_placeholder__clone").remove();aa=v(ac.placeholder).clone().addClass("J_placeholder__clone").appendTo(ab)}aa.addClass("jz_placeholder")}else{if(v(".J_placeholder__clone").length){v(".J_placeholder__clone").parent().removeClass("J_placeholder_wrap jz_placeholder_wrap");v(".J_placeholder__clone").remove()}}}}function s(L,T,N){var Q=v(N),R=Q.attr("id");w.setReceiveId(R);w.setReceiveParent(Q);w.setReceive("elemZone");if(Q.hasClass("J_moduleZone")){w.setReceiveDetail("moduleZone")}else{if(Q.hasClass("J_packContent")){w.setReceiveDetail("pack")}}var O=w.getOriginalParent();var U=O.hasClass("J_packContent");var V=O.hasClass("J_moduleZone");var P=O.hasClass("elemZone");if(U||V||P){}else{var S=v(T.item);var K=S.attr("_modulestyle");var M=Site.dragToAddModuleData.getWidth(K);w.setWidth(M)}}function H(L,M,N){var K=w.getCloneHelper();w.setStopOffset(K.offset());Site.sortableHelper.resetSortableHelper(M)}function F(aO,aA,aL){var O=v(aA.item),aa=O.parent(),az=parseInt(O.attr("id").replace("module","")),W=parseInt(O.attr("id").replace("module","")),ac=Site.checkNestModule(O),T=0,aB=0,ao,aN,al,aD,K=O.width(),N=O.height(),ay=w.getOriginalParent(),aG=ay.width(),aI=ay.height(),aC=ay.offset().left,ap=ay.offset().top,an=w.getReceiveParent(),am=w.getOriginalParentId(),aP=w.getReceiveId(),aw=an.width(),aF=an.height(),ar=w.getPrevModule(),ag=20,Z=false,S="formTabButtonList",aH,P,V,aq,ab=Site.checkNestModule(O);O.children(".J_moduleOverlay").remove();v(".J_placeholderContainer").removeClass("fk_placeholderContainer J_placeholderContainer");if(Site.isModule(O,[97,82])||!Site.hasCommonForms()){if(w.getOriginalParentId()==w.getOverParentId()){V=w.getStopOffset().left||moduleMoveOffset.left;aq=w.getStopOffset().top||moduleMoveOffset.top;if((V+K<aC)||(V>aC+aG)||(aq+N<ap)||(aq>ap+aI)){O.attr("id")&&Site.floatOut2(O.attr("id"),{dragBtn:n,notScroll:true});O.offset(w.getStopOffset());O.children(".J_moduleOverlay").remove();w.setOriginalParentId();p("reset",aL);Site.move_formStyle97(O);Site.enableEditLayer();Fai.top.$("body").enableSelection();Fai.startInterval(null);Site.refreshForms();v(".mulMColList").sortable("option","disabled",false);v(".mulMColList").addClass("column");v(".formTabCntId").sortable("option","disabled",false);v(".form").removeClass("fk_form_unsortable");v(".formTabButtonList").sortable("option","disabled",false);v(".formTabButtonYList").sortable("option","disabled",false);v(".formTabContent").sortable("option","disabled",false);v(".formTab").sortable("option","disabled",false);Fai.top.$(".fillContentRelative").css("z-index","-1");if(ab.inPopupZone){Site.protectZoneElemView(O)}return}}}v(".fullmeasureContent").each(function(aQ,aR){v(aR).find(".tmpForm").remove()});p("reset",aL);Site.enableEditLayer();Fai.top.$("body").enableSelection();Fai.startInterval(null);if(w.getReceiveDetail()=="moduleZone"&&Site.isSystemModule(O)){Fai.top.sortSysModuleFail=true;Fai.ing("系统模块不能拖入当前区域",true);O.show();w.reset();return false}var ae=O.attr("_global");if(ae=="true"){if(w.getReceiveParent().hasClass("fk-inBannerListZone")){Fai.top.sortSysModuleFail=true;Fai.ing("全站模块不支持拖进独立横幅内，可右键取消模块的全站设置后，再拖进横幅内。",true);O.show();w.reset();v(".mulMColList").sortable("option","disabled",false);v(".mulMColList").addClass("column");v(".formTabCntId").sortable("option","disabled",false);v(".form").removeClass("fk_form_unsortable");v(".formTabButtonList").sortable("option","disabled",false);v(".formTabButtonYList").sortable("option","disabled",false);v(".formTabContent").sortable("option","disabled",false);v(".formTab").sortable("option","disabled",false);Fai.top.$(".fillContentRelative").css("z-index","-1");v(".elemZoneModule").sortable("option","disabled",false);return false}}if(w.getReceiveDetail()=="pack"){A(an)}if(w.getFrom()=="elemZone"){A(ay)}if(w.getReceiveDetail()=="moduleZone"){an.append(O)}if(aa.hasClass("formTabButtonYList")){S="formTabButtonYList";Z=true}Site.refreshForms();al=Site.checkNestModule(O);aD=Fai.top.$("#module"+al.parentId);if((al.inTab||aa.hasClass(S))&&!aa.hasClass("formTabContent")){w.setReceive("column");var aj=O.index();var aM=aa.children(".formTabButton").length;if(aj>aM){aj=aM-1}if(aa.hasClass(S)){P=parseInt(aa.attr("id").replace("formTabButtonList",""))||P;O.attr("_intab",P);O.attr("_inmulmcol",0);O.attr("_infullmeasure",0);O.attr("_inpack",0);if(aj>0){Fai.top.$("#formTabContent"+P).children().eq((aj-1)).after(O)}else{Fai.top.$("#formTabContent"+P).prepend(O)}}var R=Site.getModuleTitle(O).replace(/<br\/>/,"");var X=O.attr("class").split(" "),ad,U=Site.isModule(O,[3,16,86]);for(var aK in X){if(/formStyle*/.test(X[aK])){ad=X[aK].substring(9)}}Fai.top.$("#formTabButton"+W).remove();var aE=[];aE.push("<div class='formTabButton' id='formTabButton"+W+"' tabModuleId='"+W+"' onclick='Site.changeLiCnt("+W+", "+U+", 29)'>");aE.push("<div class='formTabLeft'></div>");aE.push("<div class='formTabMiddle'>");if(Z){aE.push("<span class='tabButtonText'>")}aE.push(R);if(Z){aE.push("</span>")}aE.push("</div>");aE.push("<div class='formTabRight'></div>");if(Fai.top._uiMode||Fai.top._isTemplateVersion2){aE.push("<div class='tabItemTriangle'></div>")}aE.push("</div>");var av=Fai.top.$("#formTabButtonList"+P);if(aj>0){if(Fai.top._uiMode||Fai.top._isTemplateVersion2){aE.unshift("<div class='tabItemSep'><div class='commonTabItemSep'></div></div>")}av.children(".formTabButton").eq((aj-1)).after(aE.join(""))}else{if(Fai.top._uiMode||Fai.top._isTemplateVersion2){if(av.find(".formTabButton").length>0&&!av.children().first().hasClass("tabItemSep")){aE.push("<div class='tabItemSep'><div class='commonTabItemSep'></div></div>")}}av.prepend(aE.join(""))}if(av.hasClass("formTabButtonYList")&&av.find(".tabYListPlaceholder").length<1){av.append(v("<td class='tabYListPlaceholder'></td>"))}var aJ=200;var Q=top.$("#formTabContent"+W).children(".formTabCntId");if(Q.length>0){aJ=Q.first().height()}var ak="";if(aJ){ak=" style='height:"+aJ+"px !important;'"}if(!Fai.top.$("#module"+W).parent().hasClass("formTabCntId")&&!Fai.top.$("#module"+W).hasClass("formTabCntId")){Fai.top.$("#module"+W).wrap("<div class='formTabCntId' id='formTabCntId"+W+"'"+ak+"></div>")}Fai.top.Site.bindInTabSwitch();al=Site.checkNestModule(O);aD=Fai.top.$("#module"+al.parentId)}if(al.inTab){var Y=Site.getModuleAttrPattern(W).border;if(Y){Y.y=1;Site.hideModuleBorder(W)}}if(w.getOriginalParentId()==w.getReceiveId()){T=aA.position.top;aB=aA.position.left}else{ao=w.getStopOffset();aN=w.getReceiveParent().offset();T=ao.top-aN.top;aB=ao.left-aN.left}if(v.inArray(O.attr("_modulestyle"),["39","45","62","65","66"])>-1&&v.inArray(w.getReceive(),["moduleZone","pack"])>-1){Site.oneKeySetModuleTB(W,true);w.setHeight(O.height())}if(w.getReceive()=="column"||w.getReceive()=="fullmeasure"){O.removeAttr("style");Site.dockModuleResize(O);if(O.attr("_autoheight")>0){Site.autoModuleHeight(az)}if(al.inTab){O.removeClass("formInMulMCol formInZone").addClass("formInTab");Site.dockModuleResize(aD)}else{if(al.inCol){O.removeClass("formInTab formInZone").addClass("formInMulMCol");Site.dockModuleResize(aD)}else{if(al.inFullmeasure){O.removeClass("formInTab formInMulMCol formInZone");Site.inFullmeasueAnimation.refFillRelativeDivHeight(al.parentId)}else{if(al.inPack){O.removeClass("formInTab formInMulMCol formInZone")}}}}var at=aA.item;var au=at.parents(".form");if(au.length>0){au=au.eq(0)}var af=au.attr("id");if(au.hasClass("formStyle35")){if(at.hasClass("formStyle35")){Fai.ing("多列排版模块不能插入多列排版模块之中",true);w.reset();return false}}if(au.hasClass("formStyle29")){if(at.hasClass("formStyle35")){Fai.ing("多列排版模块不能插入标签模块之中",true);w.reset();return false}if(at.hasClass("formStyle29")){Fai.ing("标签模块不能插入标签模块之中",true);w.reset();return false}}if(at.hasClass("formStyle86")){Site.refreshSimpleEditor(at,at)}if(at.hasClass("formStyle32")){if(at.width()!=parseInt(at.attr("_width"))){at.find(".resize").each(function(){v(this).css({width:""});v(this).removeAttr("_width")});var ah=Site.getModuleAttr(W);ah.data.changed=true;Site.styleChanged()}}if(at.hasClass("formStyle75")){Site.fixMsgSubmitStyle(W)}if(at.hasClass("formStyle50")){Site.fixMsgBoardStyle(W)}if(at.hasClass("formStyle32")){Site.fixSiteFormDateRangeStyle(W)}if(v(aA.item).parent().hasClass("formTabContent")){var M=v(aA.item).parent().attr("id"),ai=parseInt(M.replace("formTabContent",""));Site.getModuleAttrData(ai).changed=true;Site.addModuleCallBackForTab(W,1,null,M,[],0,200);Fai.top.Site.bindInTabSwitch()}if(al.inTab){if(Fai.top.$("#module"+al.parentId).attr("_autoHeight")>0){Site.autoModuleHeight(al.parentId)}}}else{if(w.getReceiveDetail()=="moduleZone"){var ao=w.getStopOffset();var aN=w.getReceiveParent().offset();var T=ao.top-aN.top;var aB=ao.left-aN.left;var K=w.getWidth();var N=w.getHeight();Site.commPack.topModuleIndex(O);var an=w.getReceiveParent();var aw=an.width();var aF=an.height();p("reset",an);if(aB>=aw){aB=aw-K}else{if(aB<=(-K)){aB=0}}if(T>=aF){T=aF-N}else{if(T<=(-N)){T=0}}O.removeAttr("style");O.css({position:"absolute",top:T+"px",left:aB+"px",width:K+"px",height:N+"px"});if(O.attr("_modulestyle")==81){Site.adjustFlBtnPos(az)}f.resizeZoneOneModule(O);if(O.attr("_autoheight")>0){Site.autoModuleHeight(az)}if(al.inZone){O.removeClass("formInTab formInMulMCol").addClass("formInZone")}if(ac.parentId>0){Site.setModuleAttrDataChange(ac.parentId)}if(O.hasClass("formStyle97")){O.find(".mallHead").click()}}else{if(aB>=aw-ag){aB=aw-K}else{if(aB<=(-K)+ag){aB=0}}if(T>=aF){if(an.css("overflow")!=="scroll"&&an.css("overflow")!=="auto"){T=aF-N}}else{if(T<=(-N)+ag){T=0}}O.css({top:T+"px",left:aB+"px"});if(an.scrollTop()+an.height()<T){an.scrollTop(T)}if(am!=aP){Site.commPack.topModuleIndex(O)}else{if(ar&&ar.length>0){ar.after(O)}else{an.find(".J_zoneContentBg").after(O)}}if(O.hasClass("formStyle97")){var ax=O.attr("id").substring(6);v(".styleMall"+ax).show();O.find(".mallHead").click().click()}O.removeClass("formInTab formInMulMCol").addClass("formInZone");setTimeout(function(){Site.triggerGobalEvent("changeParentModuleHeightToAuto",{id:W})},0)}}if(ac.inPack){Site.commPack.resetPackModuleHeight(ac.parentId)}v(".mulMColList").sortable("option","disabled",false);v(".mulMColList").addClass("column");v(".formTabCntId").sortable("option","disabled",false);v(".form").removeClass("fk_form_unsortable");v(".formTabButtonList").sortable("option","disabled",false);v(".formTabButtonYList").sortable("option","disabled",false);v(".formTabContent").sortable("option","disabled",false);v(".formTab").sortable("option","disabled",false);Fai.top.$(".fillContentRelative").css("z-index","-1");v(".elemZoneModule").sortable("option","disabled",false);O.show();if(ac.parentId>0){Site.setModuleAttrDataChange(ac.parentId)}if(al.parentId>0){Site.setModuleAttrDataChange(al.parentId)}if(w.getReceive()=="fullmeasure"){Site.inFullmeasueModuleEdit.autoResetFullmeasureHeight(w.getReceiveParent().attr("moduleid"));Site.inFullmeasueModuleEdit.checkContentBgPlace(O)}if(w.getFrom()=="fullmeasure"){Site.inFullmeasueModuleEdit.autoResetFullmeasureHeight(w.getOriginalParent().attr("moduleid"))}if(w.getReceiveId()=="fk-webFooterZone"){f.refreshFooterHeightForManage(O)}Fai.top._moduleMoved++;Site.styleChanged();Site.moduleSizeChange(O.attr("id"));Fai.top.originSortable="";w.reset();var L=Site.moveSpecialModuleInNewPack(az,true);Site.moduleChangeParentCallback();Site.displayAddModule();return L?"needNewWrapPack":n}function p(K,O,M){var L=v(O);if(L.length<1){return}if(K=="over"){L.children(".J_zoneEditBtn").hide();var N=L.children(".J_placeholder")}else{if(K=="sort"){var N=L.children(".J_placeholder");if(N.length){v(".J_placeholder_wrap").removeClass("J_placeholder_wrap jz_placeholder_wrap");N.parent().addClass("J_placeholder_wrap jz_placeholder_wrap");v(".J_placeholder").removeClass("jz_placeholder jz_placeholder_disabled");N.addClass("jz_placeholder");if(f.isZoneDisableModule(v(M))||(Site.isSystemModule(v(M))&&v(O).hasClass("J_moduleZone"))){N.addClass("jz_placeholder_disabled")}}}else{if(K=="out"){A(O)}else{if(K=="originZoneOut"){}else{if(K=="reset"){A(O)}}}}}return}function J(M,N,O){var L=v(N.item),K,P;Fai.top.$("#g_main").find(".J_placeholder").remove();Site.disableEditLayer();Fai.stopInterval(null);Fai.top.$("body").disableSelection();Fai.top.dragInSortable=true;w.setOriginalParent(L)}function B(K,L,M){p("over",M,L.item)}function u(K){Fai.top._addModuleIcon&&Fai.top._addModuleIcon.draggable("option","connectToSortable",K);Fai.top._addModuleIcon&&Fai.top._addModuleIcon.draggable("refreshConnectToSortable");Fai.top.$(".elemZone:not("+K+")").each(function(){f.refreshZoneEditBtn(v(this))})}function m(K){Fai.top._addModuleIcon&&Fai.top._addModuleIcon.draggable("option","connectToSortable",".J_moduleZone:visible, .column:visible, .fullmeasureContent:visible, .J_packContent:visible, .formTabButtonList:visible, .formTabButtonYList:visible, .elemZoneModule:visible");Fai.top._addModuleIcon&&Fai.top._addModuleIcon.draggable("refreshConnectToSortable")}function b(M,N,O){if(v(O).hasClass("J_bottomFloatLayerContent")){u(".J_bottomFloatLayerContent")}p("over",O,N.item);var K=v(O);if(K.hasClass("J_packContent")){var L=v("#module"+K.attr("id").replace("fk-packContent",""));if(L.parent().hasClass("column")&&L.parent().children(".form").last().is(L)){v(".J_tmp_form").remove();L.after(v('<div class="f_tmp_form J_tmp_form"></div>'))}}}function E(M,N,O){if(v(O).hasClass("J_bottomFloatLayerContent")){m()}p("out",O);var K=v(O);if(K.hasClass("J_packContent")){var L=v("#module"+K.attr("id").replace("fk-packContent",""));if(L.parent().hasClass("column")&&L.parent().children(".form").last().is(L)){v(".J_tmp_form").remove()}}}function a(L,N,O){var M=v(O),K=M.attr("id");w.setReceiveId(K);w.setReceiveParent(M);w.setReceive("elemZone");if(M.hasClass("J_moduleZone")){w.setReceiveDetail("moduleZone")}else{if(M.hasClass("J_packContent")){w.setReceiveDetail("pack")}}}function h(K,L,M){w.setStopOffset(L.offset)}function c(L,P,M){var O,T,S;p("reset",M);if(!P.placeholder){return}v(".fullmeasureContent").each(function(V,W){O=v(W);T=O.data("_sortabletmpForm");S=O.data("_sortabletmpForm2");if(T){T.remove()}if(S){S.remove()}});Site.enableEditLayer();Fai.top.$("body").enableSelection();Fai.startInterval(null);v(".elemZoneModule").sortable("option","disabled",false);if(w.getReceive()!="elemZone"){return}Fai.top.addModule_insertBefore=false;Fai.top._appendModule=-1;Fai.top._appendArea=v(M).attr("id");Fai.top.draggableDiv_enable=false;var R=w.getStopOffset();var U=w.getReceiveParent().offset();var Q=w.getReceiveParent().scrollTop();var N=R.top-U.top+Q;var K=R.left-U.left;I.setPosition({top:N,left:K});w.reset()}function g(K,L,M){v(L.item).addClass("J_floatDragModuleHelper")}function e(K,L,M){p("out",M);v(L.helper).removeClass("fk-dragInZone");Site.floatData.reset()}function d(L,M,N){var K=v(M.item);if(K.hasClass("formStyle87")||K.hasClass("formStyle35")||K.hasClass("formStyle29")||K.hasClass("formStyle80")){return}p("over",N,M.item);v(M.helper).addClass("fk-dragInZone");Site.floatData.setDragIn("elemZone")}function j(L,N,O){var M=v(O),K=M.attr("id");w.setReceiveId(K);w.setReceiveParent(M);w.setReceive("elemZone");if(M.hasClass("J_moduleZone")){w.setReceiveDetail("moduleZone")}else{if(M.hasClass("J_packContent")){w.setReceiveDetail("pack")}}}function l(K,L,M){p("reset",M);v(L.item).remove();Site.moduleChangeParentCallback()}function C(){var W=0,K=Fai.top.$("#fk-webFooterZone").children(".form"),L=K.length,M=Fai.top.$("#webFooter"),Q=M.find(".footerContent"),T=M.height(),N=parseInt(Q.css("paddingBottom").replace("px")),P=Q.offset().top-M.offset().top,R=0,V=Fai.top.Site.getFooterStyleData(),U=V.f.t,S,O;if(U==1){return}if(L<1){V.f.d=0;Fai.top.Site.saveFooterStyleData(V);Fai.top._footerStyleChanged++;Site.styleChanged();Site.setRefreshInfo("siteStyleSetting",true);Fai.top.Fai.removeCtrlStyleCssList("stylefooter","footer",[{cls:".footerContent",key:"padding-bottom"}]);return}while(L){L-=1;O=K.eq(L);S=O.position().top+O.height();if(S>W){W=S}}R=W-T+N+P;if(R<0){R=0}V.f.d=-R;Fai.top.Site.saveFooterStyleData(V);Fai.top.Fai.setCtrlStyleCssList("stylefooter","footer",[{cls:".footerContent",key:"padding-bottom",value:R+"px"}])}})(jQuery,(Fai.top.Site&&Fai.top.Site.sortData)||Site.sortData,(Fai.top.Site&&Fai.top.Site.dragToAddModuleData)||Site.dragToAddModuleData,Fai.top._elemZone||(Fai.top._elemZone={}));(function(b,d,c){d.resizeAllZoneModule=function(){Site.resizeModule.prepare(Fai.top.$(".elemZoneModule").children(".form"))};d.resizeOneZoneModule=function(f){var e=f.hasClass("elemZoneModule")?f.children(".form"):f.find(".elemZoneModule").children(".form");e.each(function(g,h){a(b(h))})};d.resizeModuleZone=function(){var f=Fai.top.$("#fk-webHeaderZone, #fk-webBannerZone, #fk-webFooterZone, .fk-inBannerListZone").children(".form"),e=f.length;while(e){e-=1;a(f.eq(e))}};d.resizeZoneOneModule=function(e){a(e)};d.destroyResizeOneZoneModule=function(f){var e=f.hasClass("elemZoneModule")?f.children(".form"):f.find(".elemZoneModule").children(".form");e.each(function(g,h){b(h).resizable("destroy");b(h).children(".ui-resizable-cancelTip").remove()})};d.disableResizeOneZoneModule=function(f){var e=f.children(".form");e.each(function(g,h){b(h).resizable("destroy");b(h).children(".ui-resizable-cancelTip").remove()})};d.packChildrenDisableResizable=function(f){var e=f.hasClass("elemZoneModule")?f.children(".form"):f.find(".J_packContent").children(".form");e.each(function(g,h){b(h).resizable("destroy");b(h).children(".ui-resizable-cancelTip").remove()})};d.isZoneDisableModule=function(e){if(Site.isModule(e,[87,29,35])||e.hasClass("panelModuleIcon_pack")||e.hasClass("panelModuleIcon_tabHorizonal")||e.hasClass("moduleArea_tabVertical")||e.hasClass("panelModuleIcon_mulModuleCol")||Fai.top._matFactorySortModule){return true}return false};function a(e){Site.resizeModule.init(e)}})(jQuery,Fai.top._elemZone||(Fai.top._elemZone={}));(function(i,k,f){var j;k.initAlignLine=function(m){var l={showGap:2,inTopLine:false,inRightLine:false,inBottomLine:false,inLeftLine:false,initLevelLine:false,initVerticalLine:false,init:true,elem:null,helper:null,notElem:null,directionArr:["left","top","right","bottom","level","vertical"]};j=i.extend({},l,m);if(j.helper==null||j.elem==null){throw new Error("alignLine 参数错误")}e(j)};k.refreshAlignLine=function(){if(typeof j=="undefined"||j==null){throw new Error("alignLine 未初始化")}e(j)};k.resetAlignLine=function(){j=null;Fai.top.$("#absAlignTop, #absAlignRight, #absAlignBottom, #absAlignLeft, #absAlignLevel, #absAlignVertical").hide()};k.getModuleAutoHeight=function(l){return d(l)};k.addModuleResizeHandle=function(l){a(l)};function e(v){var s=v.elem,q=v.helper,m=v.notElem,n=v.directionArr,p=s.attr("id"),x=q[0].getBoundingClientRect(),o,r,w=v.callback||i.noop;var t=i(window),l=t.height(),u=t.width();o=Fai.top.$(".form, #g_main").filter(function(){var A=i(this),C=A.offset(),D=this.getBoundingClientRect(),B=D.height,F=D.width,G=C.top,E=G+B,z=C.left,y=F+z;if(this===q){return false}if(G>=l||E<=0||z>=u||y<=0){return false}if(i.inArray(i(this).attr("id"),m)>-1){return false}return true});x.level=(x.bottom+x.top)/2;x.vertical=(x.right+x.left)/2;Fai.top.$("#absAlignTop, #absAlignRight, #absAlignBottom, #absAlignLeft, #absAlignLevel, #absAlignVertical").hide();if(j.init){j.compareData=h(o)}g(x,j.compareData,q,s,n);j.init=false}function g(x,r,m,E,p){Fai.top.$("#absAlignTop, #absAlignRight, #absAlignBottom, #absAlignLeft, #absAlignLevelLine, #absAlignVerticalLine").css("opacity",1);var I=0,w=0,n=0,D=0,B=0,l=0,y=0,o=0,v=0,G=0,t=0,F=0,s=[x.left,x.right],H=[x.top,x.bottom],A=[x.left,x.right],u=[x.top,x.bottom];obtainLevel=[x.left,x.right],obtainVertical=[x.top,x.bottom];for(var C in r){var z=r[C];I=x.top-z.top;w=x.right-z.right;n=x.bottom-z.bottom;D=x.left-z.left;B=x.level-z.level;l=x.vertical-z.vertical;if(i.inArray("top",p)!=-1&&Math.abs(I)<j.showGap){y=z.top;s.push(z.left,z.right);j.inTopLine=true}if(i.inArray("right",p)!=-1&&Math.abs(w)<j.showGap){o=z.right;H.push(z.top,z.bottom);j.inRightLine=true}if(i.inArray("bottom",p)!=-1&&Math.abs(n)<j.showGap){v=z.bottom;A.push(z.left,z.right);j.inBottomLine=true}if(i.inArray("left",p)!=-1&&Math.abs(D)<j.showGap){G=z.left;u.push(z.top,z.bottom);j.inLeftLine=true}if(i.inArray("level",p)!=-1&&Math.abs(B)<j.showGap){t=z.level;obtainLevel.push(z.left,z.right);j.initLevelLine=true}if(i.inArray("vertical",p)!=-1&&Math.abs(l)<j.showGap){F=z.vertical;obtainVertical.push(z.top,z.bottom);j.initVerticalLine=true}}var q=false;if(E.hasClass("formStyle81")||E.hasClass("formStyle79")){q=true}if(j.inTopLine){c("top",s);b("Top",y);j.inTopLine=false}if(j.inRightLine){c("right",H);b("Right",o);j.inRightLine=false}if(j.inBottomLine){c("bottom",A);b("Bottom",v);j.inBottomLine=false}if(j.inLeftLine){c("left",u);b("Left",G);j.inLeftLine=false}if(j.initLevelLine){c("level",obtainLevel);b("Level",t);j.initLevelLine=false}if(j.initVerticalLine){c("vertical",obtainVertical);b("Vertical",F);j.initVerticalLine=false}}function h(n){var l={},m=Fai.top.$(window).height();n.each(function(){var q=i(this),o=q.attr("id"),p;if(o){p=q[0].getBoundingClientRect();p.level=(p.bottom+p.top)/2;p.vertical=(p.right+p.left)/2;l[o]=p;if(p.top>=m||p.bottom<=0){return true}}});return l}function c(n,o){var l=Math.min.apply(null,o),m=Math.max.apply(null,o);switch(n){case"top":Fai.top.$("#absAlignTop").css({left:(l-15)+"px",width:(m-l+30)+"px"});break;case"right":Fai.top.$("#absAlignRight").css({top:(l-15)+"px",height:(m-l+30)+"px"});break;case"bottom":Fai.top.$("#absAlignBottom").css({left:(l-15)+"px",width:(m-l+30)+"px"});break;case"left":Fai.top.$("#absAlignLeft").css({top:(l-15)+"px",height:(m-l+30)+"px"});break;case"level":Fai.top.$("#absAlignLevel").css({left:(l-15)+"px",width:(m-l+30)+"px"});break;case"vertical":Fai.top.$("#absAlignVertical").css({top:(l-15)+"px",height:(m-l+30)+"px"});break;default:}}function b(n,o){var l=Fai.top.$("body");if(l.find(".absAlign"+n).length<1){var m="<div id='absAlign"+n+"' class='absAlign"+n+"' ";switch(n){case"Top":case"Bottom":case"level":m+="style='top:"+o+"px;' ";break;case"Left":case"Right":case"vertical":m+="style='right:"+o+"px;' ";break;default:}m+="></div>";l.append(m)}else{switch(n){case"Top":l.find(".absAlign"+n).css({top:o+"px",display:"block"});break;case"Bottom":l.find(".absAlign"+n).css({top:(o-1)+"px",display:"block"});break;case"Left":l.find(".absAlign"+n).css({left:o+"px",display:"block"});break;case"Right":l.find(".absAlign"+n).css({left:(o-1)+"px",display:"block"});break;case"Level":l.find(".absAlign"+n).css({top:o+"px",display:"block"});break;case"Vertical":l.find(".absAlign"+n).css({left:o+"px",display:"block"});break;default:}}}function d(p){var q=p.find(".J_packContent").children(".form"),o=200,n=p.find(".J_packFormBanner"),m,l,r;for(m=0;m<q.length;m++){l=q.eq(m);r=l.position().top+l.outerHeight(true);if(r>o){o=r}}if(n.length>0&&n.is(":visible")){o+=n.height()}return o}function a(p){var n=Fai.top.$("#module"+p),l=n.height(),o=d(n),m=true;if(l>=o){return}if(n.children(".J_resizableTip").length>0){return}if(Site.getModuleStatus(p)!=1){m=false}if(m){n.append("<a href='javascript:;' class='J_resizableTip ui-resizable-cancelTip fk-resizable-cancelTip ui-resizable-cancelTip2 fk-resizable-cancelTip2' _faiscoTip='还原模块高度' onclick='Site.dockModuleAutoHeight("+p+");Site.changeParentModuleHeightToAuto("+p+");return false;'></a>")}else{n.append("<a href='javascript:;' class='J_resizableTip ui-resizable-cancelTip fk-resizable-cancelTip ui-resizable-cancelTip2 fk-resizable-cancelTip2' parentid='module"+p+"' _faiscoTip='还原模块默认高度' onclick='Site.absModuleAutoHeightDo("+p+");return false;'></a>")}}})(jQuery,Fai.top._elemZone||(Fai.top._elemZone={}));(function(b,c){c.dragAllZoneCell=function(){b(".elemZoneCell").each(function(d,e){a(b(e))})};c.dragOneZoneCell=function(e){var d=e.find(".elemZoneCell");if(d.length>0){a(d)}};c.destroyDragOneZoneCell=function(e){var d=e.find(".elemZoneCell");if(d.length>0){d.draggable("destroy")}};c.dragZoneOneCell=function(d){if(d.length>0){a(d)}};function a(d){d.draggable("destroy").draggable({containment:"parent",cursor:"move",axis:"x,y",scroll:false,distance:3,tolerance:2,smartguides:".form, .elemZoneCell",cancel:".elmeZoneCellNoDrag",start:function(){},stop:function(){}})}})($,Fai.top._elemZone||(Fai.top._elemZone={}));(function(b,c){c.resizeAllZoneCell=function(){b(".elemZone").find(".elemZoneCellResize").each(function(d,e){a(b(e))})};c.resizeOneZoneCell=function(e){var d=e.find(".elemZoneCellResize");if(d.length>0){a(d)}};c.destroyResizeOneZoneCell=function(e){var d=e.find(".elemZoneCellResize");if(d.length>0){d.resizable("destroy");d.children(".ui-resizable-cancelTip").remove()}};c.resizeZoneOneCell=function(d){if(d.length>0){a(d)}};function a(d){var e;d.resizable("destroy");d.resizable({helper:"ui-resizable-helper",handles:"n, e, s, w, se, sw, ne, nw",autoHide:true,smartguides:".form, .elemZoneCell",create:function(f,g){Site.addResizableExtHandles(b(this));Site.refreshResizableHandles(b(this));b(this).off("mouseenter.zoneLine").on("mouseenter.zoneLine",".ui-resizable-handle",function(){b(this).addClass("f-handleHover").siblings(".ui-resizable-handle").addClass("f-handleHover")});b(this).off("mouseleave.zoneLine").on("mouseleave.zoneLine",".ui-resizable-handle",function(){b(this).removeClass("f-handleHover").siblings(".ui-resizable-handle").removeClass("f-handleHover")})},start:function(f,g){Site.disableEditLayer();Fai.top.$("body").disableSelection();e=b("#dockTip").show()},resize:function(g,h){var f=b(".ui-resizable-helper");e.html("高度:"+f.height()+"<br/>宽度:"+f.width()).css({left:g.pageX-28,top:g.pageY+18})},stop:function(f,g){Site.protectZoneElemView(b(this));Site.refreshResizableHandles(b(this));Site.enableEditLayer();Fai.top.$("body").enableSelection();e.hide();Fai.top.$("#absAlignTop, #absAlignRight, #absAlignBottom,#absAlignLeft").hide();Site.styleChanged()}})}})($,Fai.top._elemZone||(Fai.top._elemZone={}));(function(l,d,m){d.selectToolAllZone=function(){l(".elemZone").each(function(){t(this)})};d.selectToolOneZone=function(F){var G=F.hasClass("elemZone")?F:F.find(".elemZone");if(G.length>0){G.each(function(){t(this)})}};d.destroySelectToolOneZone=function(F){var G=F.hasClass("elemZone")?F:F.find(".elemZone");if(G.length>0){G.each(function(){G.off(".mouseSelectable").off(".ctrlClickSelectable")});Fai.top.$(document).trigger("exitEditMode.selectable")}};d.selectToolModuleZone=function(){t(Fai.top.$("#fk-webBannerZone"));if(Fai.top._useBannerVersionTwo){t(Fai.top.$(".fk-inBannerListZone"))}else{t(Fai.top.$("#fk-webHeaderZone"))}t(Fai.top.$("#fk-webFooterZone"));e()};d.selectToolPackZone=function(){l(".J_packContent").each(function(){t(this)})};d.disableSelectable=function(F){var G=Fai.top.$(F);if(G.length<1){return}G.off(".mouseSelectable").off(".ctrlClickSelectable")};function e(){var F=Fai.top.$(document),G="#banner .J_bannerItem, #bannerGetHref";F.off("mousedown.selectable");if(!Fai.top._useBannerVersionTwo){if(l("#banner").length&&l("#banner").find(".J_bannerItem").length<1){G+=", #bannerGetHref, #banner "}F.on("mousedown.selectable",G,function(H){Fai.top.$("#fk-webBannerZone .fk-moduleZoneBg").trigger("mousedown.mouseSelectable",H)})}F.on("mousedown.selectable","#footer",function(H){if(l(H.target).is("a")||l(H.target).parent().is("a")){return}Fai.top.$("#fk-webFooterZone .fk-moduleZoneBg").trigger("mousedown.mouseSelectable",H)}).on("mousedown.selectable",".headerNav",function(H){if(l(H.target).is("a")||l(H.target).parent().is("a")||l(H.target).hasClass("ui-resizable-handle")){return}Fai.top.$("#fk-webHeaderZone .fk-moduleZoneBg").trigger("mousedown.mouseSelectable",H)})}function t(R){var N=Fai.top.$(R);if(N.length<1){return}var M=Fai.top.$(document);var J=N.attr("id").replace("elemZone","").replace("fk-packContent","");var I=N.attr("id").indexOf("Zone")>0?N:Fai.top.$("#module"+J);var G=new b();N.data("info",G);N.off(".mouseSelectable").on("mousedown.mouseSelectable",".J_zoneContentBg",function(ab,Y){if(Fai.top.Fai.isMozilla()){Fai.top.$("a.J_bannerItem").attr("ondragstart","return false")}var aa=false,X=null,Z=Y||ab,W=Z.clientX,U=Z.clientY,V=N.hasClass("J_moduleZone")?Fai.top.$(document):N;G.mat=[];V.on("mousemove.mouseSelectable",function(ac){var af=ac,ae=af.clientX,ad=af.clientY;if(!aa&&(Math.abs(ae-W)>3||Math.abs(ad-U)>3)){ab=Y||ab;L();X=new y(ab,N);G.init(N);G.zoneId=J;aa=true}if(!aa){return}X.change(ac);G.refresh(X.getConfig());o(G.all);i(G.mat,G.all);ac.stopPropagation();ac.preventDefault()});M.one("mouseup.mouseSelectable",function(ac){if(Fai.top.Fai.isMozilla()){Fai.top.$("a.J_bannerItem").attr("ondragstart","")}var ad=N.hasClass("J_moduleZone")?Fai.top.$(document):N;ad.off("mousemove.mouseSelectable");if(!aa){return}if(G.hasMat()){Site.logDog(100045,65);u(G.mat,G.all,N);Q();p(N)}else{H()}X.remove();X=null;Site.checkSimpleTextHideTool();ac.stopPropagation();ac.preventDefault();return false});N.off("click.mouseSelectable").on("click.mouseSelectable",function(ac){if(aa){ac.stopPropagation();ac.preventDefault()}})}).off(".ctrlClickSelectable").on("click.ctrlClickSelectable",".form, .elemZoneCell",function(U){if(!O(U)){return}if(l(this).find(".floatImg_noImg_J").length>0){return}Site.logDog(100045,65);Q();p(N);L();G.init(N);G.refresh(new y(U,N).remove().getConfig(),true);i(G.mat);u(G.mat,G.all,N);E(G.getElemInfo(l(this)),G.all)}).on("click.ctrlClickSelectable",".J_selectableMask",function(U){if(O(U)){G.refresh(new y(U,N).remove().getConfig(),true);i(G.mat);u(G.mat,G.all,N)}else{if(U.button==0){H()}}}).on("click.ctrlClickSelectable",".J_selectedArea",function(Z){if(!O(Z)){return}var Y=A(Z,N),aa=Y.left,X=Y.top;G.init(N);var U=[];l.each(G.all,function(ac,af){var ae=af.left+af.marginLeft,ab=af.right+af.marginLeft,ag=af.top+af.marginTop,ad=af.bottom+af.marginTop;if(aa>ae&&aa<ab&&X>ag&&X<ad){U.push(af)}});var V=U.sort(function(ac,ab){return ac.$elem.index()<ab.$elem.index()})[0];var W=G.mat.indexOf(V);if(W>-1){G.delMat(V);u(G.mat,G.all,N);h(V.$elem);if(G.mat.length<1){H()}}else{G.addMat(V);u(G.mat,G.all,N);E(V,G.all)}});if(N.hasClass("J_moduleZone")){e()}var T;function P(){T=T?T.show():Fai.top.$("<div class='fk-selectableMask J_selectableMask' style='width:"+N.width()+"px;height:"+N.height()+"px;'>").appendTo(N)}function Q(){Site.addModuleMask({id:J,realElem:I,callback:function(){Fai.top.$(".moduleMask-center").remove();var Y=parseInt(N.css("border-left-width")),X=parseInt(N.css("border-right-width")),W=parseInt(N.css("border-top-width")),ad=parseInt(N.css("border-bottom-width"));var V=Fai.top.$(".moduleMask-left");var ac=V.width()+Y;V.width(ac);var aa=Fai.top.$(".moduleMask-top");var U=aa.width()-Y-X;aa.height(aa.height()+W).width(U).css("left",ac+"px");var Z=Fai.top.$(".moduleMask-bottom");Z.height(Z.height()+ad).css("top",parseInt(Z.css("top"))-ad+"px").width(U).css("left",ac+"px");var ab=Fai.top.$(".moduleMask-right");ab.width(ab.width()+X).css("left",ac+U+"px")},extFn:[{name:"click",fn:H}]})}function K(){if(T){T.remove();T=null}Site.removeModuleMask()}function L(){S();M.off("mousewheel.selectwheel").on("mousewheel.selectwheel",function(U){setTimeout(function(){S()},200);U.preventDefault()}).off("keydown.selectwheel").on("keydown.selectwheel",function(U){if(U.keyCode==32||U.keyCode==9){U.preventDefault()}}).on("exitEditMode.selectable",H);P();N.off("contextmenu.selectable").on("contextmenu.selectable",function(U){U.stopPropagation()});M.find("body").addClass("fk-elemZone-unselect");Fai.top._selectableMode=true}function H(){F();M.off(".selectwheel").off("exitEditMode.selectable");K();N.off("contextmenu.selectable");M.find("body").removeClass("fk-elemZone-unselect");C(N);s(G.all);G.reset();d.resetAlignLine();Fai.top._selectableMode=false}function S(){Site.disableEditLayer();Fai.top.$("body").disableSelection()}function F(){Site.enableEditLayer();Fai.top.$("body").enableSelection()}function O(U){return U.ctrlKey&&U.button==0}}function A(I,L){var J=L.offset(),F=J.left,K=J.top,H=I.clientY-K,G=I.clientX-F;return{top:H,left:G}}function i(H){var I=0,F=H.length,G;for(;I<F;I++){G=H[I];E(G)}}function o(G){var F;for(form in G){F=G[form];h(F.$elem)}}function s(I){var G=0,F=I.length,H;for(;G<F;G++){H=I[G];f(H)}}function x(I){var G=0,F=I.length,H;for(;G<F;G++){H=I[G];j(H);E(H)}}function E(F){var G=F.$elem,H=G.find(">.J_selectedLineWrap");if(H.length<1){H=j(F)}G.css({overflow:"visible"});H.show()}function h(F){var G=F.find(">.J_selectedLineWrap");if(G.length<1){return}F.removeCss("overflow");G.hide()}function f(F){var G=F.$elem,H=G.find(">.J_selectedLineWrap");if(H.length<1){return}G.removeCss("overflow");H.remove()}function j(H){f(H);var I=H.$elem,K=I.find(">.J_selectedLineWrap"),M=parseInt(I.css("border-top-width"))||0,G=parseInt(I.css("border-left-width"))||0,J,L;var F=1;L=H;J=[];J.push("<div class='fk-selectedLineWrap J_selectedLineWrap' style='width:"+L.outerWidth+"px;height:"+L.outerHeight+"px;left:"+(-F-G)+"px;top:"+(-F-M)+"px;'>");J.push("</div>");return Fai.top.$(J.join("")).appendTo(I)}function u(V,P,Q){C(Q);if(V.length<1){return}var K=Q.data("info");var S=K.mat,M={},L=M.left=H("left",0)-1,R=M.top=H("top",0)-1,T=M.right=H("right",1)+1,G=M.bottom=H("bottom",1)+1,J=T-L,U=G-R,N,I;M.width=J;M.height=U;var O=1;L=M.left=L-O;R=M.top=R-O;M.right=T-O+2;M.bottom=G-O+2;if(K.hasInit){I=parseInt(Math.random()*10000);N=[];N.push("<div id='selectedAreaWrap"+I+"' class='fk-selectedAreaWrap J_selectedAreaWrap'>");N.push("    <div class='f-selectedArea J_selectedArea' style='width:"+J+"px;height:"+U+"px;left:"+(L-1)+"px;top:"+(R-1)+"px;'></div>");N.push("</div>");var F=Fai.top.$(N.join("")).appendTo(Q);F.find(".J_selectedArea").show();l.each(V,function(X,W){W.$elem.addClass("J_onSelected")})}B(V,P,Q,M);D(I,V,P,Q,M);r(Q,M);function H(X,W){return[Math.min,Math.max][W].apply(null,l.map(S,function(aa,Y){var Z={left:aa.marginLeft,right:aa.marginLeft,top:aa.marginTop,bottom:aa.marginTop};return aa[X]+Z[X]}))}}function C(G){var F=G.find(".J_selectedAreaWrap");G.find(".J_onSelected").removeClass("J_onSelected");F.off().remove();g(G);Fai.top.$(document).off("keydown.areaDrag")}function z(F,H,G){G.eachMat(function(J,I){I.left=I.left+F;I.top=I.top+H})}function D(Q,L,P,I,V){var M=Fai.top.$("#selectedAreaWrap"+Q);if(M.length<1){return}var U=M.find(".J_selectedArea"),F=I.find(".J_onSelected"),G=l(".J_selectedTool");var T=I.data("info"),H,J;var N=I.attr("id").replace("elemZone","").replace("fk-packContent","");N&&(T.zoneId=N);var O,W,S,K;U.draggable("destroy").draggable({tolerance:2,smartguides:".form:not(.J_onSelected), .elemZoneCell",scroll:false,start:function(Y,Z){var X=Z.position;O=X.left;W=X.top;G.hide();H=l.extend(true,[],T.mat);T.styleChanged()},drag:function(Z,ac){var X=ac.position,ab=X.left,aa=X.top,Y=ab-O,ad=aa-W;z(Y,ad,T);O=ab;W=aa},stop:function(Y,aa){V.left=aa.position.left;V.top=aa.position.top;V.right=V.left+V.width+2;V.bottom=V.top+V.height+2;r(I,V);c(V,I);Site.logDog(200084,2);Fai.top._moduleMoved++;var X=l.extend(true,[],T.mat),Z=l.extend(true,[],H);Site.undoRun(function(){},{type:"module.select",detail:"zoneSelectableDrag",undoSame:false,redoSame:false,undoFn:Fai.top._undo.zoneSelectMoveUndo,redoFn:Fai.top._undo.zoneSelectMoveUndo,undoArgs:[Z,T,I,u],redoArgs:[X,T,I,u]})}}).resizable("destroy").resizable({autoHide:false,handles:"n, e, s, w, se, sw, ne, nw",aspectRatio:false,create:function(){Site.resizeModule.customHandles(l(this))},start:function(X,Y){S=Y.size.width;K=Y.size.height;O=Y.position.left;W=Y.position.top;G.hide();T.eachMat(function(aa,Z){if(Z.style==82){return}Z.origWidth=Z.width;Z.origHeight=Z.height},function(aa,Z){if(Z.style==82){return}if(Z.style==79){var ab=Z.$elem;ab.find(".formMiddleContent").css("overflow","visible");ab.find(".formMiddleContent").css("overflow-y","visible");var ad=ab[0].id.slice(6),ac=l("#hoverEftDialog"+ad);if(ac.length>0&&!!Site.removeHoverEftDialog){Site.removeHoverEftDialog(ad)}}else{if(Z.style==81){}}});T.styleChanged();T.resetCopy();J=l.extend(true,[],T.mat)},resize:function(Y,ag){V.width=ag.size.width;V.height=ag.size.height;V.top=ag.position.top;V.left=ag.position.left;V.bottom=V.top+V.height;V.right=V.left+V.width;var ad=1;var ah=V.width-ad*2;var aa=V.height-ad*2;var ae=S-ad*2;var aj=K-ad*2;var ab=ah/ae;var af=aa/aj;var Z=V.left+3;var X=V.top+3;var ai=V.left-O;var ac=V.top-W;T.eachMat(function(al,ak){if(ak.style==82){return}if(ak.$elem.hasClass("elemZoneCell")&&!ak.$elem.hasClass("elemZoneCellResize")){return}ak.width=ak.outerWidth*(ah/ae)-ak.borderLeft-ak.borderRight;ak.height=ak.outerHeight*(aa/aj)-ak.borderTop-ak.borderBottom;ak.left=(ak.left+V.left-O-Z+ak.marginLeft)*(ah/ae)+Z-ak.marginLeft;ak.top=(ak.top+V.top-W-X+ak.marginTop)*(aa/aj)+X-ak.marginTop},function(al,ak){if(ak.style==82){return}var am=ak.$elem;if(ak.style==79){(function(){var at=ak.$elem;var ap=at.find(".formBanner"),aq=ap.is(":visible")?ap.height():0;at.find(".J_defImage, .floatImgWrap"+(at.find(".J_fonticon").length>0?"":", .forMargin")).css({width:ak.width,height:ak.height-aq});var ar=ak.width-1;var ao=ak.height;var an=ar>ao?ao:ar;if(at.find(".float_in_img").attr("class").indexOf("mr")!=-1&&ar<260){an=ar/2}at.find(".float_in_img").css({"font-size":an,"line-height":ao+"px"});at.find(".J_hoverImage").css({"font-size":an,"line-height":ao+"px"})})()}else{if(ak.style==81){(function(){var aq=ak.$elem;var at=aq.find(".floatBtn");var ao=2*parseInt(at.css("borderLeftWidth"))||0,an=at.height();var ar=["top","right","bottom","left"];Site.absAlignLine.resize.init(am,aq,Y,ar);var ap=aq.attr("id").replace("module","");Site.setModuleStyleCssList(ap,[{cls:".floatBtn",key:"width",value:(ak.width-ao)+"px"},{cls:".floatBtn",key:"height",value:(ak.height-ao)+"px"},{cls:".floatBtn",key:"line-height",value:an+"px"},])})()}else{if(ak.style==86){(function(){Site.refreshSimpleEditor(am,am);Fai.top.$(".J_fkEditor_tool").css("display","none")})()}else{(function(){am.find(".formMiddle").find(".formMiddleCenter").css("vertical-align","top");if(am.hasClass("formStyle35")||am.hasClass("formStyle29")){am.attr("_mousein",1)}if(am.hasClass("formStyle97")){var an=am.attr("id").substring(6);l(".styleMall"+an).hide()}})()}}}});S=ag.size.width;K=ag.size.height;O=ag.position.left;W=ag.position.top},stop:function(Y,aa){V.width=aa.size.width;V.height=aa.size.height;V.top=aa.position.top;V.left=aa.position.left;V.bottom=V.top+V.height;V.right=V.left+V.width;T.eachMat(function(ad,ac){if(ac.style==82){return}if(ac.$elem.hasClass("elemZoneCell")&&!ac.$elem.hasClass("elemZoneCellResize")){return}var af=ac.style;var ae=ac.$elem;var ah=ae[0];var ag=ac.$elem;if(af==79){(function(){var al=ac.$elem;var aj=al.attr("id").replace("module","");var ao=Site.checkNestModule(ag);Fai.top._moduleMoved++;Site.moduleSizeChange("module"+aj);al.trigger("Fai_onModuleSizeChange");if(al.find("map").length){Site.refreshFloatImgHotArea(modules)}if(ao.inPack){Site.setModuleAttrDataChange(ao.parentId)}Site.protectZoneElemView(al);setTimeout(function(){Site.triggerGobalEvent("changeParentModuleHeightToAuto",{id:aj})},0);var ai=al[0].id.slice(6);refreshHoverImgEft(ai,al.data("imgHoverEft"));if(Site.getModuleStatus(ai)==3){Site.refreshAbsFloatForm(al)}var aq=8;var am=ac.width;var an=ac.height;var ak=(parseInt(am)-aq)/2-2;var ap=(parseInt(an)-aq)/2-2;al.children(".ui-resizable-s").children(".imgResizeLine").css({width:ak+"px"});al.children(".ui-resizable-n").children(".imgResizeLine").css({width:ak+"px"});al.children(".ui-resizable-e").children(".imgResizeLine").css({height:ap+"px"});al.children(".ui-resizable-w").children(".imgResizeLine").css({height:ap+"px"})})()}else{if(af==81){(function(){var al=ag;var ao=al.find(".floatBtn");var am=Site.checkNestModule(ag);l(".draggableBtn").css({opacity:"1"});Site.enableEditLayer();var an=l("#dockTip");an.hide();var ak=al.attr("id").replace("module","");var aj=ao.height();Site.setModuleStyleCssList(ak,[{cls:".floatBtn",key:"line-height",value:aj+"px"},]);Site.getModuleAttrPattern(ak).changed=true;var ai=Site.getModuleAttrPattern(ak).floatBtn;ai.s=ai.s||{};ai.s.t=1;ai.s.w=parseInt(ao.width());ai.s.h=parseInt(ao.height());Fai.top._moduleMoved++;Site.setFlBtnModuleWidth(al);Site.styleChanged();Site.moduleSizeChange("module"+ak);al.trigger("Fai_onModuleSizeChange");Fai.top.$("#absAlignTop, #absAlignRight, #absAlignBottom,#absAlignLeft").hide();if(am.inPack){Site.setModuleAttrDataChange(am.parentId)}Site.protectZoneElemView(al);setTimeout(function(){Site.triggerGobalEvent("changeParentModuleHeightToAuto",{id:ak})},0)})()}else{if(af==86){if(ae.find(".J_resizableTip").length>0){ae.find(".J_resizableTip").show()}else{ae.append("<a href='javascript:;' class='J_resizableTip moduleAutoHeight ui-resizable-cancelTip fk-resizable-cancelTip' style='z-index:1000;' parentid='"+ae.attr("id")+"' _faiscoTip='还原模块默认高度' onclick='Site.absModuleAutoHeightDo("+ae.attr("id").replace("module","")+");return false;'></a>")}if(ae.find(".fk-editor-vertical-rl").length>0){ae.find(".fk-editor").attr("_autowidth",0)}Site.createSimpleTextAutoWidthBtn(ae);ab.apply(ac.$elem[0])}else{ab.apply(ac.$elem[0])}}}ac.$elem.attr("_autoheight",0);Site.refreshModuleHeight(ac.id);function ab(aj,ap){var al=l(this).attr("_moduleid");var aq=Site.checkNestModule(l(this));Site.protectZoneElemView(l(this));if(l(this).hasClass("formStyle35")||l(this).hasClass("formStyle29")){l(this).attr("_mousein",1)}if(!l(this).hasClass("elemZoneCell")){var ak=l(this).attr("id").replace("module","");if(l(this).children(".ui-resizable-cancelTip").length<1){var ao=l(this).find(".ui-resizable-se").css("z-index");var an="";if(l(this).hasClass("formStyle29")||l(this).hasClass("formStyle35")||l(this).hasClass("formStyle80")){an+=" ui-resizable-cancelTip2 fk-resizable-cancelTip2"}}Site.getModuleAttrPattern(ak).changed=true;Site.setModuleAttrDataChange(aq.parentId);var am=l(this).attr("_side");if(am!=2){Site.refreshAbsFloatForm(l(this))}Site.refreshSideBtn(l(this));Site.moduleSizeChange("module"+ak);if(l(this).hasClass("formStyle5")||l(this).hasClass("formStyle77")){Site.refreshModulePhotoSwitch(ak)}Site.triggerGobalEvent("resizableModuleChange",ak);Fai.top.$("#absAlignTop, #absAlignRight, #absAlignBottom,#absAlignLeft").hide();if(l(this).hasClass("formStyle83")){Site.initPhotoCard(ak)}if(l(this).hasClass("formStyle85")){Site.initPhotoNewCard(ak)}if(l(this).hasClass("formStyle98")){if(l(this).width()<=400){l(this).css("height",ac.origHeight+"px");l(this).css("width",ac.origWidth+"px");ac.height=ac.origHeight;ac.width=ac.origWidth}else{if(ac.origWidth!=l(this).width()){Site.initPhotoMoreCard(ak,ac.origWidth)}else{Site.initPhotoMoreCard(ak)}}}if(l(this).hasClass("formStyle97")){al=l(this).attr("_moduleid");l(this).find(".mallHead").click();l(".styleMall"+al).stop(true,true).show()}Site.triggerGobalEvent("changeParentModuleHeightToAuto",{id:al})}l(this).trigger("Fai_onModuleSizeChange");ai({module:l(this),parentId:aq.parentId});if(l(this).parent().hasClass("J_packContent")){Site.logDog(100092,0);Site.logDog(100092,6);Site.logDog(100045,64)}else{if(l(this).parent().hasClass("J_moduleZone")){Site.logDog(100092,0);Site.logDog(100092,7)}}Site.styleChanged();function ai(av){var at=av.module,aB=at.width(),ay=at.height(),aw=at.position(),ar=aw.left,au=aw.top,aC=Fai.top.$("#module"+av.parentId),aD=aC.width(),ax=aC.height(),aA=false,az=false;if(ar>=aD){ar=aD-aB;aA=true}else{if(ar<=(-aB)){ar=0;aA=true}}if(au>=ax){au=ax-ay;az=true}else{if(au<=(-ay)){au=0;az=true}}if(aA){at.css("left",ar+"px")}if(az){at.css("top",au+"px")}}}},function(ac,ab){if(ab.$elem.hasClass("elemZoneCell")){Site.refreshResizableHandles(ab.$elem)}});u(L,P,I);c(V,I);l(this).find(".ui-resizable-handle").show();var X=l.extend(true,[],T.mat),Z=l.extend(true,[],J);Site.undoRun(function(){},{type:"module.select",detail:"zoneSelectResizeStop",undoSame:false,redoSame:false,undoFn:Fai.top._undo.zoneSelectResizeUndo,redoFn:Fai.top._undo.zoneSelectResizeUndo,undoArgs:[Z,T,I,u],redoArgs:[X,T,I,u]})}}).off(".rh").on("hover.rh",function(){l(this).find(".ui-resizable-handle").show()});var R=false;Fai.top.$(document).off("keydown.areaDrag").on("keydown.areaDrag",function(ab){var af={37:1,38:1,39:1,40:1};if(!af[ab.which]){return}var Z=l.extend(true,[],T.mat);ab.preventDefault();var aa=U.position(),ad=aa.left,ac=aa.top,ae=0,Y=0;switch(ab.which){case 37:ae=-1;break;case 38:Y=-1;break;case 39:ae=1;break;case 40:Y=1;break;default:break}V.left=V.left+ae;V.right=V.right+ae;V.top=V.top+Y;V.bottom=V.bottom+Y;U.css({left:ad+ae,top:ac+Y});z(ae,Y,T);af=l.map(T.mat,function(ah,ag){return"#"+ah.elemZoneId}).join(",");af=Fai.top.$(af);var X=l.map(T.mat,function(ah,ag){return ah.elemZoneId});d.initAlignLine({elem:af,helper:af,notElem:X});d.refreshAlignLine({elem:af,helper:af});r(I,V);c(V,I);T.styleChanged();Site.logDog(200084,3);Fai.top._moduleMoved++;if(!R){R=true;Fai.top.$(document).off("keyup.areakey").one("keyup.areakey",function(){R=false;var ag=l.extend(true,[],T.mat);Site.undoRun(function(){},{type:"module.select",detail:"zoneSelectResizeStop",undoSame:false,redoSame:false,undoFn:Fai.top._undo.zoneSelectMoveUndo,redoFn:Fai.top._undo.zoneSelectMoveUndo,undoArgs:[Z,T,I,u],redoArgs:[ag,T,I,u]})})}})}function B(O,K,M,G){var H=l(".J_selectedTool"),J,N;if(H.length<1){N=I();J=L(N);var F=M.find(".J_selectedAreaWrap");H=Fai.top.$(J).appendTo("body");k(O,K,M,G);c(G,M)}return H;function I(){var P=[{toolType:"Align",toolList:[{toolFunc:"left",toolFuncName:"左对齐"},{toolFunc:"right",toolFuncName:"右对齐"},{toolFunc:"top",toolFuncName:"上对齐"},{toolFunc:"bottom",toolFuncName:"下对齐"},{toolFunc:"level",toolFuncName:"上下居中"},{toolFunc:"vertical",toolFuncName:"左右居中"}]},{toolType:"Spread",toolList:[{toolFunc:"vertical",toolFuncName:"垂直等距离"},{toolFunc:"level",toolFuncName:"水平等距离"}]}];if(M.hasClass("fk-webBannerZone")||(M.hasClass("fk-webFooterZone")&&!Fai.top._useFooterVersionTwo)){}else{P.push({toolType:"Copy",toolFunc:"copyAll"});P.push({toolType:"Delete",toolFunc:"deleteAll"})}return P}function L(U){var S=[];S.push("<div class='fk-selectedTool J_selectedTool'>");for(var R=0,Q;R<U.length;R++){Q=U[R];S.push("<div class='f-toolType f-tool"+Q.toolType+" J_toolType'>");if(Q.toolList&&Q.toolList.length){S.push("<div class='f-icon f-toolType-icon J_toolTypeIcon J_toolTypeIcon"+Q.toolType+"'></div>");S.push("<div class='f-toolType-wrap J_toolTypeWrap'>");S.push("<div class='f-wrap-cover'></div>");for(var P=0,T;P<Q.toolList.length;P++){T=Q.toolList[P];S.push("<div class='f-wrap-item' onclick='Fai.top._elemZone."+T.toolFunc+Q.toolType+"();'>");S.push("<div class='f-icon f-icon-"+T.toolFunc+"'></div>");S.push("<div class='f-text'>"+T.toolFuncName+"</div>");S.push("</div>")}S.push("</div>")}else{S.push("<div class='f-icon f-toolType-icon J_toolTypeIcon J_toolTypeIcon"+Q.toolType+"' onclick='Fai.top._elemZone."+Q.toolFunc+"();'></div>")}S.push("</div>")}S.push("</div>");return S.join("")}}function k(R,M,N,G){var P=l(".J_selectedTool");if(P.length<1){return}var F=N.data("info");P.find(".J_toolType").off("mouseenter.toggle, mouseleave.toggle").on("mouseenter.toggle, mouseleave.toggle",function(){var T=l(this),ac=T.find(".J_toolTypeIcon"),V=T.find(".J_toolTypeWrap"),X=R.length>1&&V.css("display")=="none";if(X){if(ac.hasClass("J_toolTypeIconSpread")&&R.length<3){return}V.show();var Y=T.offset();if(l("#bannerV2").find(V).length==0){V.css({left:(Y.left)+"px",top:(Y.top+36)+"px"})}if(N.attr("id")=="fk-webFooterZone"){var S=l(window).height(),U=T.outerHeight(),ab=S-Y.top-U,aa=V.outerHeight(),W,Z;if(ab<aa){W=V.position().top;Z=W-aa-U;V.css({top:Z+"px"});V.find(".f-wrap-cover").css({bottom:-2,top:"initial"})}else{V.find(".f-wrap-cover").css({bottom:"",top:""})}}ac.addClass("f-toolTypeIcon-show")}else{V.hide();ac.removeClass("f-toolTypeIcon-show")}});P.find(".J_toolTypeWrap").off("click.toggle").on("click.toggle",function(S){P.find(".J_toolTypeWrap").hide();P.find(".J_toolTypeIcon").removeClass("f-toolTypeIcon-show")});P.find(".J_toolTypeIcon").off("click.tip").on("click.tip",function(S){var T=l(this);if(T.hasClass("J_toolTypeIconAlign")){if(R.length<2){Fai.ing("圈选两个以上模块，才可以使用对齐功能",true)}}if(T.hasClass("J_toolTypeIconSpread")){if(R.length<3){Fai.ing("圈选三个以上模块，才可以使用等距离分布功能",true)}}});(function(){var T=P.find(".J_toolTypeIconAlign");if(R.length<2){T.css({cursor:"not-allowed"})}else{T.removeCss("cursor")}var S=P.find(".J_toolTypeIconSpread");if(R.length<3){S.css({cursor:"not-allowed"})}else{S.removeCss("cursor")}})();function L(T){var U=l.extend(true,[],F.mat);T();var S=l.extend(true,[],F.mat);Site.undoRun(function(){},{type:"module.select",detail:"zoneSelectResizeStop",undoSame:false,redoSame:false,undoFn:Fai.top._undo.zoneSelectMoveUndo,redoFn:Fai.top._undo.zoneSelectMoveUndo,undoArgs:[U,F,N,u],redoArgs:[S,F,N,u]})}d.leftAlign=function(){L(function(){a(1);F.eachMat(function(S,T){T.left=G.left+2-T.marginLeft});F.styleChanged();u(R,M,N);F.resetCopy()})};d.rightAlign=function(){L(function(){a(1);F.eachMat(function(S,T){T.left=G.right-2-T.outerWidth-T.marginLeft});F.styleChanged();u(R,M,N);F.resetCopy()})};d.topAlign=function(){L(function(){a(1);F.eachMat(function(S,T){T.top=G.top+2-T.marginTop});F.styleChanged();u(R,M,N);F.resetCopy()})};d.bottomAlign=function(){L(function(){a(1);F.eachMat(function(S,T){T.top=G.bottom-2-T.outerHeight-T.marginTop});F.styleChanged();u(R,M,N);F.resetCopy()})};d.verticalAlign=function(){L(function(){a(1);var S=(G.right+G.left)/2;F.eachMat(function(U,V){var T=(S-V.outerWidth/2)-V.marginLeft;V.left=T});F.styleChanged();u(R,M,N);F.resetCopy()})};d.levelAlign=function(){L(function(){a(1);var S=(G.bottom+G.top)/2;F.eachMat(function(U,V){var T=(S-V.outerHeight/2)-V.marginTop;V.top=T});F.styleChanged();u(R,M,N);F.resetCopy()})};d.levelSpread=function(){L(function(){a(2);Q(0);F.styleChanged();F.resetCopy()})};d.verticalSpread=function(){L(function(){a(2);Q(1);F.styleChanged();F.resetCopy()})};d.deleteAll=function(){a(0);if(F.mat.length>20){Fai.ing("已超过20个模块，不支持批量隐藏",true);Site.logDog(200334,22);return}Fai.ing("正在隐藏模块......");setTimeout(function(){Fai.top._delCount=F.mat.length;F.mat.forEach(function(S){Fai.top._delCount--;Site.hideModule(S.id,false,m,true)});F.styleChanged();l(document).trigger("exitEditMode.selectable")},0)};d.copyAll=function(){Site.logDog(200334,21);if(F.mat.length>20){Fai.ing("已经超过20个模块，不支持批量复制",true);Site.logDog(200334,23);return}var U=l(".J_selectedArea"),W=U.width(),ad=U.position().left,S=U.height(),V=U.position().top,ab=N.width(),T=N.height(),Y="",X=10,Z=0,ac=0;if(ab-W-ad>W+X){Y="right"}else{if(T-S-V>S+X){Y="bottom"}else{if(ad>W){Y="left"}else{if(V>T){Y="top"}else{if(ab>W+X&&T>S+X){Y="normal"}else{Y="same"}}}}}switch(Y){case"right":Z=W+X;break;case"bottom":ac=S+X;break;case"left":Z=-(W+X);break;case"top":ac=-(S+X);break;case"normal":Z=ac=X;break;case"same":default:Z=ac=0}var aa=[];F.mat.forEach(function(ae){aa.push(parseInt(ae.id))});F.mat.splice(0,F.mat.length);u(F.mat,F.all,N);s(F.all);Site.copyAllModule(aa,m,m,{extFunc:function(ag,ae){var ah=l("#module"+ag),af=l("#module"+ae),aj=ah.position().left,ai=ah.position().top;af.css({left:aj+Z+"px",top:ai+ac+"px"});F.addNewElem(af);if(F.mat.length==aa.length){F.mat.forEach(function(ak){ak.$elem.css("opacity","");Site.moduleAnimation.publishOne(ak.id)});i(F.mat);u(F.mat,F.all,N)}}})};function Q(Y){var W=[],S=[],U=true,X=0,Z=0;while(U){W=H(F.mat,Y);var X=J(W,K,Y);var T=X/(W.length-1);J(W,I,Y,T);U=false;for(var V=0;V<W.length;V++){if(W[V]!==S[V]){U=true}}if(Z!==X){U=true}S=W;Z=X}u(R,M,N)}function J(T,S){var W,U,V=[].slice.call(arguments,2);l.each(T,function(Y,X){if(Y==0){W=X;return}U=S.apply(X,[W,X,Y,U].concat(V));W=X});return U}function I(U,ae,S,T,W,X){var ad=["left","top"][W],ac=["right","bottom"][W],ab=["right","bottom"][W],aa=["outerWidth","outerHeight"][W],Z=["marginLeft","marginTop"][W],V,Y={};ae[ad]=(U[ac]+U[Z])+X-ae[Z];V=ae[ad];Y[ad]=V+"px";ae[ab]=V+ae[aa];ae.$elem.css(Y)}function K(V,aa,S,U,W){var Z=["left","top"][W],Y=["marginLeft","marginTop"][W],X=["right","bottom"][W];var T=(aa[Z]+aa[Y])-(V[X]+V[Y]);return(U||0)+T}function H(X,Y){var T=X.length,W;var V;var S=["left","top"][Y];var U=["marginLeft","marginTop"][Y];while(T>0){for(W=0;W<T-1;W++){if(X[W][S]+X[W][U]>X[W+1][S]+X[W+1][U]){V=X[W];X[W]=X[W+1];X[W+1]=V}}T--}return X}function O(T){var S=[];l.each(T,function(U,V){var W=V;S.push(W)});return S}}function c(F,K){var H=l(".J_selectedTool");var G=Fai.top.$(".J_selectedArea");if(H.length<1||G.length<1){return}var M=10,I=H.outerHeight(),J=F.left,N=F.top-M-I;J=J<0?0:J;if(N<0){N=F.bottom+M;N=N+I>K.find(".elemZone").height()?0:N}var L=K[0].getBoundingClientRect();N+=L.top;J+=L.left;H.css({left:J+"px",top:N+"px"}).show()}function w(F){var G=l(".J_selectedTool");if(G.length<1){return}G.hide()}function g(F){var G=l(".J_selectedTool");if(G.length<1){return}G.off().remove()}function r(J,F){var I=J.data("info");var H=J.width();var K=J.height();var G=Fai.top.$(".J_selectedArea");I.eachMat(function(N,M){var L=M.left<0&&(M.right+M.marginLeft*2)<10;var R=(H-M.left)<10;if(L||R){var O=0;if(L){O=-F.left}else{if(R){O=H-F.right}}var S=0;F.left=F.left+O;F.top=F.top+S;F.right=F.left+F.width;F.bottom=F.top+F.height;G.css(F);var Q=F.left,P=F.top;z(O,S,I);c(F,J);return false}});I.eachMat(function(M,L){var O=L.top<0&&(L.bottom+L.marginTop*2)<10;var P=(K-L.top)<10;if(O||P){var N=0;var Q=0;if(O){Q=-F.top}else{if(P){Q=K-F.bottom}}F.left=F.left+N;F.top=F.top+Q;F.right=F.left+F.width;F.bottom=F.top+F.height;G.css(F);z(N,Q,I);c(F,J);return false}})}function b(){this.all=[];this.mat=[];this.hasInit=false;this.copy=[]}b.prototype.reset=function(){var F=this;F.all.splice(0,F.all.length);F.mat.splice(0,F.mat.length);F.hasInit=false;F.resetCopy()};b.prototype.refresh=function(O,L){var T=this,J,I,G;var R=O.left,M=O.right,K=O.top,H=O.bottom;var Q=[];for(J=0,I=T.all.length;J<I;J++){var G=T.all[J],F=G.left,U=G.right,S=G.top,N=G.bottom;if(G.style==81){F+=G.marginLeft;U+=G.marginLeft;S+=G.marginTop;N+=G.marginTop}if(U<R||S>H||F>M||N<K){if(!L){T.delMat(G)}}else{if(L){Q.push(G)}else{T.addMat(G)}}}if(L){var P=Q.sort(function(W,V){return W.$elem.index()<V.$elem.index()})[0];T.addMat(P)}};b.prototype.delMat=function(F){var G=this;while(l.inArray(F,G.mat)>-1){G.mat.splice(l.inArray(F,G.mat),1)}};b.prototype.addMat=function(F){var G=this;if(l.inArray(F,G.mat)>-1){return}G.mat.push(F)};b.prototype.hasMat=function(){var F=this;return F.mat.length>0};b.prototype.addNewElem=function(G){var F=v.call(G);this.all.push(F);this.mat.push(F)};b.prototype.init=function(G){var F=this;if(!G){return}if(F.hasInit){return}G.find(">.form:visible, >.elemZoneCell:visible").each(function(){var H=v.call(this);F.all.push(H)});F.hasInit=true};b.prototype.getElemInfo=function(H){var G=this,I,F;for(I=0,F=G.all.length;I<F;I++){if(G.all[I].$elem.is(H)){return G.all[I]}}return null};b.prototype.eachMat=function(F,J){var H=this,M,G,L;for(M=0,G=H.mat.length;M<G;M++){L=H.mat[M];var K=F.apply(L.$elem[0],[M,L]);L.outerWidth=L.width+L.borderLeft+L.borderRight;L.outerHeight=L.height+L.borderTop+L.borderBottom;L.bottom=L.top+L.outerHeight;L.right=L.left+L.outerWidth;L.size.width=L.width;L.size.height=L.height;L.position.left=L.left;L.position.top=L.top;L.outerSize.width=L.outerWidth;L.outerSize.height=L.outerHeight;l.extend(L.config,L.size,L.position,{right:L.right,bottom:L.bottom});L.$elem.css(L.size).css(L.position).find(".J_selectedLineWrap").css(L.outerSize);if(typeof J=="function"){J.apply(L.$elem[0],[M,L])}}};b.prototype.styleChanged=function(F){var G=this;Site.getModuleAttrPattern(G.zoneId).changed=true;Site.getModuleAttrData(G.zoneId).changed=true;l.each(G.mat,function(I,H){var J=H.id;Site.getModuleAttrPattern(J).changed=true;Site.getModuleAttrData(J).changed=true});Site.styleChanged()};b.prototype.setCopy=function(F){var G=this;G.resetCopy();for(var H=0;H<G.mat.length;H++){G.copy.push(G.mat[H])}};b.prototype.resetCopy=function(F){var G=this;G.copy.splice(0,G.copy.length)};function v(){var P=l(this),U=P.attr("id"),J=P.attr("_moduleid"),Z=P.position(),L=Z.left,R=Z.top,V=P.width(),T=P.height(),F=P.outerWidth(),G=P.outerHeight(),H=+P.css("border-left-width").replace("px",""),K=+P.css("border-right-width").replace("px",""),S=+P.css("border-top-width").replace("px",""),O=+P.css("border-bottom-width").replace("px",""),W=+P.css("margin-left").replace("px",""),M=+P.css("margin-right").replace("px",""),I=+P.css("margin-top").replace("px",""),N=+P.css("margin-bottom").replace("px",""),Y=L+F,Q=R+G,X=P.attr("_modulestyle");return{left:L,top:R,width:V,height:T,right:Y,bottom:Q,size:{width:V,height:T},outerWidth:F,outerHeight:G,outerSize:{width:F,height:G},borderLeft:H,borderRight:K,borderTop:S,borderBottom:O,marginLeft:W,marginRight:M,marginTop:I,marginBottom:N,position:{left:L,top:R},config:l.extend({},this.size,this.position,{right:this.right,bottom:this.bottom}),style:X,"$elem":P,id:J||"elemCell",elemZoneId:U}}function y(H,G){var F=this;F.width=0;F.height=0;F.$wrap=Fai.top.$(G);F.fClass="fk-mouseSelectableTool";F.jClass="J_mouseSelectableTool";F._getMousePosition(H);F._update();F._create();return F}y.prototype._getMousePosition=function(J){var G=this;var K=G.$wrap.offset(),F=K.left,L=K.top,I=J.clientY-L,H=J.clientX-F;G.left=H;G.top=I;return G};y.prototype._update=function(){var F=this;F.right=F.left+F.width;F.bottom=F.top+F.height;F.size={width:F.width,height:F.height};F.position={left:F.left,top:F.top};F.config=l.extend({},F.size,F.position,{right:F.right,bottom:F.bottom});return F};y.prototype._create=function(){var F=this;F.oriLeft=F.left;F.oriTop=F.top;F.oriPosition={left:F.oriLeft,top:F.oriTop};Fai.top.$("."+F.jClass).remove();F.$elem=Fai.top.$("<div class='"+F.fClass+" "+F.jClass+"'></div>").appendTo(F.$wrap).css(F.oriPosition);return F};y.prototype.change=function(G){var F=this;F._getMousePosition(G);F.width=Math.abs(F.left-F.oriLeft);F.height=Math.abs(F.top-F.oriTop);if(F.left>F.oriLeft){F.left=F.left-F.width}if(F.top>F.oriTop){F.top=F.top-F.height}F._update();F.$elem.css(F.size).css(F.position);return F};y.prototype.remove=function(){var F=this;F.$elem.remove();F.$elem=null;F.$wrap=null;return F};y.prototype.getConfig=function(){var F=this;return l.extend({},F.config)};var q=function q(K){l.contextMenu({selector:".J_selectedArea",context:K,className:"fk-moduleContextMenu",classNames:{icon:"f-icon"},build:function(O,R){var Q=K.data("info");var P={};P.copy={html:"<div class='f-tip'></div><div>复制模块</div>",icon:"copy",name:"复制模块",usehtml:true,callback:F};P.sep="---";P.topIndex={html:"<div class='f-tip'></div><div>置于顶层</div>",icon:"topIndex",name:"置于顶层",usehtml:true,callback:L};P.bottomIndex={html:"<div class='f-tip'></div><div>置于底层</div>",icon:"bottomIndex",name:"置于底层",usehtml:true,callback:G};return{items:P}}});l.contextMenu({selector:".J_selectableMask",context:K,className:"fk-moduleContextMenu",classNames:{icon:"f-icon"},build:function(O,R){var Q=K.data("info");var P={};H.left=R.offsetX;H.top=R.offsetY;disableStyle=Q.copy.length?"":" f-isBottom";P.paste={html:"<div class='f-tip'></div><div>粘贴模块</div>",icon:"paste"+disableStyle,name:"粘贴模块",usehtml:true,callback:Q.copy.length?M:l.noop};return{items:P}}});var H={},N={},I={};function J(P){var O={};O.left=H.left+(I[P].left-N.left);O.top=H.top+(I[P].top-N.top);return O}function F(){var P=K.data("info");if(P.mat.length>20){Fai.ing("已超过20个模块，不支持批量复制",true);return}P.setCopy();I={};P.copy.forEach(function(Q){I[Q.id]={left:Q.left,top:Q.top}});var O=l(".J_selectedArea").position();N.left=O.left;N.top=O.top}function M(){var O=K.data("info");Fai.ing("正在复制模块......");O.mat.splice(0,O.mat.length);u(O.mat,O.all,K);s(O.all);Fai.top._pasteCount=O.copy.length;Fai.top._pasteFuncs=[];O.copy.forEach(function(P){Site.copyModule(P.id,Fai.top._colId,Fai.top._extId,2,P.style,{extFunc:J,callback:function(Q){O.addNewElem(Q);if(Fai.top._pasteCount<1){i(O.mat);u(O.mat,O.all,K);E(O.getElemInfo(l(Q)),O.all);Fai.ing("复制成功",true)}}})})}function L(){var T=K.data("info");var R=n(T.mat),Q=R.length,P=R[Q-1],O=P.nextAll(".form"),S;if(O.length){S=O.last();R.slice().reverse().forEach(function(U){S.after(U)})}else{R.slice(0,Q-1).forEach(function(U){P.before(U)})}}function G(){var T=K.data("info");var R=n(T.mat),Q=R.length,P=R[0],O=P.prevAll(".form"),S;if(O.length){S=O.last();R.slice().forEach(function(U){S.before(U)})}else{R.slice(1).reverse().forEach(function(U){P.after(U)})}}};function n(F){return F.map(function(G){return G.$elem}).sort(function(H,G){return H.index()>G.index()})}function p(F){var H={"fk-webHeaderZone":6,"fk-webFooterZone":7,J_packContent:8,J_popupZoneContent:9,"fk-inBannerListZone":18,J_subNavPack:20,J_bottomFloatLayerContent:24};for(var G in H){if(F.hasClass(G)){Site.logDog(200334,H[G]);break}}}function a(G){var F=[15,16,17];Site.logDog(200334,F[G])}})(jQuery,Fai.top._elemZone||(Fai.top._elemZone={}));(function(e,d,a,c){function g(){c.sortAllZoneModule();c.resizeAllZoneModule();c.dragAllZoneCell();c.resizeAllZoneCell();c.selectToolAllZone();c.initAllPackAddModuleBtn()}function f(h){c.sortOneZoneModule(h);c.resizeOneZoneModule(h);c.dragOneZoneCell(h);c.resizeOneZoneCell(h);c.selectToolOneZone(h);c.initAddModuleBtn(h)}function b(h){c.destroySortOneZoneModule(h);c.destroyResizeOneZoneModule(h);c.destroyDragOneZoneCell(h);c.destroyResizeOneZoneCell(h);c.destroySelectToolOneZone(h);c.removeZoneEditBtn(h)}c.init=function(){g()};c.initOne=function(h){f(h)};c.destroyOne=function(h){b(h)}})($,Fai,Site,Fai.top._elemZone||(Fai.top._elemZone={}));