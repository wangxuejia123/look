(function(M,Z,f,ak,p){var g=ak,ar=g.top.Site,ag=Z.getSelection?false:true,v=navigator.userAgent.toLowerCase(),G=v.indexOf("se")>-1,x=v.indexOf("firefox")>-1,S=v.indexOf("opera")>-1,Q=/applewebkit/.test(v)&&/chrome/.test(v)&&parseFloat(v.match(/ chrome\/(\d+)/)[1])>=58,R="",K="unselectable",am=ag?((f.selection&&f.selection.createRange&&f.selection.type!="None")?f.selection.createRange():p):Z.getSelection(),u={ModuleId:"moduleId",OuterFun:"outerFun",Option:"option",Editor:"editor",LinkHasClick:"linkHasClick",SignClassNum:"scn",HasRsChildStyle:"hrcs",Range:"range",NotCreateNewNode:"ncnn",SimpleTextEdit:"simpleTextEdit",HasSelectText:"hst",ClearSpanCursoring:"cscs",OldVHeight:"ovht",OldHwidth:"ohwt",HoverToolOn:"hoverToolOn",FloatImg:"floatImg",HoverToolTimeout:"htto",EditLineTimeout:"etto",SignClassNum:"signClassNum",SetPageChange:"spce",HasRemoveUselessChild:"rucsc",RemoveUselessChildIng:"rucscing",PreScrollHeight:"psht",ChangeCount:"changeCount",ScrollChangeChecking:"sccg",FirstChooseEditor:"fcet",PreHtmlContent:"phct",Onfocused:"onfocused",Mousedown:"mousedown",Mousemove:"mousemove",FixRight:"fixRight",ScreenX:"screenX",ScreenY:"screenY",HasRefreshClick:"hrfc",PreModuleHeight:"pmheight",PreCommand:"preCommand",SelectedInputBlur:"sib",TriggerClick:"ectc",EndCheckClass:"endCheckClass",EditSignClass:"editSignClass",EditorEventBind:"editorEventBind",BackPreColor:"bpcolor",PreHasText:"preHasText"},X={Contenteditable:"contenteditable",Emphasis:"emphasis"};ToolAttr={Scrolling:"scll",ScrollingMousedown:"scllmdn"},BtnCommand={EditContent:"editContent",EditPositionFixed:"positionFixed",EditLogoDisplay:"logoDisplay",GlobalLink:"globalLink",BorderRadius:"borderRadius",Opacity:"opacity",Border:"border",Shadow:"shadow",Radius:"radius",Delete:"delete",FontSize:"fSize",LineHeight:"lineHeight",Animation:"animation",BtnModuleStyle:"btnModuleStyle",EditPhotoBtn:"editPhotoBtn",EditFixedBtn:"editFixedBtn",ImgEffectBtn:"imgEffectBtn",PhotoShapeBtn:"photoShapeBtn",SimpleLinkBtn:"simpleLinkBtn",ModuleTitleBtn:"moduleTitleBtn",DescribePicBtn:"describePicBtn",Linkcreator:"linkcreator",Formats:"formats",Colors:"colors",Removeformat:"removeformat",TextAlign:"textAlign",JustifyLeft:"justifyLeft",JustifyCenter:"justifyCenter",JustifyRight:"justifyRight",JustifyFull:"justifyFull",WritingMode:"writingMode",Bold:"Bold",Italic:"Italic",Underline:"Underline",Unlink:"Unlink",Createlink:"Createlink",SingleClick:"singleClick",Dblclick:"dblclick",InputFontSize:"inputFontSize",InputLineHeight:"inputLineHeight",ChooseFormats:"chooseFormats",ChooseLineHeight:"chooseLineHeight",ChooseFontSize:"chooseFontSize",DeleteLink:"deleteLink"};ar.simpleTextList={allEditors:[],chooseEditor:{},colorToolShow:false,checking:false};if(/msie/.test(v)){R="-ms-"}else{if(/chrome/.test(v)||/safari/.test(v)||/yandex/.test(v)){R="-webkit-"}else{if(x){R="-moz-"}else{if(S){R="-o-"}else{if(/konqueror/.test(v)){R="-khtml-"}else{R=""}}}}}var ap,an,i,P,ae,ab,B;var F=function(){this.constructor.prototype.extend=function(av,au){for(var at in au){if(!(at in au.constructor.prototype)){av[at]=au[at]}}for(var at in au.constructor.prototype){av.constructor.prototype[at]=au[at]}}};ap=new F();var C=function(){this.constructor.prototype.test=function(){return true}};an=new C();var e=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ax=this;ax.constructor.prototype.removeParentUselessNode=function(aB){var aD=aB.element,aC=aB.styleName,az=aB.styleValue,aA=aB.endCheckClass;if(typeof(aD.parent())==p){return av}var ay=aD.parent();if(ay.hasClass(aA)){return av}if(aD.text().length==ay.text().length){ay.css(aC,"");aB.element=ay;ax.removeParentUselessNode(aB)}return av};ax.constructor.prototype.changeChildStyle=function(aA){var aD=aA.element,aC=aA.styleName,ay=aA.styleValue;if(typeof(aD.children)==p){return av}for(var aB=0;aB<aD.children().length;aB++){var az=aD.children().eq(aB);az.css(aC,"");aA.element=az;ax.changeChildStyle(aA)}return av};ax.constructor.prototype.setElementStyleEffectAll=function(aB){var aD=aB.element,aA=aB.effectElement,aC=aB.styleName,ay=aB.styleValue,aE=aB.elemenText,az=aB.endCheckClass;if(aD&&aD.length>0){aD.find("*").css(aC,"");aD.find(aA).css(aC,ay)}aB.element=aD;ax.setElementParentStyleEffectAll(aB);return av};ax.constructor.prototype.setElementParentStyleEffectAll=function(aB){var aA=aB.element,aC=aB.effectElement,az=aB.styleName,aG=aB.styleValue,aF=aB.elemenText,aD=aB.endCheckClass,aE=aA.parent();if(typeof(aE)==p){return av}if(aE.hasClass(aD)||M.trim(aE.text())!=aF){return av}var ay=aE[0].tagName.toLowerCase();if(ay==aC){aE.css(az,aG)}else{if(typeof(aE.css(az))!=p){aE.css(az,"")}}aB.element=aE;ax.setElementParentStyleEffectAll(aB);return av};ax.constructor.prototype.checkInArray=function(aA,az){for(var ay=0;ay<aA.length;ay++){if(aA[ay]==az){return true}}return false};ax.constructor.prototype.findTagInParent=function(aC,aB,aA){var az=false;if(typeof(aC.parent())==p||aC.parent().length<=0){return az}var ay=aC.parent();if(ay.hasClass(aA)){return az}var aD=ay[0].tagName.toLowerCase();if(aD==aB){return ay}else{return ax.findTagInParent(ay,aB,aA)}return az};ax.constructor.prototype.filterPasteData=function(aF){var aI=["div","span","font","p","u","i","br","b","a","strong","em"],aK=["font-size","line-height","text-align","color","font-family"],az,aB,ay,aH,aD,aG,aA,aL,aJ;if(typeof(aF.children)==p||aF.children().length<=0){return av}for(var aE=0;aE<aF.children().length;aE++){aB=aF.children().eq(aE);ax.filterPasteData(aB);az=M.trim(aB.prop("tagName").toLowerCase());if(!ax.checkInArray(aI,az)){aB.prop("outerHTML",aB.text());continue}ay=aB.attr("style");if(typeof(ay)==p||ay.length<=0){continue}ay=ay.toLowerCase();aJ=ay.split(";");if(aJ.length<=0){continue}aH=false;aD=[];for(var aC=0;aC<aJ.length;aC++){if(typeof(aJ[aC])==p){aH=true;continue}aG=aJ[aC].split(":");if(typeof(aG)==p||aG.length!=2){aH=true;continue}aA=aG[0];if(aA.indexOf(",")>0){aA=aA.substring(aA.lastIndexOf(","))}aL=aG[1];aA=M.trim(aA);if(!ax.checkInArray(aK,aA)){aH=true;continue}if(aA=="font-size"||aA=="line-height"){if(aL.indexOf("px")<0){aJ[aC]=""}else{aH=true}}aD.push(aJ[aC]+";")}if(aH){aB.attr("style",aD.join(""))}}return av};ax.constructor.prototype.textPositionCorrect=function(aA){if(aA.find("div").length>0||aA.find("p")>0){return av}if(typeof(aA.children)==p||aA.children().length<=0){return av}for(var az=0;az<aA.children().length;az++){var ay=aA.children().eq(az);if(typeof(ay.attr("style"))!=p&&ay.attr("style")&&ay.attr("style").indexOf("text-align")!=-1&&ay.css("display")!="block"){ay.css("display","block")}ax.textPositionCorrect(ay)}return av};ax.constructor.prototype.setUnselectable=function(ay){ay.fkEditorWrap.find("["+K+"]").css(R+"user-select","none").attr(K,"on").on("selectstart mousedown",false);ay.toolbar.find(".simpleTextEditTool").find("["+K+"]").css(R+"user-select","none").attr(K,"on").on("selectstart mousedown",false);return av};ax.constructor.prototype.removeUselessChildStyle=function(aG,aF){if(!aG.data(u.SetPageChange)||aG.data(u.HasRemoveUselessChild)==true){return}if(typeof(aF.children())==p){return}var aB,aI,ay,aA,az,aC,aH,aD;for(var aE=0;aE<aF.children().length;aE++){aB=aF.children().eq(aE);ay=aB.attr("class");aD=(typeof(ay)==p||ay=="");aI=aF.parent();if((aA=="span"||aA=="font"||aA=="a")&&aB.text().length<=0&&aD&&aB.html().indexOf("br")<=0){aB.replaceWith("");return}if(aD){aA=aB.prop("tagName").toLowerCase();az=aB.attr("style");aC=aB.attr("color");aH=aB.attr("face");if((typeof(az)==p||az=="")&&(aA=="span"||(aA=="font"&&typeof(aC)==p&&typeof(aH)==p))){aB.replaceWith(aB.html());aB=aI}}ax.removeUselessChildStyle(aG,aB)}};ax.constructor.prototype.removeElementProp=function(az){var aC=az.element,aB=az.attrName,ay,aD;aD=aC.attr(aB);if(typeof(aD)!=p&&aD!=""){aC.removeAttr(aB)}for(var aA=0;aA<aC.children().length;aA++){ay=aC.children().eq(aA);aD=ay.attr(aB);if(typeof(aD)!=p&&aD!=""){ay.removeAttr(aB)}ax.removeElementProp({element:ay,attrName:aB})}};ax.constructor.prototype.setElementStyle=function(aA){var aD=aA.element,aC=aA.styleName,ay=aA.styleValue,az,aE;aD.css(aC,ay);for(var aB=0;aB<aD.children().length;aB++){az=aD.children().eq(aB);az.css(aC,ay);ax.setElementStyle({element:az,styleName:aC,styleValue:ay})}}};return au=new aw()};this.getUICtrl=function(){}};ae=new e();var O=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ax=this;var ay=new Date().getTime();var az=new Date().getTime();ax.constructor.prototype.getWindowSelection=function(){if(!ag){return Z.getSelection()}if(ax.checkSelectionRange()){return f.selection.createRange()}return am};ax.constructor.prototype.checkIEGetSelection=function(){var aA=ax.getWindowSelection(),aB="baseOffset";if(!aA){return false}if(aB in aA&&aA.baseOffset==0){return false}return true};ax.constructor.prototype.isNumberPress=function(aA){if(aA>=48&&aA<=57){return true}if(aA>=96&&aA<=105){return true}if(aA==8||aA==46||aA==37||aA==39){return true}return false};ax.constructor.prototype.checkSelectionRange=function(){return f.selection&&f.selection.createRange&&f.selection.type!="None"};ax.constructor.prototype.getSelectedNode=function(){var aB,aC=ax.getWindowSelection(),aA;if(!ag){aB=aC.anchorNode}if(!aB&&ax.checkSelectionRange()){aC=f.selection;var aA=aC.getRangeAt?aC.getRangeAt(0):aC.createRange();aB=aA.commonAncestorContainer?aA.commonAncestorContainer:aA.parentElement?aA.parentElement():aA.item(0)}return aB?(aB.nodeName=="#text"?M(aB.parentNode):M(aB)):false};ax.constructor.prototype.detectElement=function(aC){var aB=aC.tags,aE=false,aA,aD=ax.getSelectedNode();if(aD){aA=aD.prop("tagName").toLowerCase();M.each(aB,function(aF,aG){if(aA==aG){aE=true;return false}});if(aE){return aE}aD.parents().each(function(){aA=M(this).prop("tagName").toLowerCase();M.each(aB,function(aF,aG){if(aA==aG){aE=true;return false}});if(aE){return false}});return aE}return false};ax.constructor.prototype.detectElementCss=function(aE){var aC=ax.getSelectedNode(),aB="fk-editor",aD,aA;if(x&&aC&&aC.length>0&&aC.hasClass(aB)){aA=ax.detectElementDeepCss(aC,aE);if(aA==""){aA=aC.css(aE)}return aA}if(aE&&aC){return aC.css(aE)}return""};ax.constructor.prototype.detectElementDeepCss=function(aC,aE){var aA="",aD=aC.text().length;if(aD<=0){return aA}if(aC.children().length<=0&&aD>0){aA=aC.css(aE);return aA}for(var aB=0;aB<aC.children().length;aB++){aA=ax.detectElementDeepCss(aC.children().eq(aB),aE);if(aA!=""){break}}return aA};ax.constructor.prototype.refuseStyle=function(aD){var aC=ax.getSelectedNode();if(aC&&aC.is("[style]")&&aC.css(aD)!=""){var aA=aC.css(aD),aB;aC.css(aD,"");aB=aC.attr("style");aC.css(aD,aA);return aB}return""};ax.constructor.prototype.setSelection=function(aE,aD){var aA,aB=ax.getWindowSelection();if(ag){aB.execCommand(aE,false,aD)}else{if(aB.anchorNode&&aB.getRangeAt){aA=aB.getRangeAt(0)}if(aA){aB.removeAllRanges();aB.addRange(aA)}if(!v.match(/msie/)){f.execCommand("StyleWithCSS",false,false)}if(aE==="fontname"){if(g.isIE()){aD=aD.replace(/\\/g,"")}else{f.execCommand("StyleWithCSS",false,true)}}try{f.execCommand(aE,false,aD)}catch(aC){console.log(aC)}}ax.affectStyleAround(false,true);return av};ax.constructor.prototype.affectStyleAround=function(aB,aC){var aD=ax.getSelectedNode();aD=aD?aD:aB;if(aD&&aC==false){if(aD.parent().is("[style]")){aD.attr("style",aD.parent().attr("style"))}if(aD.is("[style]")){aD.find("*").attr("style",aD.attr("style"))}return av}if(aB&&aC&&aB.is("[style]")){var aA=aC.split(";");aA=aA[0].split(":");if(aA[0]=="color"){var aE=false;aB.find("*").each(function(aF,aG){if(aF==0&&M(this).attr("color")||M(this).parent().attr("color")){aE=true}if(!M(this).attr("color")){if(!aE){M(this).css(aA[0],aA[1])}}})}else{if(aB.is("[style*="+aA[0]+"]")){aB.find("*").css(aA[0],aA[1])}}ax.selectText(aB)}return av};ax.constructor.prototype.selectText=function(aB){if(am==p||!aB){return av}var aB=aB[0],aA,aC=ax.getWindowSelection();if(ag){aC.moveToElementText(aB);aC.select();return av}if(typeof(aB)==p||aB==null){return av}aA=f.createRange();aA.selectNodeContents(aB);aC.removeAllRanges();aC.addRange(aA);if(M(aB).is(":empty")){M(aB).append("&nbsp;");ax.selectText(M(aB))}return av};ax.constructor.prototype.setNodeRange=function(aD){if(typeof(aD)==p){return}if(ag){return av}try{var aA,aB,aE=ax.getWindowSelection();aE.removeAllRanges();if(Q){aE.selectAllChildren(aD)}else{aA=aD.childNodes;if(aA&&aA.length>0){for(var aC=0;aC<aA.length;aC++){var aB=f.createRange();aB.selectNode(aA[aC]);aE.addRange(aB)}return av}aB=f.createRange();aB.selectNode(aD)}}catch(aF){console.log(aF)}return av};ax.constructor.prototype.getSelectText=function(aC,aB){var aE="",aA,aD=ax.getWindowSelection();if(!ag&&aD.anchorNode&&aD.getRangeAt){aA=aD.getRangeAt(0);if(!aB){aC.data(u.Range,aA)}aE=aA.toString()}if(ag&&am!=p){if(!aB){aC.data(u.Range,aD)}aE=aD.htmlText}return aE};ax.constructor.prototype.setSelectRange=function(aA){if(aA==null){return av}var aB=ax.getWindowSelection();if(!ag){aB.removeAllRanges();ax.getWindowSelection().addRange(aA);return av}if(ax.checkSelectionRange()){f.selection.createRangeCollection(aA)}return av};ax.constructor.prototype.setTagStyle=function(aA){if(typeof(aA.styleName)==p){aA.styleName=""}if(typeof(aA.styleValue)==p){aA.styleValue=""}var aC=ax.refuseStyle(aA.styleName),aB={};if(typeof(aC)==p){aC=""}if(typeof(aA.tagName)==p||aA.tagName==""){aA.tagName="span"}aA.tAttr="style";aA.tVal=aA.styleName+":"+aA.styleValue+";"+aC;return ax.replaceSelectedStyle(aA)};ax.constructor.prototype.replaceSelectedStyle=function(aD){var aS=aD.tagName,aN=aD.tAttr,aQ=aD.tVal,aJ=aD.styleName,aP=aD.styleValue,aI=aD.editor,aV=aD.notCreateNewNode,aB=aD.attr2,aW=aD.attr2Value,aH=aD.command,aL=aD.createNewNodeAction,a1,aR=20,a0=50,aK=10,aM="";if(!aI){console.log("replaceSelectedStyle err, editor = "+aI);return av}aM=aI.data(u.EndCheckClass);a1=aI.data(u.EditSignClass);if(typeof(aV)==p){aV=false}ay=new Date().getTime();if((ay-az)<aR){return av}var aC=aI.data(u.HasRefreshClick),aO=aI.data(u.SignClassNum),aT=aI.find("."+aI.data(u.EditSignClass)+aO),aE=M.trim(ax.getSelectText(aI,true)).length,aX=aD.isSetLinkColor?true:false,aG;if(!aX&&!aC&&aT.length>0&&(aE>0||aV||(M.browser.msie&&M.browser.version=="9.0"))){aT.css(aJ,aP);if(typeof(aB)!=p&&aB!=""){aT.attr(aB,aW)}if(aJ=="color"||aB=="color"){aG=ae.getEventCtrl().findTagInParent(aT,"u",aM);aG.length>0?aG.css(aJ,aP):"";aG=ae.getEventCtrl().findTagInParent(aT,"a",aM);aG.length>0?aG.css(aJ,aP):"";aT.find("a").css(aJ,aP)}if(aI.data(u.HasRsChildStyle)<a0){aI.data(u.HasRsChildStyle,parseInt(aI.data(u.HasRsChildStyle))+1);aT.find("*").css(aJ,"");if(aJ=="color"||aB=="color"){ae.getEventCtrl().removeElementProp({element:aT,attrName:"color"})}ae.getEventCtrl().removeParentUselessNode({element:aT,styleName:aJ,styleValue:aP,endCheckClass:aM})}ax.setOrUnsetUnderline({command:aH,element:aT,editor:aI,endCheckClass:aM});return av}az=ay;aI.data(u.HasRefreshClick,false);aI.data(u.HasRsChildStyle,0);if(aL==true){return av}var aU=ax.getWindowSelection(),aZ,aF,aA,aY;if(aU.anchorNode&&aU.getRangeAt){aZ=aU.getRangeAt(0);aF=f.createElement(aS);if(aT.length>0){if(aT.html()=="&nbsp;"){aT.replaceWith("")}else{aT.removeClass(a1+aO)}}aY=aI.attr("style");aI.height(aI.height()+"px");aO=parseInt(aO)+1;aI.data(u.SignClassNum,aO);M(aF).addClass(a1+aO);aA=aZ.extractContents();aF.appendChild(aA);aI.attr("style",aY);if(typeof(aB)!=p&&aB!=""){M(aF).attr(aB,aW)}aZ.insertNode(aF);if(aX){if(M(aF).parent().attr("color")){M(aF).attr("style","")}else{M(aF).attr("style","").css(aJ,aP)}}else{M(aF).attr("style","").css(aJ,aP)}if(aH!=BtnCommand.Underline){if(aN=="style"){ax.affectStyleAround(M(aF),aQ)}else{ax.affectStyleAround(M(aF),true)}}ax.setOrUnsetUnderline({command:aH,element:M(aF),editor:aI,endCheckClass:aM})}};ax.constructor.prototype.setOrUnsetUnderline=function(aF){var aG=aF.command,aE=aF.element,aH=aF.editor,aK=aF.endCheckClass,aR;if(aG!=BtnCommand.Underline){return}var aC=false,aN=false,aI=false,aO=false,aD=false,aQ,aL="none",aP="underline",aJ="text-decoration";elemenText=M.trim(aE.text());aR=aH.attr("style");aH.height(aH.height()+"px");aC=ae.getEventCtrl().findTagInParent(aE,"u",aK);if(aC==false){aN=ae.getEventCtrl().findTagInParent(aE,"a",aK);if(aN!=false&&aN.css(aJ)!=aL){aI=aN;aN=true}else{aN=false}if(aN==false){var aA=aE.find("u");if(aA.length>0&&M.trim(aA.eq(0).text())==elemenText){aO=true}if(aO==false){var aB=aE.find("a");if(aB.length>0&&M.trim(aB.eq(0).text())==elemenText&&aB.eq(0).css(aJ)!=aL){aD=true}else{aD=false}}}}ax.setSelection(aG);aQ={element:aE,effectElement:"a",styleName:aJ,styleValue:aL,elemenText:elemenText,endCheckClass:aK};if(aC!=false||aN!=false||aO!=false||aD!=false){if(aN==true&&M.trim(aI.text())!=elemenText){aI.find("*").css(aJ,"");if(aI.css(aJ)!=aL){aI.css(aJ,aL)}else{aI.css(aJ,aP)}}else{ae.getEventCtrl().setElementStyleEffectAll(aQ)}}else{var aM=M("<u></u>");aM.html(aE.html());aE.html(aM.prop("outerHTML"));ae.getEventCtrl().setElementStyleEffectAll(aQ)}ax.setNodeRange(aE[0]);aH.attr("style",aR);return av};ax.constructor.prototype.popCursorLastDiv=function(aC){var aF=aC.obj,aD=aC.editor,aB=aC.checkOnfocused;if(aB&&aD.data(u.Onfocused)){return}try{if(!ag){var aA=Z.getSelection();if(aA.selectAllChildren&&aF[0]&&!g.isIE9()){aA.selectAllChildren(aF[0]);aA.collapseToEnd()}return}if(f.selection){var aA=f.selection.createRange();aA.moveToElementText(aF[0]);aA.collapse(false);aA.select()}}catch(aE){}}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){};return at=new aw()}};i=new O();var w=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ax=this;ap.extend(this,i.getEventCtrl());ax.constructor.prototype.setSelection=function(){console.log("rewrite setSelection");return av}};return au=new aw()};this.getUICtrl=function(){}};P=new w();var s=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(ax){var ay=this;ay.constructor.prototype.bindInputEvent=function(aF){var aC=aF.element,az=aF.module,aE=aF.editor,aB=aF.command,aA=aF.btn,aD=aF.option,aG=12,aH=120;aA.find(".selectDivCover").unbind("mousewheel.selectDivCover").bind("mousewheel.selectDivCover",function(aI,aM){if(aA.find(".fkEditor-formatBar").height()<=10){return false}var aK=aA.find(".selectDiv span"),aJ=parseInt(aK.attr("_value")),aL;if(aM>0){if(aJ>=aH){return false}aJ=aJ+1}else{if(aJ<=aG){return false}aJ=aJ-1}aK.attr("_value",aJ).text(aJ);switch(aB){case BtnCommand.FontSize:if(!!aD.btnModuleEdit){aL={};aL.command=BtnCommand.FontSize;aL.val=aJ+"px";_EditBtnBase.getEventCtrl().selectChangeForBtnModuel(aF,aL)}else{i.getEventCtrl().setTagStyle({styleName:"font-size",styleValue:aJ+"px",editor:aE,notCreateNewNode:true,createNewNodeAction:true})}break;case BtnCommand.LineHeight:i.getEventCtrl().setTagStyle({styleName:"line-height",styleValue:aJ+"px",editor:aE,notCreateNewNode:true,createNewNodeAction:true});break;default:break}i.getEventCtrl().popCursorLastDiv({obj:aC});return false});aC.unbind("keyup").bind("keyup",function(aJ){aJ.stopPropagation();var aI=M(this),aK=aI.html().replace(/\D/g,"");if(aK>aH){aK=aH;aI.html(aK);if(aI.attr(X.Contenteditable)){i.getEventCtrl().popCursorLastDiv({obj:aI})}}else{if(aK<aG){aK=aG}}aK=M.trim(aK);aA.find(".selectDiv span").attr("_value",aK);switch(aB){case BtnCommand.FontSize:if(!!aD.btnModuleEdit){otherOption={};otherOption.command=BtnCommand.FontSize;otherOption.val=aK+"px";_EditBtnBase.getEventCtrl().selectChangeForBtnModuel(aF,otherOption)}else{if(aE.data(u.SelectedInputBlur)){_EditToolBase.getEventCtrl().editToolLogDog({module:az,command:BtnCommand.InputFontSize})}i.getEventCtrl().setTagStyle({styleName:"font-size",styleValue:aK+"px",editor:aE,notCreateNewNode:true,createNewNodeAction:true})}break;case BtnCommand.LineHeight:if(aE.data(u.SelectedInputBlur)){_EditToolBase.getEventCtrl().editToolLogDog({module:az,command:BtnCommand.InputLineHeight})}i.getEventCtrl().setTagStyle({styleName:"line-height",styleValue:aK+"px",editor:aE,notCreateNewNode:true,createNewNodeAction:true});break;default:break}aE.data(u.SelectedInputBlur,false)}).unbind("keydown").bind("keydown",function(aJ){aJ.stopPropagation();var aI=aJ.keyCode;if(aI==13||aI==116){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aD)}if(!i.getEventCtrl().isNumberPress(aI)){aJ.preventDefault();return}var aK=M(this).html().replace(/\D/g,"");if(aK=="0"&&(aI==48||aI==96)){aJ.preventDefault();return}if(aK.length>3){aJ.preventDefault()}}).unbind("blur").bind("blur",function(aI){aI.stopPropagation();aE.data(u.SelectedInputBlur,true)})};ay.constructor.prototype.getWheelData=function(aE){var aH=aE.find(".fkEditor-formats"),aC=aH.find(".fkEditor-formatContent"),aP=aH.find(".fkEditor-formatSlider"),aA=aC.find(".fkEditor-format"),aJ=aH.height(),aL=aC.height(),aG=aP.height(),aI=aA.length,aF=aA.height(),aN=aI-aJ/aF,aQ=aL-aJ,aK=aJ-aG,aB=aK/aN,aM=aQ/aN,aD=aC.position().top,aO=aP.position().top,az=1;return{c:aC,s:aP,ct:aD,st:aO,cs:aM*az,ss:aB*az,cm:aQ,sm:aK}};ay.constructor.prototype.bindMousewheelAndSlideEvent=function(aC){var az=aC.formatbar,aD=aC.toolbar,aB,aA;aB=function(){if(aD.data(ToolAttr.ScrollingMousedown)){aD.data(ToolAttr.Scrolling,true)}};aA=function(){aD.data(ToolAttr.Scrolling,false);aD.data(ToolAttr.ScrollingMousedown,false)};az.find(".fkEditor-formatContent").mCustomScrollbar({theme:"select-theme",callbacks:{onScrollStart:aB,onScroll:aA}});az.find(".mCSB_dragger_bar").unbind("mousemove.scrollTools").bind("mousemove.scrollTools",function(aE){aD.data(ToolAttr.ScrollingMousedown,true)});az.find("a").click(function(){aD.data(ToolAttr.Scrolling,false)});az.unbind("mousewheel.formatbar").bind("mousewheel.formatbar",function(aE,aF){return false})}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createSelectedToolCoverDom=function(ay){var az=[];az.push("<div "+K+' class="selectDivCover"></div>');return az};ax.constructor.prototype.createSelectedToolDom=function(az){var aD=az.option,aC=az.btn,ay=az.reSetUnselectable,aB=[],aE=aC.command,aA=K;if(ay){aA=ay}aB.push("<div "+aA+' class="selectDiv selectDivNew">');aB.push("<span "+aA+"></span>");aB.push("</div>");aB.push("<a "+aA+' class="fkEditor-tool-icon fkEditor-tool-iconNew '+aE+'-tool-icon">');aB.push("</a>");if(aA!=K){aB.push(ax.createSelectedToolCoverDom(az).join(""))}return aB};ax.constructor.prototype.createSelectedSlideToolDom=function(aE){var aB=aE.option,az=aE.btn,aC=[],aA=[],ay="formatDef",aF=aE.selectedData;aA.push(ax.createSelectedToolDom(aE).join(""));aA.push('<div class="'+aB.css+"-formatBar "+aB.css+'-formatBarNew"'+K+">");aA.push('<span class="selectedTip" title="当用户电脑字体库中没有下载该字体时，将默认显示为微软雅黑。">');aA.push('<span class="tipLeft">');aA.push("</span>");aA.push('<span class="tipRight">');aA.push("当用户电脑字体库中没有下载该字体时，将默认显示为微软雅黑。");aA.push("</span>");aA.push("</span>");aA.push('<div class="'+aB.css+"-formats "+aB.css+'-formatsNew fkEditorBar" '+K+">");aA.push('<div class="'+aB.css+'-formatContent" '+K+">");for(var aD=0;aD<aF.length;aD++){var aH="formatMg ",aG="";if(aD!=0){ay=""}if(typeof(aF[aD][3])!=p){aH+=aF[aD][3];aG=""}aA.push("<a "+aB.css+'-formatval="'+aF[aD][0]+'" '+aB.css+'-formatName="'+aF[aD][1]+'" class="'+aB.css+"-format  "+aB.css+"-formatNew  "+ay+'" role="menuitem" '+K+' title="'+aG+'">');if(typeof(aF[aD][2])!=p){aA.push('<span class="'+aF[aD][2]+'"></span>')}aA.push('<span style="position:relative; font-family:'+aF[aD][0]+'" class="'+aH+'" '+K+">"+aF[aD][1]);aA.push("</span>");aA.push("</a>")}aA.push("</div>");aA.push("</div>");aA.push("</div>");return _EditBtnBase.getUICtrl().createBtnToolDom({option:aB,reSetUnselectable:aE.reSetUnselectable,btn:az,toolContent:aA.join("")})}};return at=new aw()}};_SelectedTool=new s();var ad={};var ai=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(){var aA=this,ax=[],ay=[],aC,aB,az,aD=false;aA.constructor.prototype.addBtnParam=function(aG,aL,aH,aE,aF,aJ,aI,aK){return ax.push({moduleName:aG,command:aL,key:aH,tag:aE,cls:aF,emphasis:aJ,className:aI,title:aK})};aA.constructor.prototype.getButtonsData=function(aE){var aF=aE.option;if(ax&&ax.length>0){return aA.getShowOrderBtn({btns:ax,toolBtnOrder:aF.Tool.ToolBtnOrder,option:aF})}aA.addBtnParam("EditColorBtn",BtnCommand.Colors,"","","tool-colors",false,"tool-color","颜色");aA.addBtnParam("EditFormatsBtn",BtnCommand.Formats,"","","tool-formats",false,"","文字字体");aA.addBtnParam("EditFontSizeBtn",BtnCommand.FontSize,"","","tool-fontSize",false,"tool-size","文字大小");aA.addBtnParam("EditBreakLineBtn");aA.addBtnParam("EditBoldBtn",BtnCommand.Bold,"B",["b","strong","h1","h2","h3","h4","h5","h6"],"tool-bold tool-boldNew",true,"","加粗");aA.addBtnParam("EditItalicBtn",BtnCommand.Italic,"I",["i","em"],"tool-italic",true,"","斜体");aA.addBtnParam("EditUnderlineBtn",BtnCommand.Underline,"U",["u"],"tool-underline",true,"","下划线");aA.addBtnParam("EditWritingModeBtn",BtnCommand.WritingMode,"","","tool-writingMode tool-writingModeNew",false,"","文字排列方式");aA.addBtnParam("EditLineHeightBtn",BtnCommand.LineHeight,"","","tool-lineHeight",false,"","行高");aA.addBtnParam("EditTextAlignBtn",BtnCommand.TextAlign,"","","tool-textAlign",false,"","对齐方式");aA.addBtnParam("EditLinkBtn",BtnCommand.Linkcreator,"L",["a"],"tool-linkcreator",false,"","设置链接");aA.addBtnParam("EditRemoveFormatBtn",BtnCommand.Removeformat,".","","tool-removeformat",false,"","清除格式");aA.addBtnParam("EditSeperatorBtn");return aA.getShowOrderBtn({btns:ax,toolBtnOrder:aF.Tool.ToolBtnOrder,option:aF})};aA.constructor.prototype.addHoverBtnParam=function(aE,aH,aF,aG){return ay.push({moduleName:aE,command:aH,className:aF,title:aG})};aA.constructor.prototype.getHoverShowButtons=function(aE){var aF=aE.option;if(ay&&ay.length>0){return aA.getShowOrderBtn({btns:ay,toolBtnOrder:aF.HoverTool.ToolBtnOrder,option:aF})}aA.addHoverBtnParam("EditContentBtn",BtnCommand.EditContent,"tool-editContent tool-editContentNew","编辑文本");aA.addHoverBtnParam("EditFixedPositionBtn",BtnCommand.EditPositionFixed,"tool-editPositionFixed","固定");aA.addHoverBtnParam("EditLogoDisplayBtn",BtnCommand.EditLogoDisplay,"tool-editLogoDisplay","显示Logo");aA.addHoverBtnParam("EditBtnModuleStyleBtn",BtnCommand.BtnModuleStyle,"tool-editModule f-tool-editModule","设置样式");aA.addHoverBtnParam("EditPhotoBtn",BtnCommand.EditPhotoBtn,"f-tool-editPic tool-editPic","添加图片");aA.addHoverBtnParam("EditImgEffectBtn",BtnCommand.ImgEffectBtn,"f-tool-hoverPic tool-hoverPic","模块特效");aA.addHoverBtnParam("EditPhotoShapeBtn",BtnCommand.PhotoShapeBtn,"f-tool-picShape tool-picShape","图片形状");aA.addHoverBtnParam("EditSimpleLinkBtn",BtnCommand.SimpleLinkBtn,"f-tool-link tool-link f-simple-tool-link","设置链接");aA.addHoverBtnParam("EditModuleTitleBtn",BtnCommand.ModuleTitleBtn,"f-tool-edit-name tool-edit-name","模块标题");aA.addHoverBtnParam("EditDescribePicBtn",BtnCommand.DescribePicBtn,"f-tool-description tool-description","图片描述");aA.addHoverBtnParam("EditFixedBtn",BtnCommand.EditFixedBtn,"f-tool-fixed tool-fixed","固定");aA.addHoverBtnParam("EditAnimationBtn",BtnCommand.Animation,"f-tool-animation tool-animation tool-animationNew","模块动画");aA.addHoverBtnParam("EditBorderRadiusBtn",BtnCommand.BorderRadius,"f-tool-borderRadius tool-borderRadius","圆角");aA.addHoverBtnParam("EditOpacityBtn",BtnCommand.Opacity,"f-tool-opacity tool-opacity","透明度");aA.addHoverBtnParam("EditBorderBtn",BtnCommand.Border,"f-tool-border tool-border","边框");aA.addHoverBtnParam("EditShadowBtn",BtnCommand.Shadow,"f-tool-shadow tool-shadow","阴影");aA.addHoverBtnParam("EditGlobalLinkBtn",BtnCommand.GlobalLink,"f-tool-link tool-link tool-linkNew","设置链接");aA.addHoverBtnParam("EditDeleteBtn",BtnCommand.Delete,"f-tool-delete tool-delete tool-deleteNew","隐藏模块");aA.addHoverBtnParam("EditSeperatorBtn");return aA.getShowOrderBtn({btns:ay,toolBtnOrder:aF.HoverTool.ToolBtnOrder,option:aF})};aA.constructor.prototype.getShowOrderBtn=function(aF){var aH=aF.option,aI=aF.btns,aK=aF.toolBtnOrder,aJ=[];for(var aG=0;aG<aK.length;aG++){for(var aE=0;aE<aI.length;aE++){if(aI[aE]["moduleName"]==aK[aG]){if(aI[aE]["moduleName"]=="EditContentBtn"){aI[aE]["title"]=aH.EditContentBtn.name}else{if(aI[aE]["moduleName"]=="EditDeleteBtn"){if(aH.moduleId=="logo"){aI[aE]["title"]="隐藏logo"}else{aI[aE]["title"]="隐藏模块"}}}aJ.push(aI[aE]);break}}}return aJ};aA.constructor.prototype.buttonEmphasize=function(aG){var aU=aG.option,a0=aG.buttons,aM=aG.editor,aT=M("#"+aU.css+"-toolBar-"+aU.moduleId),aR=aT.find(".tool-formats"),aS=aT.find(".tool-fontSize"),aJ=aS.find(".selectDiv span"),a3=aT.find(".tool-lineHeight"),aV=aT.find(".tool-color ."+aU.css+"-tool-icon"),a2=aU.css+"-tool-depressedNew",aO=aU.css+"-tool-depressedNewHover",aQ=aU.css+"-tool-depressedNewShow",aL='<div class="'+a2+'"></div>',aI,aX,aK;for(var aW=0;aW<a0.length;aW++){if(!ae.getEventCtrl().checkInArray(aU.Tool["ToolBtnOrder"],a0[aW].moduleName)){continue}aK=a0[aW].command;if(a0[aW].emphasis&&a0[aW].tag!=""){aI=a0[aW].cls.split(" ")[0];aX=i.getEventCtrl().detectElement({tags:a0[aW].tag});if(!aX){switch(aK){case BtnCommand.Bold:if("bold"==i.getEventCtrl().detectElementCss("font-weight")){aX=true}break;case BtnCommand.Italic:if("italic"==i.getEventCtrl().detectElementCss("font-style")){aX=true}break;case BtnCommand.Underline:if(/underline/.test(i.getEventCtrl().detectElementCss("text-decoration"))){aX=true}break;default:break}}if(aX){if(aT.find("."+aI).find("."+aQ).length<=0){aT.find("."+aI).find("."+a2).addClass(aQ).removeClass(aO)}}else{aT.find("."+aI).find("."+a2).removeClass(aQ).addClass(aO)}}if(aK==BtnCommand.TextAlign){var aY=i.getEventCtrl().detectElementCss("text-align");switch(aY){case"center":_EditTextAlignBtn.getEventCtrl().textAlignEmphasize({editor:aM,toolbar:aT,command:BtnCommand.JustifyCenter});break;case"right":_EditTextAlignBtn.getEventCtrl().textAlignEmphasize({editor:aM,toolbar:aT,command:BtnCommand.JustifyRight});break;case"justify":_EditTextAlignBtn.getEventCtrl().textAlignEmphasize({editor:aM,toolbar:aT,command:BtnCommand.JustifyFull});break;default:_EditTextAlignBtn.getEventCtrl().textAlignEmphasize({editor:aM,toolbar:aT,command:BtnCommand.JustifyLeft});break}}if(aK==BtnCommand.Colors){var aE,a4="color";aE=i.getEventCtrl().detectElementCss(a4);if(_EditColorBtn.getEventCtrl().checkColorIsWhite(aE)){aV.css("border","solid 1px #ccc")}else{aV.css("border","0px")}aV.css("background",aE);aV.removeClass("fk-colorPicker-transparentIco")}if(aK==BtnCommand.Formats){var a1,a4="font-family",aF=aU.EditFormatsBtn.selectedData,aN=false,aP;if(aF&&aF.length>0){a1=i.getEventCtrl().detectElementCss(a4);if(a1.indexOf(",")>0){a1=a1.substring(0,a1.indexOf(","))}a1=a1.replace(/"/g,"");a1=a1.replace(/'/g,"");for(var aZ=0;aZ<aF.length;aZ++){if(M.trim(aF[aZ][0]).indexOf(M.trim(a1))>=0){aN=true;a1=aF[aZ][1];aP=aR.find("."+aU.css+"-formatContent");aP.find(".formatDef").removeClass("formatDef");aP.find("a").eq(aZ).addClass("formatDef");break}}aR.find(".selectDiv span").html(a1);aR.attr("title",a1)}}if(aK==BtnCommand.FontSize){var a4="font-size";fontSize=i.getEventCtrl().detectElementCss(a4);fontSize=parseInt(fontSize.replace("px",""));if(fontSize>0){if(aJ.attr(X.Contenteditable)=="true"){aS.find(".selectDiv span").attr("_value",fontSize).html(fontSize)}else{aS.find(".selectDiv span").attr("_value",fontSize).html(fontSize+"px")}}}if(aK==BtnCommand.LineHeight){var aH,a4="line-height";aH=i.getEventCtrl().detectElementCss(a4);aH=aH.replace("px","");if(isNaN(aH)&&fontSize){aH=fontSize}aH=parseInt(aH);if(aH>0){a3.find(".selectDiv span").attr("_value",aH)}}}};aA.constructor.prototype.bindToolBtnEvent=function(aI){var aF=aI.option,aH=aI.editor,aK=aI.toolbar,aE=aI.module,aG=aI.fkEditorWrap,aL=aK.find(".simpleTextEditTool .tool"),aJ=aK.find(".editToolIcon"),aM="mouseup.hoverToolButton";if(G){aJ.unbind(aM).bind(aM,function(aN){aN.stopPropagation()})}aJ.unbind("click.hoverToolButton").bind("click.hoverToolButton",function(){aI.thisBtnElement=this;aA.hoverToolButtonClick(aI);return false});if(!aF.simpleTool){aL.unbind("click.toolbutton").bind("click.toolbutton",function(aO){aH.data(u.HasRsChildStyle,0);_EditColorBtn.getEventCtrl().backTextSelectedStatus(aI);M(".J_advanceColorPicker").hide();if(G){var aN=this;i.getEventCtrl().setSelectRange(aH.data(u.Range));aI.thisBtnElement=aN;!!aF.btnModuleEdit?aA.toolButtonClickForBtnModuel(aI):aA.toolButtonClick(aI)}else{aI.thisBtnElement=this;!!aF.btnModuleEdit?aA.toolButtonClickForBtnModuel(aI):aA.toolButtonClick(aI)}return false})}return av};aA.constructor.prototype.hoverToolButtonClick=function(aH){var aT=aH.option,aM=aH.editor,aG=aH.module,aZ=aH.fkEditorWrap,aS=aH.toolbar,aI=aH.thisBtnElement,aN=M(aI),aE=aT.moduleId.replace("module",""),aL=aN.attr("command"),aF=500,aU=aT.btnModuleEdit,aW=aT.simpleTool,aJ=aT.tipTitle,aO,aX=true,aK=500;aM.data(u.PreCommand,aL);_EditToolBase.getEventCtrl().hideToolBarMask();switch(aL){case BtnCommand.EditContent:ad[aM.attr("id")]=aM.html()||"";if(aM.data(u.TriggerClick)){aM.data(u.TriggerClick,false);aX=false}if(aM.find(".editTip").length>0){aM.data(u.PreHtmlContent,"")}else{aM.data(u.PreHtmlContent,aM.html())}aM.data(u.SimpleTextEdit,true);aM.data(u.HasRefreshClick,true);aM.removeData(u.Range,true);aS.css({width:aT.Tool.width,height:aT.Tool.height});aS.find(".simpleTextHoverTool").hide();aS.find(".simpleTextEditTool").fadeIn(aF);aM.css("cursor","text");_EditLinkBtn.getEventCtrl().handTagANotJump(aM);aG.addClass("formLockEdit");if(aM.not(":focus")){var aV=100;clearTimeout(az);az=setTimeout(function(){aM.find(".editTip").remove();aM.attr(X.Contenteditable,true).focus();_EditBtnBase.getEventCtrl().buttonEmphasize(aH)},aV)}_EditToolBase.getEventCtrl().calcuToolBarPos(aH);ar.checkSimpleTextHideTool(aT.moduleId);_EditToolBase.getEventCtrl().editToolBarMask(aE);_EditWritingModeBtn.getEventCtrl().adjustWritingModeState(aH);if(!!aU){aO={};aO.command=BtnCommand.EditContent;_EditBtnBase.getEventCtrl().selectChangeForBtnModuel(aH,aO)}i.getEventCtrl().popCursorLastDiv({obj:aM,editor:aM,checkOnfocused:true});break;case BtnCommand.EditPositionFixed:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aT);_EditFixedPositionBtn.getEventCtrl().checkPositionFixed({toolbar:aS,btn:aN,option:aT});_EditToolBase.getEventCtrl().calcuToolBarPos(aH);break;case BtnCommand.EditLogoDisplay:if(aD){return}aD=true;_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aT);_EditLogoDisplayBtn.getEventCtrl().checkLogoDisplay({toolbar:aS,btn:aN,option:aT});setTimeout(function(){aD=false},aK);break;case BtnCommand.GlobalLink:aM.data(u.PreHtmlContent,aM.html());_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aT);if(aM.find(".editTip").length>0&&(!aU&&!aW)){g.ing("请输入内容",true);return}if(aT.globalJumpCtrlFun&&aT.globalJumpCtrlFun!=""){var aY,aQ={};if(!aW){i.getEventCtrl().setNodeRange(aM[0]);aY=i.getEventCtrl().getSelectText(aM,false);if(aT.editorName=="corpTitle"){aQ=_EditLinkBtn.getEventCtrl().getCorpTitleLinkPreData()}else{aQ=_EditLinkBtn.getEventCtrl().getGlobalLinkPreData(aM,aH)}}if(!aU&&!aW){if(aY&&aY!=""){if(aQ._lide==""){aM.data(u.TriggerClick,true);aS.find(".tool-linkcreator").trigger("click");setTimeout(function(){aM.attr(X.Contenteditable,false)},500)}else{_EditGlobalLinkBtn.getEventCtrl().showGlobalLinkPanel(aH);g.fkEval(aT.globalJumpCtrlFun.replace("xxx",M.toJSON(aQ)))}}}else{_EditGlobalLinkBtn.getEventCtrl().showGlobalLinkPanel(aH);g.fkEval(aT.globalJumpCtrlFun)}}break;case BtnCommand.BorderRadius:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aT);_EditBorderRadiusBtn.getEventCtrl().showBorderRadiusPanel(aH);break;case BtnCommand.Opacity:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aT);_EditOpacityBtn.getEventCtrl().showOpacityPanel(aH);break;case BtnCommand.Border:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aT);_EditBorderBtn.getEventCtrl().showBorderPanel(aH);break;case BtnCommand.Shadow:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aT);_EditShadowBtn.getEventCtrl().showShadowPanel(aH);break;case BtnCommand.Delete:_EditToolBase.getEventCtrl().deleteOrHideToolBar(aT);if(aT.deleteFun&&aT.deleteFun!=""){g.fkEval(aT.deleteFun)}else{if(!aW){aZ.remove()}}break;case BtnCommand.Animation:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aT);if(aT.animationFun&&aT.animationFun!=""){g.fkEval(aT.animationFun)}break;case BtnCommand.BtnModuleStyle:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aT);if(aT.editModuleFun&&aT.editModuleFun!=""){g.fkEval(aT.editModuleFun)}break;case BtnCommand.EditPhotoBtn:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aT);if(aT.editPhotoFun&&aT.editPhotoFun!=""){g.fkEval(aT.editPhotoFun)}break;case BtnCommand.ImgEffectBtn:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aT);if(aT.imgEffectFun&&aT.imgEffectFun!=""){g.fkEval(aT.imgEffectFun)}break;case BtnCommand.PhotoShapeBtn:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aT);if(aT.photoShapeFun&&aT.photoShapeFun!=""){g.fkEval(aT.photoShapeFun)}break;case BtnCommand.SimpleLinkBtn:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aT);if(aT.simpleLinkFun&&aT.simpleLinkFun!=""){g.fkEval(aT.simpleLinkFun)}break;case BtnCommand.ModuleTitleBtn:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aT);var aR=aS.find(".tool-edit-name .fkEditor-moduleNameSlideBar"),aP=g.top.$("#module"+aE+"SideBtn").find(".g_sideBtn_c .g_sideBtn_tl").text();aR.find(".J_module-name-input").val(aP).focus();_EditModuleTitleBtn.getEventCtrl().showModuleTitlePanel(aH);break;case BtnCommand.DescribePicBtn:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aT);aS.find(".tool-description").find("#logoDescription").val(g.decodeHtml(g.top._logoData.des)).focus();_EditDescribePicBtn.getEventCtrl().showDescribePicPanel(aH);break;case BtnCommand.EditFixedBtn:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aT);_EditFixedBtn.getEventCtrl().setFixedLogoBtnTitle({toolbar:aS,btn:aN,option:aT});if(aT.fixedFun&&aT.fixedFun!=""){g.fkEval(aT.fixedFun);ar.undoRun(function(){},{type:"logo",detail:"fixedClick",undoSame:false,redoSame:false,undoArgs:[{toolbar:aS,btn:aN,option:aT}],redoArgs:[{toolbar:aS,btn:aN,option:aT}],undoFn:function(a0){_EditFixedBtn.getEventCtrl().setFixedLogoBtnTitle(a0);g.fkEval(aT.fixedFun)},redoFn:function(a0){_EditFixedBtn.getEventCtrl().setFixedLogoBtnTitle(a0);g.fkEval(aT.fixedFun)}})}break;default:break}aJ&&_EditToolBase.getEventCtrl().hideSimpleTip(aS.find(".simpleTextHoverTool .tool .editToolIcon"));aM.trigger("change");aX&&_EditToolBase.getEventCtrl().editToolLogDog({module:aG,command:aL})};aA.constructor.prototype.toolButtonClick=function(aP){var aM=aP.option,aO=aP.editor,aH=aP.module,aR=aP.toolbar,aG=aP.thisBtnElement,aS=aR.find(".tool"),aE=M(aG),aJ=aE.attr("command"),aQ=aR.find(".tool-color ."+aM.css+"-tool-icon"),aN=true;if(aO.not(":focus")){aO.attr(X.Contenteditable,true).focus()}if(aJ==BtnCommand.Removeformat){aO.data(u.HasRefreshClick,true)}_EditorBase.getEventCtrl().setEidtorSelectedRule({editor:aO,command:aJ});aO.data(u.PreCommand,aJ);switch(aJ){case BtnCommand.Linkcreator:if(aO.data(u.TriggerClick)){aO.data(u.TriggerClick,false);aN=false}_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aM);if(aM.jumpCtrlFun&&aM.jumpCtrlFun!=""&&!aO.data(u.LinkHasClick)){var aT=i.getEventCtrl().getSelectText(aO,true);linkPreData={};if(aM.editorName=="corpTitle"){linkPreData=_EditLinkBtn.getEventCtrl().getCorpTitleLinkPreData()}else{linkPreData=_EditLinkBtn.getEventCtrl().getLinkPreData()}aO.data(u.LinkHasClick,true);if(aT&&aT!=""){ak.fkEval(aM.jumpCtrlFun.replace("xxx",M.toJSON(linkPreData)))}clearTimeout(aC);aC=setTimeout(function(){aO.data(u.LinkHasClick,false)},2000)}break;case BtnCommand.Formats:_EditFormatsBtn.getEventCtrl().showFormatToolBar(aP);break;case BtnCommand.FontSize:_EditFontSizeBtn.getEventCtrl().showSizeToolBar(aP);break;case BtnCommand.LineHeight:_EditLineHeightBtn.getEventCtrl().showLineHiehgtToolBar(aP);break;case BtnCommand.Colors:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aM);var aT=i.getEventCtrl().getSelectText(aO,true);var aF={moduleId:aM.moduleId.replace("module",""),target:aQ,onShowStatus:ar.simpleTextColoronShowStatus,inputHexStatus:ar.simpleTextSetTextColor,onchange:ar.simpleTextSetTextColor,isSystemModule:aM.isSystemModule,_left:42};aE.faiColorPickerAlp(aF);if(ar.simpleTextList.allEditors){for(var aL=0;aL<ar.simpleTextList.allEditors.length;aL++){if(ar.simpleTextList.allEditors[aL]["moduleId"]==aM.moduleId){ar.simpleTextList.chooseEditor=ar.simpleTextList.allEditors[aL]["editor"];break}}}_EditColorBtn.getEventCtrl().simpleTextColorInputHexStatus({state:1,editor:aO,option:aM});break;case BtnCommand.Underline:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aM);if(M.trim(i.getEventCtrl().getSelectText(aO,true)).length>0&&aO.find("a").length>0){i.getEventCtrl().setTagStyle({editor:aO,command:aJ})}else{i.getEventCtrl().setSelection(aJ)}break;case BtnCommand.Removeformat:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aM);if(M.trim(i.getEventCtrl().getSelectText(aO,false)).length==M.trim(aO.text()).length){aO.html(aO.text())}else{var aI="20px",aK=100;if(ag){i.getEventCtrl().setTagStyle({styleName:"font-size",styleValue:aI,editor:aO})}i.getEventCtrl().setSelection(aJ);i.getEventCtrl().setSelection("Unlink");clearTimeout(aB);aB=setTimeout(function(){i.getEventCtrl().setSelection("removeformat")},aK);if(aH.find(".fk-editor-vertical-rl").length<1){_EditorBase.getEventCtrl().setEditorAutoHeight(aM.moduleId)}}break;case BtnCommand.TextAlign:_EditTextAlignBtn.getEventCtrl().showTextAlignBtnPanel(aP);break;case BtnCommand.WritingMode:_EditWritingModeBtn.getEventCtrl().switchWritingMode(aP);_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aM);ar.simpleTextSetCgData(aM.moduleId);ar.undoRun(function(){},{type:"module.simpleText",detail:"simpleTextWritingMode",undoSame:false,redoSame:false,undoArgs:[aP],redoArgs:[aP],undoFn:_EditWritingModeBtn.getEventCtrl().switchWritingMode,undoFn:_EditWritingModeBtn.getEventCtrl().switchWritingMode});break;default:i.getEventCtrl().setSelection(aJ);_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aM);break}if(!aO.data(u.ClearSpanCursoring)){aO.trigger("change");aO.data(u.ClearSpanCursoring,true);aO.find("span").css("cursor","");setTimeout(function(){aO.data(u.ClearSpanCursoring,false)},300)}setTimeout(function(){if(aJ==BtnCommand.Underline||aJ==BtnCommand.Bold||aJ==BtnCommand.Italic||aJ==BtnCommand.Removeformat){_EditBtnBase.getEventCtrl().buttonEmphasize(aP)}if(M.trim(i.getEventCtrl().getSelectText(aO,true)).length>0){i.getEventCtrl().getSelectText(aO,false)}},100);aN&&_EditToolBase.getEventCtrl().editToolLogDog({module:aH,command:aJ});return av};aA.constructor.prototype.toolButtonClickForBtnModuel=function(aN){var aJ=aN.option,aL=aN.editor,aI=aN.module,aG=aJ.moduleId,aP=aG.replace("module",""),aE,aO=aN.toolbar,aH=aN.thisBtnElement;toolbutton=aO.find(".tool"),jqThisBtn=M(aH),command=jqThisBtn.attr("command"),colorBar=aO.find(".tool-color ."+aJ.css+"-tool-icon"),contentLink=g.top.Site.getModuleAttrPattern(aP).contentLink;i.getEventCtrl().setNodeRange(aL[0]);if(aL.not(":focus")){aL.attr(X.Contenteditable,true).focus()}aL.data(u.PreCommand,command);switch(command){case BtnCommand.Formats:_EditFormatsBtn.getEventCtrl().showFormatToolBar(aN);break;case BtnCommand.FontSize:_EditFontSizeBtn.getEventCtrl().showSizeToolBar(aN);break;case BtnCommand.Colors:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aJ);function aK(aR,aS){var aQ=aS||aR;if(_EditColorBtn.getEventCtrl().checkColorIsWhite(aQ)){colorBar.css("border","solid 1px #ccc")}else{colorBar.css("border","0px")}colorBar.css("background",aQ);contentLink.y=1;contentLink.fct=1;contentLink.c=aQ;g.top.Site.getModuleAttrPattern(aP).changed=true;aI.find(".lightModuleOuterContent"+aP).find("a").css("color",aQ);ar.styleChanged()}function aM(aR,aQ){if(aR==2){if(_EditColorBtn.getEventCtrl().checkColorIsWhite(aQ)){colorBar.css("border","solid 1px #ccc")}else{colorBar.css("border","0px")}colorBar.css("background",aQ);contentLink.y=1;contentLink.fct=1;contentLink.c=aQ;g.top.Site.getModuleAttrPattern(aP).changed=true;aI.find(".lightModuleOuterContent"+aP).find("a").css("color",aQ);ar.styleChanged()}}var aF={moduleId:aP,target:colorBar,inputHexStatus:aM,onchange:aK,changeStop:function(aQ,aR){ar.undoRun(aK,{type:"module.floatBtn",detail:"floatBtnTextColor",id:aP,doArgs:[aQ],undoArgs:[aR]})},_left:42,appendToWeb:true};jqThisBtn.faiColorPickerAlp(aF);i.getEventCtrl().getWindowSelection().removeAllRanges();break;case BtnCommand.Underline:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aJ);ar.undoRun(function(aS,aR){g.top.Site.getModuleAttrPattern(aS).changed=true;var aQ=g.top.Site.getModuleAttrPattern(aS).contentLink;aR?(aQ.d=1,aQ.y=1):(aQ.d=0);ar.setModuleStyleCssList(aS,[{cls:".lightModuleOuterContent"+aS+" a",key:"text-decoration",value:aR?"underline":"none"},{cls:".lightModuleOuterContent"+aS+" .pagenation_N a span",key:"text-decoration",value:aR?"underline":"none"}])},{type:"module.floatBtn",detail:"floatBtnUnderLine",id:aP,doArgs:[aP,!contentLink.d],undoArgs:[aP,contentLink.d],redoArgs:[aP,!contentLink.d]});ar.styleChanged();break;case BtnCommand.Bold:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aJ);ar.undoRun(function(aR,aS){g.top.Site.getModuleAttrPattern(aR).changed=true;var aQ=g.top.Site.getModuleAttrPattern(aR).contentLink;aS?(aQ.b=1,aQ.y=1):(aQ.b=0);ar.setModuleStyleCssList(aR,[{cls:".lightModuleOuterContent"+aR+" a",key:"font-weight",value:aS?"bold":"normal"}])},{type:"module.floatBtn",detail:"floatBtnBold",id:aP,doArgs:[aP,!contentLink.b],undoArgs:[aP,contentLink.b],redoArgs:[aP,!contentLink.b]});ar.styleChanged();break;default:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aJ);break}if(!aL.data(u.ClearSpanCursoring)){aL.trigger("change");aL.data(u.ClearSpanCursoring,true);aL.find("span").css("cursor","");setTimeout(function(){aL.data(u.ClearSpanCursoring,false)},300)}setTimeout(function(){if(command==BtnCommand.Underline||command==BtnCommand.Bold){_EditBtnBase.getEventCtrl().buttonEmphasize(aN)}},100);_EditToolBase.getEventCtrl().editToolLogDog({module:aI,command:command});return av};aA.constructor.prototype.selectChangeForBtnModuel=function(aL,aE){var aI=aL.option,aK=aL.editor,aF=aL.module,aO=aI.moduleId.replace("module",""),aN=g.top.Site.getModuleAttrPattern(aO).contentLink,aH=aE.command,aM=aE.val;switch(aH){case BtnCommand.Formats:var aJ=aK.css("font-family");aN.y=1;aN.f=aM;g.top.Site.getModuleAttrPattern(aO).changed=true;aM=aM.replace(/"/g,"");aM=aM.replace(/'/g,"");aK.css("font-family",aM);ar.styleChanged();ar.undoRun(function(){},{type:"module.floatBtn",detail:"floatBtnFormats",id:aO,undoSame:false,redoSame:false,undoArgs:[aK,aJ],redoArgs:[aK,aM],undoFn:function(aP,aQ){aP.css("font-family",aQ)},redoFn:function(aP,aQ){aP.css("font-family",aQ)}});break;case BtnCommand.FontSize:var aG=aK.css("font-size");aK.css("font-size",aM);aN.y=1;aN.ls=aM.replace("px","");g.top.Site.getModuleAttrPattern(aO).changed=true;ar.styleChanged();ar.undoRun(function(){},{type:"module.floatBtn",detail:"floatBtnFontSize",id:aO,undoSame:false,redoSame:false,undoArgs:[aK,aG],redoArgs:[aK,aM],undoFn:function(aP,aQ){aP.css("font-size",aQ)},redoFn:function(aP,aQ){aP.css("font-size",aQ)}});break;case BtnCommand.EditContent:aK.focus(function(){M(this).css("white-space","normal")}).focusout(function(){M(this).css("white-space","nowrap")});aF.find(".ui-resizable-handle").show();g.top.$(f).off("click.btnToolHide").on("click.btnToolHide",function(){if(!aK.attr(X.Contenteditable)){aF.unbind("mouseout.showResizable")}});aF.bind("mouseout.showResizable",function(){aF.find(".ui-resizable-handle").show()});break}}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(az){var aD=az.option,aB=az.btn,aF=az.btnContent,aA=[],aC=aD.tipTitle,aE="",ay="";if(aC){ay=' data-title-tip="'+aB.title+'" '}else{aE=' title="'+aB.title+'" '}aA.push('<div command="'+aB.command+'" class="tool f-tool editTool '+aB.className+'" role="button" '+K+" "+aE+" >");if(aF){aA.push(aF)}else{aA.push("<a "+K+' class="editToolIcon f-editToolIcon" command ="'+aB.command+'" '+ay+" ></a>")}aA.push("</div>");return aA};ax.constructor.prototype.createBtnToolDom=function(aA){var aE=aA.option,aD=aA.btn,ay=aA.toolContent,az=aA.reSetUnselectable,aC=[],aB=K;if(az){aB=az}aC.push('<div command="'+aD.command+'" class="tool '+aD.cls+" "+aD.className+'" role="button" data-tool="'+aD.cls+'" '+aB+' title="'+aD.title+'">');if(!ay){aC.push("<a "+aB+' class="fkEditor-tool-icon"></a>')}else{aC.push(ay)}if(typeof(aD.emphasis)!=p&&aD.emphasis){aC.push('<div class="'+aE.css+"-tool-depressedNew "+aE.css+'-tool-depressedNewHover"></div>')}aC.push("</div>");return aC}};return at=new aw()}};_EditBtnBase=new ai();var al=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(){var az=this,aC,aD,ax,ay,aB,aA;az.constructor.prototype.bindToolAndEditorCreatedEvent=function(aE){_EditGlobalLinkBtn.getEventCtrl().bindGlobalLinkPanelEvent(aE);_EditBorderRadiusBtn.getEventCtrl().bindBorderRadiusPanelEvent(aE);_EditOpacityBtn.getEventCtrl().bindOpacityPanelEvent(aE);_EditModuleTitleBtn.getEventCtrl().bindModuleTitlePanelEvent(aE);_EditDescribePicBtn.getEventCtrl().bindDescribePicPanelEvent(aE);_EditBorderBtn.getEventCtrl().bindBorderPanelEvent(aE);_EditShadowBtn.getEventCtrl().bindShadowPanelEvent(aE);_EditFormatsBtn.getEventCtrl().bindFormatSliderEvent(aE);_EditFontSizeBtn.getEventCtrl().bindFontSizeEvent(aE);_EditLineHeightBtn.getEventCtrl().bindLineHeihgtSliderBarEvent(aE);_EditTextAlignBtn.getEventCtrl().bindTextAlignSliderBarEvent(aE);_EditRadiusBtn.getEventCtrl().bindRadiusBtnEvent(aE);_EditBtnBase.getEventCtrl().bindToolBtnEvent(aE);az.bindToolBarEvent(aE);_FkEditor.getEventCtrl().bindEditorEvent(aE);return av};az.constructor.prototype.bindSimpleToolCreatedEvent=function(aE){_EditGlobalLinkBtn.getEventCtrl().bindGlobalLinkPanelEvent(aE);_EditBorderRadiusBtn.getEventCtrl().bindBorderRadiusPanelEvent(aE);_EditOpacityBtn.getEventCtrl().bindOpacityPanelEvent(aE);_EditModuleTitleBtn.getEventCtrl().bindModuleTitlePanelEvent(aE);_EditDescribePicBtn.getEventCtrl().bindDescribePicPanelEvent(aE);_EditBorderBtn.getEventCtrl().bindBorderPanelEvent(aE);_EditShadowBtn.getEventCtrl().bindShadowPanelEvent(aE);_EditRadiusBtn.getEventCtrl().bindRadiusBtnEvent(aE);_EditBtnBase.getEventCtrl().bindToolBtnEvent(aE);az.bindToolBarEvent(aE);return av};az.constructor.prototype.showToolBar=function(aE){var aI=aE.option,aH=aE.editor,aG=aE.module,aJ=M("#fkEditor-toolBar-"+aI.moduleId);if(ar.checkNestModule(aG).inSubNav&&!g.top._subNavPackEdit){return}var aF=ar.hasPopupModuleOpen();if(ar.checkNestModule(aG).inPopupZone&&!(aF&&aF.editing)){return}az.calcuToolBarPos(aE);az.calcuPanelPosForRight(aE);aG.data(u.HoverToolOn,true);if(!aH.data(u.SimpleTextEdit)){az.checkEditItemDisplay(aE);aJ.find(".simpleTextEditTool").hide();aJ.find(".simpleTextHoverTool").show()}};az.constructor.prototype.calcuToolBarPos=function(aP){var aJ=aP.option,aO=aP.editor,aQ=M("#fkEditor-toolBar-"+aJ.moduleId),aG=_EditorBase.getEventCtrl().getModule({option:aJ}),aF=M("#web").offset(),aE=aG.offset(),aK=aE.top,aS=M("#g_main").width(),aH=aE.left,aN=M(".floatLeftTop").offset().top,aT,aR,aM=8,aI=ar.checkNestModule(aG),aL,aU;aQ.css({left:0,top:0});aJ.btnModuleEdit&&(aM+=6);aT=aQ.outerWidth()+2;aR=aH+aT-aS;if(!(aJ.HoverTool&&aJ.HoverTool.show)){simpleTextEdit=true}if(aO.data(u.SimpleTextEdit)){toolBarHeight=parseInt(aJ.Tool.height.replace("px",""))}else{toolBarHeight=parseInt(aJ.HoverTool.height.replace("px",""))}aH=aH-aF.left;aQ.data(u.FixRight,false);if(aR>0){aH=aH-aR-20;aQ.data(u.FixRight,true)}if(aH+aT+135>aS){aQ.data(u.FixRight,true)}aH=aH<0?0:aH;aL=(parseInt(aK-aF.top)-(toolBarHeight+aM))+"px";aU=aH+"px";if(aF.top+aN>aK){aL=parseInt(aK+aG.outerHeight()-aN)+"px"}if(aI.inPopupZone){aL=(parseInt(aK)-(toolBarHeight+aM))+"px";if(toolBarHeight+aM>aK){aL=parseInt(aK+aG.outerHeight()+aM)+"px"}}aQ.css({display:"block",top:aL,left:aU,}).addClass("J_fkEditor_tool").data(u.ModuleId,aJ.moduleId);if(aG.data("corpTitle")||aG.data("logo")){if((g.top._logoPositionFixTop||g.top._titlePositionFixTop)&&aK<=aN){aQ.css({top:parseInt(aK+aG.outerHeight())+"px",position:"fixed"})}else{aQ.css({position:"absolute"})}}return av};az.constructor.prototype.calcuPanelPosForRight=function(aM){var aI=aM.option,aK=aM.editor,aN=M("#fkEditor-toolBar-"+aI.moduleId),aH=aN.find(".simpleTextHoverTool .fkEditorBar"),aO=38,aE,aP,aL,aF,aJ=2,aG=-2;if(aN.data("fixRight")){aN.find(".tool .slideDiv").addClass("f-slideDiv-right");aH.each(function(){aE=M(this).innerWidth();aJ=2;aG=1;if(M(this).hasClass("borderPanel")){aL=_EditBorderBtn._panelHeight}else{if(M(this).hasClass("opacityPanel")){aL=_EditOpacityBtn._panelHeight}else{if(M(this).hasClass("linkPanel")){aL=_EditGlobalLinkBtn._panelHeight;aG=5}else{if(M(this).hasClass("shadowPanel")){aL=_EditShadowBtn._panelHeight}else{if(M(this).hasClass("J_moduleNamePanel")){aL=_EditModuleTitleBtn._panelHeight}else{if(M(this).hasClass("descPanel")){aL=_EditDescribePicBtn._panelHeight}else{if(M(this).hasClass("borderRadiusPanel")){aL=_EditBorderRadiusBtn._panelHeight}}}}}}}aF=-aL;aP=-(aE-aO);if(!isNaN(aL)&&aL>0){M(this).css({top:(aF-aJ)+"px",left:(aP-aG)+"px"})}})}else{aH.css({left:"6px",top:"46px"});aN.find(".simpleTextHoverTool .linkPanel").css({left:"2px",top:"46px"});aN.find(".tool .slideDiv").removeClass("f-slideDiv-right")}};az.constructor.prototype.checkEditItemDisplay=function(aF){var aI=aF.option,aJ=aF.toolbar,aG=aJ.find(".tool-animation"),aE,aK=aI.moduleId,aH;if(typeof aI.animationStatusFun=="function"&&aI.animationStatusFun(aK.replace("module",""))==1){aG.show();aE=aI.HoverTool.animationShowWidth}else{aG.hide();aE=aI.HoverTool.width}aJ.css("width",aE);aJ.css("height",aI.HoverTool.height);aH=aJ.find(".tool-edit-name");if(aH&&aH.length>0){if(ar.getSideStatus(aK)==0){if(!!aH.is(":hidden")){aH.show()}}else{if(!aH.is(":hidden")){aH.hide()}}}return av};az.constructor.prototype.bindToolBarEvent=function(aF){var aI=aF.option,aG=aF.module,aH=aF.editor,aJ=aF.toolbar;aJ.addClass("editorHoverShowTool").unbind("mouseover.hoverShowTool").bind("mouseover.hoverShowTool",function(aK){if(_EditorBase.getEventCtrl().checkEditorEditable(aF)){aG.data(u.HoverToolOn,true).trigger("mouseover");aJ.css("display","block").addClass("J_fkEditor_tool").data(u.ModuleId,aI.moduleId)}clearTimeout(aH.data(u.HoverToolTimeout));clearTimeout(aH.data(u.EditLineTimeout));aG.mouseenter()}).unbind("mouseleave.hoverShowTool").bind("mouseleave.hoverShowTool",function(aK){if(aG.find(".fk-editor-vertical-rl").length<1){aG.trigger("mouseleave")}aG.data(u.HoverToolOn,false)}).off("click.hoverShowTool").on("click.hoverShowTool",function(aK){aK.stopPropagation()});if(!aI.simpleTool){aJ.find(".simpleTextEditTool").not(".tool").off("click.notBtnClick").on("click.notBtnClick",function(){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aI);if(typeof(aH.data(u.Range))!=p){i.getEventCtrl().setSelectRange(aH.data(u.Range))}return false})}var aE=ar.checkNestModule(aG);if(aE.inSubNav){aJ.addClass("showInSubNavPack")}else{if(aE.inPopupZone){aJ.addClass("showInPopupZone")}}};az.constructor.prototype.deleteToolWrapDom=function(aE){var aH=1000,aG=aE.deleteToolBar,aF=aE.option;if(!aG){return av}setTimeout(function(){var aI=aG,aJ=aF;if(!aI.is(":visible")){M(f).unbind("mouseup.fkTool"+aJ.moduleId);az.deleteOrHideToolBar(aJ)}},aH);return av};az.constructor.prototype.deleteOrHideToolBar=function(aI){var aJ=M("#"+aI.css+"-toolBar-"+aI.moduleId),aF=_EditorBase.getEventCtrl().getModule({option:aI}),aH=aF.find("."+aI.css),aG;if(!!aI.btnModuleEdit){aH=aF.find("#"+aI.moduleId+"FlBtn");if(!aH||aH.length<=0){aH=aF.find(".J_floatBtnBox .floatBtn")}}if(typeof(aJ)!=p){if(aI.isHideToolBar){aJ.hide()}else{aJ.remove();aJ=null}if(!aH.data(u.HasRemoveUselessChild)){aG=aH.attr("style");aH.height(aH.height()+"px");aH.data(u.RemoveUselessChildIng,true);ae.getEventCtrl().removeUselessChildStyle(aH,aH);aH.data(u.RemoveUselessChildIng,false);setTimeout(function(){aH.data(u.HasRemoveUselessChild,true)},500);aH.attr("style",aG)}}if(typeof(aF)!=p&&!aI.simpleTool){ar.setSimpleEditorBlur(aF,aH);if(Z.getSelection){Z.getSelection().removeAllRanges()}fkEditorLine=aF.find(".fk-editor-line");if(fkEditorLine.hasClass("fk-editor-bd")){fkEditorLine.addClass("fk-editor-bdNone");fkEditorLine.removeClass("fk-editor-bd")}var aE=aH.html();if(ad[aH.attr("id")]&&ad[aH.attr("id")]!==aE){ar.undoRun(function(){},{undoSame:false,redoSame:false,undoArgs:[aH.attr("id"),ad[aH.attr("id")],aI.showEditTipWord,aI.editTipWord],redoArgs:[aH.attr("id"),aE,aI.showEditTipWord,aI.editTipWord],undoFn:function(aN,aO,aK,aL){var aM=M("#"+aN);aM.html(aO);if(aO.length<=0){if(aK){aM.html('<div class="editTip">'+aL+"</div>")}else{aM.html(aL)}}},redoFn:function(aL,aM){var aK=M("#"+aL);aK.html(aM);if(aM.length<=0){if(showEditTipWord){aK.html('<div class="editTip">'+editTipWord+"</div>")}else{aK.html(editTipWord)}}}});ad[aH.attr("id")]=null}if(M.trim(aH.text()).length<=0){if(aI.showEditTipWord){aH.html('<div class="editTip">'+aI.editTipWord+"</div>")}else{aH.html(aI.editTipWord)}}}};az.constructor.prototype.animateHideToolSecondPanel=function(aO,aG){var aN=M("#"+aO.css+"-toolBar-"+aO.moduleId),aV,aR,aS,aK,aQ,aH,aL,aM,aT,aU,aJ,aI,aE,aF=200,aP=20;if(aN.data(ToolAttr.Scrolling)){return}if(aG!=BtnCommand.BorderRadius){$borderRadiusPanel=aN.find(".tool-borderRadius").find(".borderRadiusPanel");if($borderRadiusPanel.height()>0){$borderRadiusPanel.removeClass("f-borderRadiusPanel-show");aN.find(".tool-borderRadius").find(".slideDiv").removeClass("slideDivBorder")}}if(aG!=BtnCommand.Opacity){aR=aN.find(".tool-opacity").find(".opacityPanel");if(aR.height()>0){aR.removeClass("f-opacityPanel-show");aN.find(".tool-opacity").find(".slideDiv").removeClass("slideDivBorder")}}if(aG!=BtnCommand.ModuleTitleBtn){aQ=aN.find(".tool-edit-name").find(".J_moduleNamePanel");if(aQ.height()>0){aQ.removeClass("f-moduleNamePanel-show");aN.find(".tool-edit-name").find(".slideDiv").removeClass("slideDivModuleName")}}if(aG!=BtnCommand.DescribePicBtn){aH=aN.find(".tool-description").find(".descPanel");if(aH.height()>0){aH.removeClass("f-descPanel-show");aN.find(".tool-description").find(".slideDiv").removeClass("slideDivDesc")}}if(aG!=BtnCommand.Border){aS=aN.find(".tool-border").find(".borderPanel");if(aS.height()>0){aS.removeClass("f-borderPanel-show");aN.find(".tool-border").find(".slideDiv").removeClass("slideDivBorder")}}if(aG!=BtnCommand.Shadow){aK=aN.find(".tool-shadow").find(".shadowPanel");if(aK.height()>0){aK.removeClass("f-shadowPanel-show");aN.find(".tool-shadow").find(".slideDiv").removeClass("slideDivShadow")}}if(aG!=BtnCommand.GlobalLink){aV=aN.find(".tool-link").find("."+aO.css+"-linkSlideBar");if(aV.height()>0){aV.removeClass("linkPanelSlide");clearTimeout(aA);aA=setTimeout(function(){aN.find(".tool-link").find(".slideDiv").removeClass("slideDivBorder");aV.find(".fkEditorBar").removeClass("fkEditorBarBorder")},aF)}}if(aG!=BtnCommand.Formats){aL=aN.find(".tool-formats").find("."+aO.css+"-formatBar");if(aL.height()>0){clearTimeout(aD);aL.removeClass("formatBarSlideDown");aD=setTimeout(function(){aL.parent().find(".fkEditor-tool-iconNew").removeClass("edTriangleOnNew")},aF)}}if(aG!=BtnCommand.FontSize){aM=aN.find(".tool-fontSize").find("."+aO.css+"-formatBar");if(aM.height()>0){aT=aN.find(".tool-fontSize").find(".selectDiv");aT.find("span").attr(X.Contenteditable,false);aM.removeClass("formatBarSlideDown");clearTimeout(aC);aC=setTimeout(function(){aT.find("span").html(aT.find("span").attr("_value")+"px");aM.parent().find(".fkEditor-tool-iconNew").removeClass("edTriangleOnNew")},aF)}}if(aG!=BtnCommand.LineHeight){aU=aN.find(".tool-lineHeight").find("."+aO.css+"-formatBar");if(aU.height()>0){aJ=aN.find(".tool-lineHeight").find(".selectDiv");aJ.find("span").attr(X.Contenteditable,false);aU.removeClass("formatBarSlideDown");clearTimeout(ax);ax=setTimeout(function(){aJ.addClass("selectDivNew");aJ.find("span").html("");aU.parent().find(".fkEditor-tool-iconNew").removeClass("edTriangleOnNew")},aF)}}if(aG!=BtnCommand.TextAlign){aI=aN.find(".tool-textAlign").find("."+aO.css+"-formatBar");if(aI.height()>0){aE=aN.find(".tool-textAlign").find(".selectDiv");aI.removeClass("formatBarSlideDown textAlignSlideDown");clearTimeout(aB);aB=setTimeout(function(){aE.addClass("selectDivNew");aI.parent().find(".fkEditor-tool-iconNew").removeClass("edTriangleOnNew")},aF)}}if(M(".J_faiColorPickerAlp").is(":visible")){M(".J_faiColorPickerAlp").slideUp(aF)}return av};az.constructor.prototype.isShowHoverToolPanel=function(aF){var aE=false;if(aF.find(".tool-link").find(".fkEditor-linkSlideBar").height()>0){aE=true}if(aF.find(".tool-borderRadius").find(".borderRadiusPanel").height()>0){aE=true}if(aF.find(".tool-opacity").find(".opacityPanel").height()>0){aE=true}if(aF.find(".tool-border").find(".borderPanel").height()>0){aE=true}if(aF.find(".tool-shadow").find(".shadowPanel").height()>0){aE=true}if(aF.find(".setRadiusBar").data("radiusSliding")){aE=true}if(aF.find(".tool-edit-name").find(".J_moduleNamePanel").height()>0){aE=true}if(aF.find(".tool-description").find(".descPanel").height()>0){aE=true}return aE};az.constructor.prototype.bindSliderInputEvent=function(aE,aG){var aI,aH,aF;aF=function(aL){var aP,aN,aO;aP={onChange:function(){},maxVal:100,per:"%",minVal:0,maxLength:3};aL=M.extend({},aP,aL);aN=function(){this.cache=[]};aN.prototype.add=function(a1,a0,aY){var aW=this;for(var aX=0,aZ;aZ=a0[aX++];){(function(a3){var a2=a3.split(":");aW.cache.push(function(){var a4=a2.shift();a2.unshift(a1);a2.push(aY);return aO[a4].apply(a1,a2)})})(aZ)}};aN.prototype.start=function(){for(var aW=0,aX;aX=this.cache[aW++];){var aY=aX();if(aY){return aY}}};aO={isNumberKey:function(aW,aX){if(!g.isNumberKey(aW._event)){return aX}},maxLength:function(aW,aY,aX){if(aW._length>=aY){return aX}},maxVal:function(aW,aY,aX){if(aW._value>aY){aS(aW,aY);i.getEventCtrl().popCursorLastDiv(aW);aW.focus();return aX}},minVal:function(aX,aW,aY){if(aX._value<aW){return aY}},isEditable:function(aW,aX){if(aW.hasClass("J_contentEditable contentEditable")){return aX}}};function aV(aW,aX){aX?aW.attr("contenteditable",aX).addClass("J_contentEditable contentEditable"):aW.removeAttr("contenteditable").removeClass("J_contentEditable contentEditable")}function aS(aW,aY,aX){aW.html(aY+(aX||""))}function aQ(aW){return parseInt(aW.html().replace(aL.per,"")||0)||0}function aR(aW,aX){aW._value=aQ(aW);aW._length=aW.html().length;aW._event=aX}function aT(aW,aZ){var aX=new aN();aX.add(aW,["isEditable"],"可编辑状态中");var aY=aX.start();if(aY){return aY}aV(aW,true);aW.html(aQ(aW));i.getEventCtrl().setNodeRange(aW[0]);if(g.isMozilla()){aW.focus()}}function aM(aW,aZ){var aX=new aN();aR(aW,aZ);aX.add(aW,["isNumberKey"],"请输入数字");aX.add(aW,["maxLength:"+aL.maxLength],"数字已达最大长度");var aY=aX.start();if(aY){return false}}function aJ(aW,aZ){var aX=new aN();aR(aW,aZ);aX.add(aW,["maxVal:"+aL.maxVal],"超过最大值");var aY=aX.start();aK(aW,aZ);if(aY){return aY}}function aK(aW,aZ){var aX=new aN();aR(aW,aZ);aX.add(aW,["minVal:"+aL.minVal],"小于最小值");var aY=aX.start();var a0=aQ(aW);if(aY){a0=aL.minVal}aL.onChange(a0)}function aU(aW,aZ){var aX=new aN();aR(aW,aZ);aX.add(aW,["minVal:"+aL.minVal],"小于最小值");var aY=aX.start();var a0=aQ(aW);if(aY){a0=aL.minVal}aS(aW,a0,aL.per);aV(aW,false)}return{click:aT,keypress:aM,keyup:aJ,blur:aU}};aI=function(){var aK=["click"," keypress"," keyup"," blur",""],aJ=".sliderInput";aE.off(aJ).on(aK.join(aJ),function(aL){aL.stopPropagation();return aF(aG)[aL.type](M(this),aL)})};aH=function(){aE.length&&aI();return aE};return aH()};az.constructor.prototype.editToolBarMask=function(aI){var aH={id:aI,useClass:true,leftClass:"fk-dialog-hidden-mask",rightClass:"fk-dialog-hidden-mask",topClass:"fk-dialog-hidden-mask",bottomClass:"fk-dialog-hidden-mask",centerClass:"fk-dialog-center-mask",extFn:[{name:"click.dialogmask",fn:function(){az.removeToolBarDialog(aI)}}]};ar.addModuleMask(aH);var aG=M("#module"+aI),aE=ar.checkNestModule(aG),aF=ar.hasPopupModuleOpen();if(aE.inPopupZone&&aF){M(".fk-dialog-hidden-mask").addClass("fk-dialog-hidden-mask_popupZone")}if(aE.inSubNav&&g.top._subNavPackEdit){M(".fk-dialog-hidden-mask").addClass("fk-dialog-hidden-mask-insubNav")}M("#g_main").off("mousewheel.disabledScroll").on("mousewheel.disabledScroll",function(aJ){setTimeout(function(){ar.addModuleMask(aH)},200)})};az.constructor.prototype.removeToolBarDialog=function(aH,aG){var aF=g.top.$("#module"+aH),aE=ar.checkNestModule(aF);if(!aE.inPopupZone&&ar.hasPopupModuleOpen()){return}ar.checkSimpleTextHideTool();if(M(".moduleMaskContainer").length>0){ar.removeModuleMask()}M("#g_main").off("mousewheel.disabledScroll")};az.constructor.prototype.hideToolBarMask=function(){var aE=M(".fk-dialog-hidden-mask");if(aE.length>0){ar.removeModuleMask()}};az.constructor.prototype.hideHoverTool=function(aE){var aG=aE.option,aF=aE.editor,aH=M("#fkEditor-toolBar-"+aG.moduleId);if(aF.data(u.SimpleTextEdit)){return}if(_EditToolBase.getEventCtrl().isShowHoverToolPanel(aH)){return}if(g.top.$(".popupBg").length<=0){_EditToolBase.getEventCtrl().deleteOrHideToolBar(aG)}else{aG.isHideToolBar=true;_EditToolBase.getEventCtrl().deleteOrHideToolBar(aG);aG.isHideToolBar=false}};az.constructor.prototype.buildSimpleTip=function(aF,aE){var aG=aF.toolbar;aE.off("mouseenter.tips").on("mouseenter.tips",function(){var aH=M(this).attr("data-title-tip");if(!aH){return}if(aG.find(".setRadiusBar").data("radiusSliding")){return}M(this).addClass("f-button-tip-vertical");if(ar.getTopHeight()+48>M(this).offset().top){M(this).removeClass("f-button-top").addClass("f-button-bottom")}else{M(this).addClass("f-button-top").removeClass("f-button-bottom")}}).off("mouseleave.tips").on("mouseleave.tips",function(){M(this).removeClass("f-button-tip-vertical").removeClass("f-button-bottom").removeClass("f-button-tip")})};az.constructor.prototype.hideSimpleTip=function(aE){aE.removeClass("f-button-tip-vertical").removeClass("f-button-bottom").removeClass("f-button-tip")};az.constructor.prototype.editToolLogDog=function(aE){var aF=aE.module,aG=aE.command;if(aF.hasClass("formStyle81")){switch(aG){case BtnCommand.EditContent:ar.logDog(200193,1);ar.inPopupZoneLog(aF,200304,3);break;case BtnCommand.BtnModuleStyle:ar.logDog(200193,2);break;case BtnCommand.Animation:ar.logDog(200193,3);break;case BtnCommand.GlobalLink:ar.logDog(200193,4);break;case BtnCommand.Opacity:ar.logDog(200193,5);break;case BtnCommand.Border:ar.logDog(200193,6);break;case BtnCommand.Shadow:ar.logDog(200193,7);break;case BtnCommand.Radius:ar.logDog(200193,8);break;case BtnCommand.Delete:ar.logDog(200193,9);break;case BtnCommand.Colors:ar.logDog(200193,10);break;case BtnCommand.Bold:ar.logDog(200193,11);break;case BtnCommand.Underline:ar.logDog(200193,12);break;case BtnCommand.Formats:ar.logDog(200193,13);break;case BtnCommand.FontSize:ar.logDog(200193,14);break;case BtnCommand.Dblclick:ar.logDog(200193,15);break;default:break}}else{if(aF.hasClass("formStyle86")){switch(aG){case BtnCommand.EditContent:ar.logDog(200077,1);ar.inPopupZoneLog(aF,200304,1);break;case BtnCommand.Animation:ar.logDog(200077,2);break;case BtnCommand.GlobalLink:ar.logDog(200077,3);break;case BtnCommand.Delete:ar.logDog(200077,4);break;case BtnCommand.Colors:ar.logDog(200077,5);break;case BtnCommand.Bold:ar.logDog(200077,6);break;case BtnCommand.Italic:ar.logDog(200077,7);break;case BtnCommand.Underline:ar.logDog(200077,8);break;case BtnCommand.Formats:ar.logDog(200077,9);break;case BtnCommand.FontSize:ar.logDog(200077,10);break;case BtnCommand.WritingMode:ar.logDog(200077,13);break;case BtnCommand.LineHeight:ar.logDog(200077,14);break;case BtnCommand.TextAlign:ar.logDog(200077,17);break;case BtnCommand.JustifyLeft:ar.logDog(200077,18);break;case BtnCommand.JustifyCenter:ar.logDog(200077,19);break;case BtnCommand.JustifyRight:ar.logDog(200077,20);break;case BtnCommand.SingleClick:ar.logDog(200077,21);break;case BtnCommand.Dblclick:ar.logDog(200077,22);break;case BtnCommand.Linkcreator:ar.logDog(200077,23);break;case BtnCommand.DeleteLink:ar.logDog(200077,24);break;case BtnCommand.InputFontSize:ar.logDog(200077,25);break;case BtnCommand.InputLineHeight:ar.logDog(200077,26);break;case BtnCommand.ChooseFormats:ar.logDog(200077,27);break;case BtnCommand.ChooseLineHeight:ar.logDog(200077,28);break;case BtnCommand.JustifyFull:ar.logDog(200077,30);break;default:break}}else{if(aF.hasClass("corpTitle")){switch(aG){case BtnCommand.EditContent:ar.logDog(200271,1);break;case BtnCommand.GlobalLink:ar.logDog(200271,2);break;case BtnCommand.EditPositionFixed:ar.logDog(200271,3);break;case BtnCommand.EditLogoDisplay:if(g.top.$("#logo").is(":visible")){ar.logDog(200271,4)}else{ar.logDog(200271,5)}break;case BtnCommand.Delete:ar.logDog(200271,6);break;case BtnCommand.Dblclick:ar.logDog(200271,7);break;case BtnCommand.Colors:ar.logDog(200271,8);break;case BtnCommand.Bold:ar.logDog(200271,9);break;case BtnCommand.Italic:ar.logDog(200271,10);break;case BtnCommand.Underline:ar.logDog(200271,11);break;case BtnCommand.Formats:ar.logDog(200271,12);break;case BtnCommand.LineHeight:ar.logDog(200271,13);break;case BtnCommand.TextAlign:ar.logDog(200271,14);break;default:break}}else{if(aF.hasClass("formStyle79")){switch(aG){case BtnCommand.EditPhotoBtn:ar.logDog(200194,2);break;case BtnCommand.ImgEffectBtn:ar.logDog(200194,3);break;case BtnCommand.Animation:ar.logDog(200194,5);break;case BtnCommand.PhotoShapeBtn:ar.logDog(200194,4);break;case BtnCommand.Opacity:ar.logDog(200194,7);break;case BtnCommand.SimpleLinkBtn:ar.logDog(200194,6);break;case BtnCommand.Delete:ar.logDog(200194,8);break;case BtnCommand.Dblclick:ar.logDog(200194,9);break;default:break}}}}}}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ay=this,ax="J_fkSingleTool";ay.constructor.prototype.creatButtonsList=function(aE){var aC=aE.option,aF=aE.buttons,aG=aE.toolbar,aH=aG.find(".simpleTextEditTool"),aD=[],aA,az="moduleName";if(aH.children().length>0){return}for(var aB=0;aB<aF.length;aB++){aA=aF[aB];aE.btn=aA;if(aA[az]=="EditColorBtn"){aD.push(_EditColorBtn.getUICtrl().createBtnToolDom(aE).join(""))}if(aA[az]=="EditBoldBtn"){aD.push(_EditBoldBtn.getUICtrl().createBtnToolDom(aE).join(""))}if(aA[az]=="EditItalicBtn"){aD.push(_EditItalicBtn.getUICtrl().createBtnToolDom(aE).join(""))}if(aA[az]=="EditUnderlineBtn"){aD.push(_EditUnderlineBtn.getUICtrl().createBtnToolDom(aE).join(""))}if(aA[az]=="EditFormatsBtn"){aD.push(_EditFormatsBtn.getUICtrl().createBtnToolDom(aE).join(""))}if(aA[az]=="EditFontSizeBtn"){aD.push(_EditFontSizeBtn.getUICtrl().createBtnToolDom(aE).join(""))}if(aA[az]=="EditWritingModeBtn"){aD.push(_EditWritingModeBtn.getUICtrl().createBtnToolDom(aE).join(""))}if(aA[az]=="EditLineHeightBtn"){aD.push(_EditLineHeightBtn.getUICtrl().createBtnToolDom(aE).join(""))}if(aA[az]=="EditTextAlignBtn"){aD.push(_EditTextAlignBtn.getUICtrl().createBtnToolDom(aE).join(""))}if(aA[az]=="EditLinkBtn"){aD.push(_EditLinkBtn.getUICtrl().createBtnToolDom(aE).join(""))}if(aA[az]=="EditRemoveFormatBtn"){aD.push(_EditRemoveFormatBtn.getUICtrl().createBtnToolDom(aE).join(""))}if(aA[az]=="EditSeperatorBtn"){aD.push(_EditSeperatorBtn.getUICtrl().createHoverBtnToolDom().join(""))}if(aA[az]=="EditBreakLineBtn"){aD.push(_EditBreakLineBtn.getUICtrl().createHoverBtnToolDom().join(""))}_EditBreakLineBtn}aH.append(aD.join(""));return av};ay.constructor.prototype.creatHoverButtonsList=function(aH){var aF=aH.option,aD=aH.hoverShowButtons,aJ=aH.toolbar,aA=aJ.find(".simpleTextHoverTool"),aG=[],aC,az="moduleName",aI,aB=aF.tipTitle;if(aA.children().length>0){return av}for(var aE=0;aE<aD.length;aE++){aC=aD[aE];aH.btn=aC;if(aC[az]=="EditContentBtn"){aG.push(_EditContentBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditFixedPositionBtn"){aG.push(_EditFixedPositionBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditLogoDisplayBtn"){aG.push(_EditLogoDisplayBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditAnimationBtn"){aG.push(_EditAnimationBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditBtnModuleStyleBtn"){aG.push(_EditBtnModuleStyleBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditPhotoBtn"){aG.push(_EditPhotoBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditImgEffectBtn"){aG.push(_EditImgEffectBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditPhotoShapeBtn"){aG.push(_EditPhotoShapeBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditSimpleLinkBtn"){aG.push(_EditSimpleLinkBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditModuleTitleBtn"){aG.push(_EditModuleTitleBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditDescribePicBtn"){aG.push(_EditDescribePicBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditFixedBtn"){aG.push(_EditFixedBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditGlobalLinkBtn"){aG.push(_EditGlobalLinkBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditBorderRadiusBtn"){aG.push(_EditBorderRadiusBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditOpacityBtn"){aG.push(_EditOpacityBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditBorderBtn"){aG.push(_EditBorderBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditShadowBtn"){aG.push(_EditShadowBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditDeleteBtn"){aG.push(_EditDeleteBtn.getUICtrl().createHoverBtnToolDom(aH).join(""))}if(aC[az]=="EditSeperatorBtn"){aG.push(_EditSeperatorBtn.getUICtrl().createHoverBtnToolDom().join(""))}}aA.append(aG.join(""));if(aB){aI=aA.find(".tool .editToolIcon");av.getEventCtrl().buildSimpleTip(aH,aI)}return av};ay.constructor.prototype.buildToolWrapDom=function(aH){var aE=aH.option,aI,aF=aH.editor,aG=[],aB,aI,aD=6,az,aA;if(!aE.moduleId||aE.moduleId<=0){console.log("buildToolWrapDom moduleId err, option.moduleId = "+aE.moduleId);return aI}aI=M("#"+aE.css+"-toolBar-"+aE.moduleId);aA=ar.checkNestModule(M("#"+aE.moduleId));az=aA.inPopupZone?M("body"):M("#web");aB=M("."+ax);for(var aC=0;aC<aB.length;aC++){aB=aB.eq(aC);av.getEventCtrl().deleteToolWrapDom({deleteToolbar:aB,option:aB.data(u.Option)})}aE.btnModuleEdit&&(aD+=6);aG.push('<div id="'+aE.css+"-toolBar-"+aE.moduleId+'" role="toolbar" class="'+ax+" "+aE.css+" "+aE.toolExtClasses+" "+aE.css+"-tool "+aE.css+'DefHeight" style="width:'+aE.toolBarWidth+';">');aG.push('<div style="display:none;"><input maxlength="255" id="simpleTextLinkInputVal-'+aE.moduleId+'"></input></div>');aG.push('<div class="simpleTextHoverTool"></div>');aG.push('<div class="simpleTextEditTool" style="display:none;"></div>');aG.push('<div class="simpleTextCover f-simpleTextCover" style="height:'+aD+'px;"></div>');aG.push("</div>");az.append(aG.join(""));aI=M("#"+aE.css+"-toolBar-"+aE.moduleId);aI.data(u.Option,aE);return aI}};return at=new aw()}};_EditToolBase=new al();var aa=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ay=this,aA,ax,az;ay.constructor.prototype.getModule=function(aB){var aD=aB.option,aC;if(aD.moduleId=="null"||aD.moduleId==0){return}aC=M("#"+aD.moduleId);return aC};ay.constructor.prototype.stopBannerJump=function(aC){var aD=aC.clickEvent,aB=M(aD.target).parentsUntil("#bannerV2",".J_bannerItem");if(aB.length){href=aB.attr("href");target=aB.attr("target");aB.attr("href","javascript:void(0);").attr("target","");setTimeout(function(){aB.attr("href",href).attr("target",target)},0)}};ay.constructor.prototype.logEditorSingleClick=function(aB){var aD=aB.editor,aC=aB.module;clearTimeout(az);az=setTimeout(function(){if(aD.attr(X.Contenteditable)!="true"){_EditToolBase.getEventCtrl().editToolLogDog({module:aC,command:BtnCommand.SingleClick})}},300)};ay.constructor.prototype.setEidtorSelectedRule=function(aC){var aD=aC.editor,aE=aC.command,aB=false;if(aD.text().length<=0){return}if(i.getEventCtrl().getSelectText(aD,true).length<=0){if(aD.data(u.HasRefreshClick)){i.getEventCtrl().setNodeRange(aD[0]);aB=true}else{if(aE!=BtnCommand.Colors&&aE!=BtnCommand.FontSize&&aE!=BtnCommand.LineHeight){i.getEventCtrl().setSelectRange(aD.data(u.Range));aB=true}}}clearTimeout(ax);ax=setTimeout(function(){var aF=aD.data(u.SignClassNum),aH=aD.find("."+aD.data(u.EditSignClass)+aF);if(aD.data(u.HasRefreshClick)||aH.length<=0){var aG=i.getEventCtrl().getSelectText(aD,true).length>0;aD.data(u.HasSelectText,aG);if(aG){i.getEventCtrl().setTagStyle({styleName:"xxxx",styleValue:"",editor:aD,notCreateNewNode:false})}}if(aB){i.getEventCtrl().getSelectText(aD,false)}},100)};ay.constructor.prototype.bindAllEvent=function(aC){var aG=aC.option,aD=aC.module,aF=aC.editor,aH,aB=aC.fkEditorWrap,aE="mouseup.fkTool"+aG.moduleId;aD.unbind("mouseenter.fkModuleEvent").bind("mouseenter.fkModuleEvent",function(aM){if(!M(this).is(":hover")){return}if(ar.checkNestModule(aD).inSubNav&&!g.top._subNavPackEdit){return}if(ar.checkNestModule(aD).inPopupZone&&!(g.top._popupZone&&g.top._popupZone.pZone&&g.top._popupZone.pZone.editing)){return}if(aD.hasClass("ui-resizable-resizing")){return}clearTimeout(aF.data(u.EditLineTimeout));var aL=M(this).find(".fk-editor-line"),aK=M("#"+aG.css+"-toolBar-"+aG.moduleId),aJ,aI;if(aL.hasClass("fk-editor-bdNone")){aL.addClass("fk-editor-bd");aL.removeClass("fk-editor-bdNone")}clearTimeout(aF.data(u.HoverToolTimeout));aC.toolbar=aK;if(aK.length<1){aJ=_EditBtnBase.getEventCtrl().getButtonsData(aC);aC.buttons=aJ;aI=_EditBtnBase.getEventCtrl().getHoverShowButtons(aC);aC.hoverShowButtons=aI;aK=_EditToolBase.getUICtrl().buildToolWrapDom(aC);aC.toolbar=aK;if(aG.EditRadiusBtn){_EditRadiusBtn.getUICtrl().createEditRadiusBtnDom(aC)}_EditToolBase.getUICtrl().creatHoverButtonsList(aC);_EditToolBase.getUICtrl().creatButtonsList(aC);ae.getEventCtrl().setUnselectable(aC);_EditToolBase.getEventCtrl().bindToolAndEditorCreatedEvent(aC);_EditToolBase.getEventCtrl().showToolBar(aC)}if(!aF.data(u.SimpleTextEdit)){_EditToolBase.getEventCtrl().checkEditItemDisplay(aC);aK.find(".simpleTextEditTool").hide();aK.find(".simpleTextHoverTool").show()}ar.createSimpleTextAutoWidthBtn(M(this))}).unbind("mouseleave.fkModuleEvent").bind("mouseleave.fkModuleEvent",function(aJ){var aI=M(this).find(".fk-editor-line"),aK=200;if(!ay.checkEditorEditable(aC)){if(!aF.data(u.SimpleTextEdit)){aF.data(u.EditLineTimeout,setTimeout(function(){aC.fkEditorLine=aI;_EditorBase.getEventCtrl().hideEditLine(aC)},aK))}}if(!aF.data(u.SimpleTextEdit)){aF.data(u.HoverToolTimeout,setTimeout(function(){_EditToolBase.getEventCtrl().hideHoverTool(aC)},aK))}}).unbind("dblclick.fkModuleEvent").bind("dblclick.fkModuleEvent",function(aJ){if(ar.checkNestModule(aD).inSubNav&&!g.top._subNavPackEdit){return}var aI=ar.hasPopupModuleOpen();if(ar.checkNestModule(aD).inPopupZone&&!(aI&&aI.editing)){return}aH=M("#"+aG.css+"-toolBar-"+aG.moduleId);if(aH.find(".simpleTextHoverTool").is(":visible")){aF.data(u.TriggerClick,true);aH.find(".tool-editContentNew .editToolIcon").trigger("click")}_EditToolBase.getEventCtrl().editToolLogDog({module:aD,command:BtnCommand.Dblclick})});if(G){M(f).unbind(aE).bind(aE,function(aI){if(aI.button!=0){return}if(aD.data(u.Mousemove)&&M(".fk-popupWindowVT").length<1){i.getEventCtrl().getSelectText(aF,false)}})}};ay.constructor.prototype.bindSimpleToolAllEvent=function(aB){var aE=aB.option,aC=aB.module,aF,aD=aB.editor;aC.unbind("mouseenter.fkModuleEvent").bind("mouseenter.fkModuleEvent",function(aJ){if(ar.checkNestModule(aC).inSubNav&&!g.top._subNavPackEdit){return}var aI=M("#"+aE.css+"-toolBar-"+aE.moduleId),aH,aG;clearTimeout(aD.data(u.HoverToolTimeout));aB.toolbar=aI;if(aI.length<1){aG=_EditBtnBase.getEventCtrl().getHoverShowButtons(aB);aB.hoverShowButtons=aG;aI=_EditToolBase.getUICtrl().buildToolWrapDom(aB);aB.toolbar=aI;if(aE.EditRadiusBtn){_EditRadiusBtn.getUICtrl().createEditRadiusBtnDom(aB)}_EditToolBase.getUICtrl().creatHoverButtonsList(aB);_EditToolBase.getEventCtrl().bindSimpleToolCreatedEvent(aB);_EditToolBase.getEventCtrl().showToolBar(aB)}else{_EditToolBase.getEventCtrl().showToolBar(aB)}}).unbind("mouseleave.fkModuleEvent").bind("mouseleave.fkModuleEvent",function(aG){var aH=200;if(!aD.data(u.SimpleTextEdit)){aD.data(u.HoverToolTimeout,setTimeout(function(){_EditToolBase.getEventCtrl().hideHoverTool(aB)},aH))}}).unbind("dblclick.fkModuleEvent").bind("dblclick.fkModuleEvent",function(aG){if(ar.checkNestModule(aC).inSubNav&&!g.top._subNavPackEdit){return}if(aE.dblclickFun&&aE.dblclickFun!=""){g.fkEval(aE.dblclickFun)}_EditToolBase.getEventCtrl().editToolLogDog({module:aC,command:BtnCommand.Dblclick})})};ay.constructor.prototype.checkEditorEditable=function(aB){var aD=aB.editor,aC=aD.attr(X.Contenteditable);if(typeof(aC)==p||aC==false||aC=="false"){return false}return true};ay.constructor.prototype.backTextSelected=function(aB){var aC=aB.data(u.SignClassNum),aE=aB.find("."+aB.data(u.EditSignClass)+aC),aD=aB.data(u.HasRefreshClick);if(!aD){i.getEventCtrl().setNodeRange(aE[0])}return av};ay.constructor.prototype.refeshEidtorHeight=function(aC){var aG=aC.option,aF=aC.editor,aD=aC.module;if(aF.hasClass("fk-editor-vertical-rl")){return}var aB=aF[0].clientHeight,aE=aF[0].scrollHeight;if(!aF.data(u.PreScrollHeight)){aF.data(u.PreScrollHeight,aE)}if(aF.data(u.ChangeCount)>aG.changeCount&&(aE>aB||aE!=aF.data(u.PreScrollHeight))&&!aF.data(u.ScrollChangeChecking)){aF.data(u.PreScrollHeight,aE);aF.data(u.ScrollChangeChecking,true);aF.css("height",aE+"px");aD.css("height",aE+"px");aD.attr("_autoheight",0);aD.trigger("mouseover");setTimeout(function(){aF.data(u.ScrollChangeChecking,false)},50)}ay.setEditorAutoHeight(aD.attr("id"))};ay.constructor.prototype.setEditorAutoHeight=function(aC){if(M("#fkEditor-"+aC).length>0&&M("#fkEditor-"+aC).hasClass("fk-editor-vertical-rl")){return}clearTimeout(aA);var aB=200;aA=setTimeout(function(){ar.autoModuleHeight(aC.replace("module",""))},aB);return av};ay.constructor.prototype.hideEditLine=function(aB){var aD=aB.option,aC=aB.editor,aF=aB.fkEditorLine,aE=M("#fkEditor-toolBar-"+aD.moduleId);if(aC.data(u.SimpleTextEdit)){return}if(aE.find(".tool-link").find(".linkPanel").height()>0){return}if(aF.hasClass("fk-editor-bd")){aF.addClass("fk-editor-bdNone");aF.removeClass("fk-editor-bd")}};ay.constructor.prototype.simpleTextFormatPasteData=function(aC,aB){ae.getEventCtrl().filterPasteData(aC);ae.getEventCtrl().textPositionCorrect(aC)}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this};return at=new aw()}};_EditorBase=new aa();var o=function(){var au;var at;var av=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(){var ay=[];ay.push('<div class="seperatorNew"></div>');return ay}};return at=new aw()}};_EditSeperatorBtn=new o();var E=function(){var au;var at;var av=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(){var ay=[];ay.push('<div style="clear:both;"></div>');return ay}};return at=new aw()}};_EditBreakLineBtn=new E();var ac=function(){var au;var at;var av=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(ay){return _EditBtnBase.getUICtrl().createHoverBtnToolDom(ay)}};return at=new aw()}};_EditAnimationBtn=new ac();var ah=function(){var au;var at;var av=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(ay){var aA=ay.btn,az;ay.btnContent="<a "+K+' class="editToolIcon f-editToolIcon" command ="'+aA.command+'">'+aA.title+"</a>";az=_EditBtnBase.getUICtrl().createHoverBtnToolDom(ay);ay.btnContent=null;return az}};return at=new aw()}};_EditBtnModuleStyleBtn=new ah();var a=function(){var au;var at;var av=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.setEditPhotoText=function(az){var aB=az.btn,aC=az.option,aD=aC.moduleId,aA=az.module,ay="";if(aD=="logo"){ay=(g.top.$("#logo").attr("_defaultlogo")==1)?"添加logo":"编辑logo"}else{ay=(aA.data("imgHoverEft")&&aA.data("imgHoverEft").isInit)?"添加图片":"编辑图片"}return ay};ax.constructor.prototype.createHoverBtnToolDom=function(ay){var aA=ay.btn,az,aB=aA.title;aB=ax.setEditPhotoText(ay);ay.btnContent="<a "+K+' class="editToolIcon f-editToolIcon" command ="'+aA.command+'">'+aB+"</a>";az=_EditBtnBase.getUICtrl().createHoverBtnToolDom(ay);ay.btnContent=null;return az}};return at=new aw()}};_EditPhotoBtn=new a();var q=function(){var au;var at;var av=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(ay){return _EditBtnBase.getUICtrl().createHoverBtnToolDom(ay)}};return at=new aw()}};_EditImgEffectBtn=new q();var n=function(){var au;var at;var av=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(ay){return _EditBtnBase.getUICtrl().createHoverBtnToolDom(ay)}};return at=new aw()}};_EditPhotoShapeBtn=new n();var y=function(){var au;var at;var av=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(ay){return _EditBtnBase.getUICtrl().createHoverBtnToolDom(ay)}};return at=new aw()}};_EditSimpleLinkBtn=new y();var l=function(){var au;var at;var av=this;this._panelHeight=47;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ax=this;ax.constructor.prototype.bindModuleTitlePanelEvent=function(aE){var aA=aE.option,az=aE.module,aB=aE.editor,aF=aE.toolbar,aH=aA.moduleId.replace("module",""),aD=aF.find(".tool-edit-name"),ay=aD.find("."+aA.css+"-moduleNameSlideBar"),aC=ay.find(".J_moduleNamePanel"),aG="keyup.moduleTitleSlideBar change.moduleTitleSlideBar";aC.find(".J_module-name-input").off(aG).on(aG,function(){if(aA.moduleTitleFun&&aA.moduleTitleFun!=""){g.fkEval(aA.moduleTitleFun)}})};ax.constructor.prototype.showModuleTitlePanel=function(az){var aC=az.option,aD=az.toolbar,aE=200,aF=aD.find(".tool-edit-name"),aB=aC.moduleId.replace("module",""),ay=aF.find("."+aC.css+"-moduleNameSlideBar"),aA=ay.find(".J_moduleNamePanel");if(aA.height()>0){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aC,BtnCommand.ModuleTitleBtn)}else{aA.addClass("f-moduleNamePanel-show");aF.find(".slideDiv").addClass("slideDivModuleName");_EditToolBase.getEventCtrl().editToolBarMask(aB)}}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(az){var aD=az.option,aB=az.btn,aA=[],aC=aD.tipTitle,ay="";if(aC){ay=' data-title-tip="'+aB.title+'" '}aA.push('<div class="f-module-name-div J_moduleNameDiv slideDiv" '+K+">");aA.push("</div>");aA.push("<a "+K+' class="f-editToolIcon editToolIcon '+aB.command+'-tool-icon" command ="'+aB.command+'" '+ay+" ></a>");aA.push('<div class=" '+aD.css+"-moduleNameSlideBar f-"+aD.css+'-moduleNameSlideBar ">');aA.push('<div class="J_moduleNamePanel f-fkEditorBar fkEditorBar">');aA.push(ax.createModuleTitlePanelDom(aD));aA.push("</div>");aA.push("</div>");aA.push("</div>");az.btnContent=aA.join("");aA=_EditBtnBase.getUICtrl().createHoverBtnToolDom(az);az.btnContent=null;return aA};ax.constructor.prototype.createModuleTitlePanelDom=function(az){var ay="";ay+='<div class="f-descItem">';ay+='<div class="f-descTip">模块标题：</div>';ay+='<div class="f-descSet"><input class="f-module-name-input J_module-name-input"  maxlength="50"/></div>';ay+="</div>";return ay}};return at=new aw()}};_EditModuleTitleBtn=new l();var r=function(){var au;var at;var av=this;this._panelHeight=47;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ax=this;ax.constructor.prototype.bindDescribePicPanelEvent=function(aD){var aB=aD.option,ay=aD.module,aC=aD.editor,aE=aD.toolbar,aH=aB.moduleId.replace("module",""),aI=aE.find(".tool-description"),aA=aI.find("."+aB.css+"-describePicSlideBar"),aF=aA.find(".descPanel"),az="keyup.describePicSlideBar change.describePicSlideBar",aG="";aF.find("#logoDescription").off(az).on(az,function(){if(aB.describePicFun&&aB.describePicFun!=""){g.fkEval(aB.describePicFun)}}).off(".undoLogo").on("focus.undoLogo",function(){aG=M(this).val()}).on("blur.undoLogo",function(){ar.undoRun(function(){},{type:"logo",detail:"logoDescription",undoSame:false,redoSame:false,undoArgs:[aG],redoArgs:[M(this).val()],undoFn:g.top._undo.logoDiscUndo,redoFn:g.top._undo.logoDiscUndo})})};ax.constructor.prototype.showDescribePicPanel=function(az){var aC=az.option,aD=az.toolbar,aF=200,ay=aD.find(".tool-description"),aB=aC.moduleId.replace("module",""),aA=ay.find("."+aC.css+"-describePicSlideBar"),aE=aA.find(".descPanel");if(aE.height()>0){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aC,BtnCommand.DescribePicBtn)}else{aE.addClass("f-descPanel-show");ay.find(".slideDiv").addClass("slideDivDesc");_EditToolBase.getEventCtrl().editToolBarMask(aB)}}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(az){var aD=az.option,aB=az.btn,aA=[],aC=aD.tipTitle,ay="";if(aC){ay=' data-title-tip="'+aB.title+'" '}aA.push('<div class="describeDiv slideDiv" '+K+">");aA.push("</div>");aA.push("<a "+K+' class="f-editToolIcon editToolIcon '+aB.command+'-tool-icon" command ="'+aB.command+'" '+ay+" ></a>");aA.push('<div class=" '+aD.css+"-describePicSlideBar f-"+aD.css+'-describePicSlideBar ">');aA.push('<div class="f-descPanel f-fkEditorBar descPanel fkEditorBar">');aA.push(ax.createDescribePicPanelDom(aD));aA.push("</div>");aA.push("</div>");aA.push("</div>");az.btnContent=aA.join("");aA=_EditBtnBase.getUICtrl().createHoverBtnToolDom(az);az.btnContent=null;return aA};ax.constructor.prototype.createDescribePicPanelDom=function(az){var ay=[];ay.push('<div class="f-descItem">');ay.push('<div class="f-descTip">输入图片描述文字：</div>');ay.push('<div class="f-descSet"><input id="logoDescription" class="f-logoDesPic"  maxlength="50"/></div>');ay.push("</div>");return ay.join("")}};return at=new aw()}};_EditDescribePicBtn=new r();var I=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(ax){var ay=this;ay.constructor.prototype.setFixedLogoBtnTitle=function(aA){var aB=aA.btn,aD=aA.option,aE=aA.toolbar,aC=aD.tipTitle,aF="",az="unfixed";if(!g.top._logoPositionFixTop){aB.removeClass(az);aF="不固定"}else{aB.addClass(az);aF="固定"}if(aC){aB.attr("data-title-tip",aF)}else{aB.attr("title",aF)}}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(az){var aB,aA=az.btn,ay="",aD=az.option,aC=aD.tipTitle;editToolIconExt=g.top._logoPositionFixTop?"":"unfixed";aA.title=g.top._logoPositionFixTop?"不固定":"固定";if(aC){ay=' data-title-tip="'+aA.title+'" '}else{ay=' title="'+aA.title+'" '}az.btnContent="<a "+K+' class="f-editToolIcon editToolIcon '+editToolIconExt+'" command ="'+aA.command+'" '+ay+"></a>";aB=_EditBtnBase.getUICtrl().createHoverBtnToolDom(az);az.btnContent=null;return aB}};return at=new aw()}};_EditFixedBtn=new I();var aq=function(){var au;var at;var av=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createBtnToolDom=function(ay){return _EditBtnBase.getUICtrl().createBtnToolDom(ay)}};return at=new aw()}};_EditBoldBtn=new aq();var Y=function(){var au;var at;var av=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(ay){var aA=ay.btn,az,aB=ay.option;if(aB.btnModuleEdit){ay.btnContent=""}else{ay.btnContent="<a "+K+' class="editToolIcon" command ="'+aA.command+'">'+aA.title+"</a>"}az=_EditBtnBase.getUICtrl().createHoverBtnToolDom(ay);ay.btnContent=null;return az}};return at=new aw()}};_EditContentBtn=new Y();var ao=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(ax){var ay=this;ay.constructor.prototype.checkPositionFixed=function(aA){var aB=aA.btn,aC=aA.option;if(typeof(aC.positionFixedFun)=="function"){function az(){var aD=ay.setFixedPositionBtnTitle(aA);aC.positionFixedFun()}ar.undoRun(az,{type:"logo",detail:"logoFixed"})}};ay.constructor.prototype.setFixedPositionBtnTitle=function(aA){var aB=aA.btn,aD=aA.option,aE=aA.toolbar,aC=aD.tipTitle,aF="",az="editToolIconUnable";if(g.top._titlePositionFixTop){aB.removeClass(az);aF="固定"}else{aB.addClass(az);aF="不固定"}if(aC){aB.attr("data-title-tip",aF)}else{aB.attr("title",aF)}}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(az){var aB,aA=az.btn,ay="",aD=az.option,aC=aD.tipTitle;editToolIconUnable=g.top._titlePositionFixTop?"editToolIconUnable":"";aA.title=g.top._titlePositionFixTop?"不固定":"固定";if(aC){ay=' data-title-tip="'+aA.title+'" '}else{ay=' title="'+aA.title+'" '}az.btnContent="<a "+K+' class="editToolIcon '+editToolIconUnable+'" command ="'+aA.command+'" '+ay+"></a>";aB=_EditBtnBase.getUICtrl().createHoverBtnToolDom(az);az.btnContent=null;return aB}};return at=new aw()}};_EditFixedPositionBtn=new ao();var D=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(ax){var ay=this;ay.constructor.prototype.checkLogoDisplay=function(az){var aA=az.btn,aB=az.option;if(typeof(aB.logoDisplayFun)=="function"){ar.undoRun(aC,{type:"logo",detail:"logoDisplaySwitch"});function aC(){var aD=ay.setLogoDisplayBtnTitle(az);aB.logoDisplayFun(aD)}}};ay.constructor.prototype.setLogoDisplayBtnTitle=function(aB){var aC=aB.btn,aE=aB.option,aG="",aF=aB.toolbar,aD=aE.tipTitle,az="editToolIconUnable",aA=g.top.$("#logo").is(":visible")?true:false;if(aA){aC.addClass(az);aG="显示Logo"}else{aC.removeClass(az);aG="隐藏Logo"}if(aD){aC.attr("data-title-tip",aG)}else{aC.attr("title",aG)}return aA}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(aA){var aC,aB=aA.btn,aE=aA.option,aD=aE.tipTitle,az="",ay=g.top.$("#logo").is(":visible")?true:false,aF=ay?"":"editToolIconUnable";aB.title=ay?"隐藏Logo":"显示Logo";if(aD){az=' data-title-tip="'+aB.title+'" '}else{az=' title="'+aB.title+'" '}aA.btnContent="<a "+K+' class="editToolIcon '+aF+'" command ="'+aB.command+'" '+az+"></a>";aC=_EditBtnBase.getUICtrl().createHoverBtnToolDom(aA);aA.btnContent=null;return aC}};return at=new aw()}};_EditLogoDisplayBtn=new D();var d=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(){var aA=this,ay=false,ax,az,aB;aA.constructor.prototype.initColorBtnBgColor=function(aD){var aF=aD.editor,aE=aD.option,aG=aD.toolbar,aC=aG.find(".tool-color ."+aE.css+"-tool-icon");setTimeout(function(){aC.css("background",aF.css("color"));aC.removeClass("fk-colorPicker-transparentIco")},100)};aA.constructor.prototype.checkColorIsWhite=function(aC){var aE=false;if(typeof(aC)==p||aC=="null"||M.trim(aC).length<=0){return aE}aC=M.trim(aC);aC=aC.toLowerCase();if(aC.indexOf(";")>0){aC=aC.split(";");aC=aC[0]}if(aC.indexOf("white")!=-1||aC.indexOf("#ffffff")!=-1){return aE=true}if(aC.indexOf("rgb")!=-1){if(aC.indexOf("(255, 255, 255)")!=-1){return aE=true}var aD=aC.split(",");if(aD.length>3&&(aC.indexOf(", 0)")!=-1||aC.indexOf(",0)")!=-1)){return aE=true}}return aE};aA.constructor.prototype.simpleTextColorInputHexStatus=function(aN){var aM=aN.editor,aK=aN.option,aD=aN.state,aI=aN.color,aO=aN.rgbaColor,aH=false,aL=false,aG,aF,aE,aJ,aG=i.getEventCtrl().getSelectedNode();if(aM.data(u.HasRefreshClick)&&aD==1){if(M.trim(i.getEventCtrl().getSelectText(aM,true)).length<=0){aM.data(u.NotCreateNewNode,false)}else{aM.data(u.NotCreateNewNode,true)}}aH=aM.data(u.NotCreateNewNode);if(typeof(aH)==p){aH=true}if(aG&&typeof aG.hasClass=="function"&&aG.hasClass("J_colorpicker_hex")){aH=true}if(aD==1&&aH){var aC={styleName:"xxxx",styleValue:"",editor:aM,notCreateNewNode:"false",tTag:"font"};i.getEventCtrl().setTagStyle(aC);setTimeout(function(){i.getEventCtrl().setTagStyle(aC);i.getEventCtrl().getWindowSelection().removeAllRanges()},100)}else{aF=aM.attr("id");aE=aF.substring((aF.indexOf("-")+1));aJ=M("#fkEditor-toolBar-"+aE).find(".tool-color ."+aK.css+"-tool-icon");if(aO&&aO!=""){aJ.css("background",aO);aL=aA.checkColorIsWhite(aO)}else{aJ.css("background",aI);aL=aA.checkColorIsWhite(aI)}if(aL){aJ.css("border","solid 1px #ccc")}else{aJ.css("border","0px")}if(aO&&aO!=""){i.getEventCtrl().setTagStyle({styleName:"color",styleValue:aO,editor:aM,notCreateNewNode:aH,attr2:"color",attr2Value:aI})}else{i.getEventCtrl().setTagStyle({styleName:"color",styleValue:aI,editor:aM,notCreateNewNode:aH,attr2:"color",attr2Value:aI})}}return av};aA.constructor.prototype.backTextSelectedStatus=function(aD){var aF=aD.option,aE=aD.editor;if(!M(".J_faiColorPickerAlp").is(":visible")||!M(".J_advanceColorPicker").data("open")){return av}var aH=aE.data(u.SignClassNum),aI=aE.find("."+aE.data(u.EditSignClass)+aH)[0],aC;if(x){aC=f.createRange();aC.selectNode(aI);am.addRange(aC)}else{if(ag){i.getEventCtrl().setSelectRange(aE.data(u.Range))}else{i.getEventCtrl().setNodeRange(aI)}}var aG=M("#fkEditor-toolBar-"+aF.moduleId);colorBar=aG.find(".tool-color ."+aF.css+"-tool-icon");fontColor=M(aI).css("color");if(aA.checkColorIsWhite(fontColor)){colorBar.css("border","solid 1px #ccc")}else{colorBar.css("border","0px")}colorBar.css("background",fontColor);colorBar.removeClass("fk-colorPicker-transparentIco")}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createBtnToolDom=function(ay){return _EditBtnBase.getUICtrl().createBtnToolDom(ay)}};return at=new aw()}};_EditColorBtn=new d();var H=function(){var au;var at;var av=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(ay){return _EditBtnBase.getUICtrl().createHoverBtnToolDom(ay)}};return at=new aw()}};_EditDeleteBtn=new H();var J=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ay=this,ax;ay.constructor.prototype.showFormatToolBar=function(aB){var aC=aB.option,aD=aB.toolbar,aE=aD.find(".tool-formats"),aA=aE.find("."+aC.css+"-formatBar"),az=aA.height()>0;aA.find(".formatDef").removeClass("formatDef");if(az){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aC)}else{aA.parent().find(".fkEditor-tool-iconNew").addClass("edTriangleOnNew");aA.addClass("formatBarSlideDown");_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aC,BtnCommand.Formats)}return av};ay.constructor.prototype.bindFormatSliderEvent=function(aB){var aE=aB.option,aD=aB.editor,aF=aB.toolbar,aG=aF.find(".tool-formats"),aC=aE.moduleId.replace("module",""),aA=aG.find("."+aE.css+"-formatBar");_SelectedTool.getEventCtrl().bindMousewheelAndSlideEvent({formatbar:aA,toolbar:aF});aA.find("a").click(function(aH){var aI;if(G){aH.stopPropagation();!aE.btnModuleEdit&&i.getEventCtrl().setSelectRange(aD.data(u.Range))}aA.find(".formatDef").removeClass("formatDef");aA.find(".selectedTip").hide();M(this).addClass("formatDef");aG.find(".selectDiv span").attr("title",M(this).attr(aE.css+"-formatName")).html(M(this).attr(aE.css+"-formatName"));if(!!aE.btnModuleEdit){aI={};aI.command=BtnCommand.Formats;aI.val=M(this).attr(aE.css+"-formatval");_EditBtnBase.getEventCtrl().selectChangeForBtnModuel(aB,aI)}else{i.getEventCtrl().setSelection("fontname",M(this).attr(aE.css+"-formatval"))}_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aE);return false}).hover(function(){var aH=M(this),aI;aA.find(".formatDef").removeClass("formatDef");aH.addClass("formatDef");if(aH.find(".formatMg").hasClass("needTip")){aI=aA.find(".selectedTip");aA.find(".selectedTip").show();aI.css({top:((aH[0].getBoundingClientRect().top-aA[0].getBoundingClientRect().top)-parseInt((aI.find(".tipRight").outerHeight()-aH.outerHeight())/2)),left:(parseInt(aH.width())+22)})}},function(){var aH=M(this);if(aH.find(".formatMg").hasClass("needTip")){aA.find(".selectedTip").hide()}});function az(aH){var aI;if(G){aH.stopPropagation();!aE.btnModuleEdit&&i.getEventCtrl().setSelectRange(aD.data(u.Range))}aA.find(".formatDef").removeClass("formatDef");aA.find(".selectedTip").hide();M(this).addClass("formatDef");aG.find(".selectDiv span").attr("title",M(this).attr(aE.css+"-formatName")).html(M(this).attr(aE.css+"-formatName"));if(!!aE.btnModuleEdit){aI={};aI.command=BtnCommand.Formats;aI.val=M(this).attr(aE.css+"-formatval");_EditBtnBase.getEventCtrl().selectChangeForBtnModuel(aB,aI)}else{i.getEventCtrl().setSelection("fontname",M(this).attr(aE.css+"-formatval"))}_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aE);return false}}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createBtnToolDom=function(ay){ay.selectedData=ay.option.EditFormatsBtn.selectedData;return _SelectedTool.getUICtrl().createSelectedSlideToolDom(ay)}};return at=new aw()}};_EditFormatsBtn=new J();var N=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(){var aA=this,az=false,ay,ax;aA.constructor.prototype.showSizeToolBar=function(aG){var aE=aG.option,aI=aG.toolbar,aF=aG.editor,aB=aI.find(".tool-fontSize"),aJ=aB.find(".selectDivNew span"),aC=aB.find("."+aE.css+"-formatBar"),aH=aC.height()>0,aD=300;aC.find(".formatDef").addClass("J_formatDef").removeClass("formatDef");if(aH){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aE)}else{aB.find(".selectDiv span").html(aB.find(".selectDiv span").attr("_value"));aC.parent().find(".fkEditor-tool-iconNew").addClass("edTriangleOnNew");aC.addClass("formatBarSlideDown");aJ.attr(X.Contenteditable,true);clearTimeout(ax);ax=setTimeout(function(){i.getEventCtrl().setNodeRange(aJ[0])},aD);_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aE,BtnCommand.FontSize)}return av};aA.constructor.prototype.bindFontSizeEvent=function(aD){var aG=aD.option,aF=aD.editor,aH=aD.toolbar,aE=aD.module,aC=aH.find(".tool-fontSize"),aI=aC.find(".selectDivNew span"),aB=aC.find("."+aG.css+"-formatBar");_SelectedTool.getEventCtrl().bindMousewheelAndSlideEvent({formatbar:aB,toolbar:aH});_SelectedTool.getEventCtrl().bindInputEvent({element:aI,command:BtnCommand.FontSize,editor:aF,btn:aC,option:aG,module:aE});aB.find("a").click(function(aJ){var aK;_EditToolBase.getEventCtrl().editToolLogDog({module:aE,command:BtnCommand.ChooseFormats});aI.attr(X.Contenteditable,false);i.getEventCtrl().getWindowSelection().removeAllRanges();if(G){aJ.stopPropagation();!aG.btnModuleEdit&&i.getEventCtrl().setSelectRange(aF.data(u.Range))}aC.find(".selectDiv span").attr("_value",M(this).attr(aG.css+"-formatName").replace("px","")).html(M(this).attr(aG.css+"-formatName"));if(!!aG.btnModuleEdit){aK={};aK.command=BtnCommand.FontSize;aK.val=M(this).attr(aG.css+"-formatval");_EditBtnBase.getEventCtrl().selectChangeForBtnModuel(aD,aK)}else{i.getEventCtrl().setTagStyle({styleName:"font-size",styleValue:M(this).attr(aG.css+"-formatval"),editor:aF,notCreateNewNode:true,createNewNodeAction:true})}_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aG);return false}).hover(function(){aB.find(".formatDef").removeClass("formatDef");M(this).addClass("formatDef")})}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createBtnToolDom=function(ay){var az;ay.selectedData=ay.option.EditFontSizeBtn.selectedData;ay.reSetUnselectable=" ";az=_SelectedTool.getUICtrl().createSelectedSlideToolDom(ay);delete ay.reSetUnselectable;return az}};return at=new aw()}};_EditFontSizeBtn=new N();var A=function(){var au;var at;var av=this;this._panelHeight=110;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ax=this;ax.constructor.prototype.bindGlobalLinkPanelEvent=function(aF){var aC=aF.option,az=aF.module,aD=aF.editor,aH=aF.toolbar,ay=aH.find(".tool-link"),aE=ay.find("."+aC.css+"-linkSlideBar"),aA=aE.find(".linkPanel"),aG=150,aB="click.globalLinkBar mouseup.globalLinkBar";if(G){aE.unbind(aB).bind(aB,function(aI){aI.stopPropagation()})}aA.find(".cancel").unbind("click.linkPanelCancel").bind("click.linkPanelCancel",function(){if(aC.cancelGlobalJumpCtrlFun&&aC.cancelGlobalJumpCtrlFun!=""){g.fkEval(aC.cancelGlobalJumpCtrlFun)}_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aC)});aA.find(".confirm").unbind("click.linkPanelConfirm").bind("click.linkPanelConfirm",function(){if(!aC.saveGlobalJumpCtrlFun||aC.saveGlobalJumpCtrlFun==""){return}if(g.fkEval(aC.saveGlobalJumpCtrlFun)){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aC)}aD.trigger("change")});aA.find(".linkDelete").off("mouseenter.linkDeleteHover").on("mouseenter.linkDeleteHover",function(){if(aA.find(".linkSet").find(".jumpHref").val()==""){M(this).addClass("f-deleteDisable")}else{M(this).removeClass("f-deleteDisable")}}).off("click.linkDeleteClick").on("click.linkDeleteClick",function(){_EditToolBase.getEventCtrl().editToolLogDog({module:az,command:BtnCommand.DeleteLink});aA.find(".linkSet").find(".jumpHref").val("").removeAttr("disabled");aA.find(".linkSet").find(".jumpCtrl").attr({_lType:"0",_linkdeleteclick:true}).removeAttr("_lide target _lname _lurl _extJUrl");az.data("jumpIde","");M(this).trigger("mouseenter")})};ax.constructor.prototype.showGlobalLinkPanel=function(az){var aB=az.option,aD=az.toolbar,aF=200,aC=aD.find(".tool-link"),aA=aB.moduleId.replace("module",""),aE=aC.find("."+aB.css+"-linkSlideBar"),ay=aE.find(".linkPanel");if(aE.height()>0){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aB)}else{ay.find(".linkSet").find(".jumpCtrl").removeAttr("_linkdeleteclick");ay.addClass("fkEditorBarBorder");aC.find(".slideDiv").addClass("slideDivBorder");aE.addClass("linkPanelSlide");_EditToolBase.getEventCtrl().editToolBarMask(aA)}}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(az){var aD=az.option,aB=az.btn,aA=[],aC=aD.tipTitle,ay="";if(aC){ay=' data-title-tip="'+aB.title+'" '}aA.push('<div class="linkDiv slideDiv" '+K+">");aA.push("</div>");aA.push("<a "+K+' class="editToolIcon '+aB.command+'-tool-icon" command ="'+aB.command+'" '+ay+" ></a>");aA.push('<div class="'+aD.css+'-linkSlideBar">');aA.push('<div class="linkPanel fkEditorBar">');aA.push(ax.createLinkPanelDom(aD));aA.push("</div>");aA.push("</div>");aA.push("</div>");az.btnContent=aA.join("");aA=_EditBtnBase.getUICtrl().createHoverBtnToolDom(az);az.btnContent=null;return aA};ax.constructor.prototype.createLinkPanelDom=function(az){var ay=[];ay.push('<div class="linkItem">');ay.push('<div class="linkTip">链接地址：</div>');if(!az.btnModuleEdit&&!az.simpleTool){ay.push('<div class="linkSet"><input id="jumpHref'+az.moduleId+'" class="jumpHref" maxlength="255"/></div>');ay.push('<div title="删除" class="linkDelete f-deleteLink" style="display:block;">删除</div>')}else{ay.push('<div class="linkSet"><input id="jumpHref'+az.moduleId.replace("module","")+'" class="jumpHref" maxlength="255"/></div>')}ay.push("</div>");ay.push('<div class="operaItem">');ay.push('<div class="confirm" title="保存链接">确定</div>');ay.push('<div class="cancel" title="取消">取消</div>');ay.push("</div>");return ay.join("")}};return at=new aw()}};_EditGlobalLinkBtn=new A();var m=function(){var au;var at;var av=this;this._panelHeight=45;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ax=this;ax.constructor.prototype.bindBorderRadiusPanelEvent=function(aF){var aQ=aF.option,aC=aF.module,aJ=aF.editor,aP=aF.toolbar,ay=aQ.moduleId.replace("module",""),aW=ar.getModuleAttrPattern(ay).floatBtn,aM=aW.r,aH=aW.s.w||163,aG=aW.s.h||52,aO,aK=aP.find(".tool-borderRadius"),aS=aK.find("."+aQ.css+"-borderRadiusSlideBar"),aI=aS.find(".borderRadiusPanel"),aA=150,aD="click.borderRadiusSlideBar mouseup.borderRadiusSlideBar";var az=aM.lt;if(parseInt(aH/2)>parseInt(aG/2)){aO=parseInt(aG/2)}else{aO=parseInt(aH/2)}var aT=aC.find(".floatBtn"),aR=aM.lt>aO?aO:aM.lt;if(aM.t==0){aR=parseInt(aT.css("borderTopLeftRadius"))}var aN=null;var aL={animate:true,max:aO,min:0,orientation:"horizontal",step:1,value:aR,start:function(aX,aY){aN=aY.value},slide:aU,stop:aV};var aB=aL.value;var aE=90/aO;aI.find(".borderRadiusLhBar").css("width",aB*aE+"px");function aU(aY,aZ){aS.find(".borderRadiusLhBar").css("width",aZ.value*aE+"px");aM.t=2;aM.lb=aZ.value;aM.lt=aZ.value;aM.rb=aZ.value;aM.rt=aZ.value;ar.setFlBtnRadiusChange(ay,aM);var a0=aP.find(".setRadiusBar .ui-slider-handle");var aX=aZ.value;a0.css({left:aX*aE+"px"})}function aV(aX,aY){g.top.Site.getModuleAttrPattern(ay).changed=true;ar.styleChanged();if(aN===null){return}ar.undoRun(aU,{type:"module.floatBtn",detail:"floatBtnBorderRadius",id:ay,doArgs:[null,{value:aY.value}],undoArgs:[null,{value:aN}]});aN=null}setTimeout(function(){aI.find(".borderRadiusBar").slider(aL)},200)};ax.constructor.prototype.showBorderRadiusPanel=function(az){var aB=az.option,aC=az.toolbar,aE=200,aD=aC.find(".tool-borderRadius"),aA=aB.moduleId.replace("module",""),aF=aD.find("."+aB.css+"-borderRadiusSlideBar"),ay=aF.find(".borderRadiusPanel");if(ay.height()>0){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aB,BtnCommand.BorderRadius)}else{ay.addClass("f-borderRadiusPanel-show");aD.find(".slideDiv").addClass("slideDivBorder");_EditToolBase.getEventCtrl().editToolBarMask(aA);ar.logDog(200193,16)}}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(az){var aD=az.option,aB=az.btn,aA=[],aC=aD.tipTitle,ay="";if(aC){ay=' data-title-tip="'+aB.title+'" '}aA.push('<div class="boderRadiusDiv slideDiv" '+K+">");aA.push("</div>");aA.push("<a "+K+' class="f-editToolIcon editToolIcon '+aB.command+'-tool-icon" command ="'+aB.command+'" '+ay+" ></a>");aA.push('<div class="borderRadiusSlideBarForBtnM '+aD.css+"-borderRadiusSlideBar f-"+aD.css+'-borderRadiusSlideBar ">');aA.push('<div class="f-borderRadiusPanel f-fkEditorBar borderRadiusPanel fkEditorBar">');aA.push(ax.createBorderRadiusPanelDom(aD));aA.push("</div>");aA.push("</div>");aA.push("</div>");az.btnContent=aA.join("");aA=_EditBtnBase.getUICtrl().createHoverBtnToolDom(az);az.btnContent=null;return aA};ax.constructor.prototype.createBorderRadiusPanelDom=function(az){var ay=[];ay.push('<div class="borderRadiusBar f-slideBar" ></div>');ay.push('<div class="borderRadiusLhBar f-select-slideBar"></div>');return ay.join("")}};return at=new aw()}};_EditBorderRadiusBtn=new m();var b=function(){var au;var at;var av=this;this._panelHeight=45;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ax=this;ax.constructor.prototype.bindOpacityPanelEvent=function(aC){var aL=aC.option,aB=aC.module,aF=aC.editor,aK=aC.toolbar,ay=aL.moduleId.replace("module",""),aI=aK.find(".tool-opacity"),aP=aI.find("."+aL.css+"-opacitySlideBar"),aO=aP.find(".opacityPanel"),aA=150,aJ="click.opacitySlideBar mouseup.opacitySlideBar";var aH=100-g.top.Site.getModuleAttrPattern(ay).transparent;var az=aO.find(".opacityBar").css("left");aO.find(".inputVal").html(aH+"%");aO.find(".opacityLhBar").css("width",aH+"px");var aN=null;var aE={animate:true,max:90,min:0,orientation:"horizontal",step:1,value:aH,start:function(aQ,aR){aN=aR.value},slide:aG,stop:aM};function aG(aQ,aR){aP.find(".opacityLhBar").css("width",aR.value+"px");aP.find(".inputVal").html(aR.value+"%");ar.refreshFloatImgOpacity(ay,aR.value);g.top.Site.getModuleAttrPattern(ay).transparent=(100-aR.value)}function aM(aQ,aR){if(aN===null){return}ar.undoRun(aD,{type:"module.floatBtn",detail:"floatBtnOpacity",id:ay,doArgs:[aR.value],undoArgs:[aN]});aN=null}setTimeout(function(){aO.find(".opacityBar").slider(aE);_EditToolBase.getEventCtrl().bindSliderInputEvent(aP.find(".inputVal"),{onChange:aD,maxVal:aP.find(".opacityBar").width()});aP.find(".inputVal").off(".undoOpacity").on("focus.undoOpacity",function(){if(g.isNull(aN)){aN=parseInt(M(this).text())}}).on("blur.undoOpactiy",function(){aM(null,{value:parseInt(M(this).text())})})},200);function aD(aQ){aO.find(".opacityBar").slider("value",aQ);aP.find(".opacityLhBar").css("width",aQ+"px");if(!aP.find(".inputVal").hasClass("contentEditable")){aP.find(".inputVal").html(aQ+"%")}ar.refreshFloatImgOpacity(ay,aQ);g.top.Site.getModuleAttrPattern(ay).transparent=(100-aQ);g.top.Site.getModuleAttrPattern(ay).changed=true;ar.styleChanged()}};ax.constructor.prototype.showOpacityPanel=function(az){var aC=az.option,aE=az.toolbar,aF=200,ay=aE.find(".tool-opacity"),aB=aC.moduleId.replace("module",""),aA=ay.find("."+aC.css+"-opacitySlideBar"),aD=aA.find(".opacityPanel");if(aD.height()>0){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aC,BtnCommand.Opacity)}else{aD.addClass("f-opacityPanel-show");ay.find(".slideDiv").addClass("slideDivBorder");_EditToolBase.getEventCtrl().editToolBarMask(aB)}}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(az){var aD=az.option,aB=az.btn,aA=[],aC=aD.tipTitle,ay="";if(aC){ay=' data-title-tip="'+aB.title+'" '}aA.push('<div class="opacityDiv slideDiv" '+K+">");aA.push("</div>");aA.push("<a "+K+' class="f-editToolIcon editToolIcon '+aB.command+'-tool-icon" command ="'+aB.command+'" '+ay+" ></a>");aA.push('<div class="opacitySlideBarForBtnM '+aD.css+"-opacitySlideBar f-"+aD.css+'-opacitySlideBar ">');aA.push('<div class="f-opacityPanel f-fkEditorBar opacityPanel fkEditorBar">');aA.push(ax.createOpacityPanelDom(aD));aA.push("</div>");aA.push("</div>");aA.push("</div>");az.btnContent=aA.join("");aA=_EditBtnBase.getUICtrl().createHoverBtnToolDom(az);az.btnContent=null;return aA};ax.constructor.prototype.createOpacityPanelDom=function(az){var ay=[];ay.push('<div class="opacityBar f-slideBar" ></div>');ay.push('<div class="opacityLhBar f-select-slideBar"></div>');ay.push('<div class="inputVal f-inputVal">0%</div>');return ay.join("")}};return at=new aw()}};_EditOpacityBtn=new b();var z=function(){var au;var at;var av=this;this._panelHeight=55;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ax=this;ax.constructor.prototype.bindBorderPanelEvent=function(aC){var aL=aC.option,aB=aC.module,aF=aC.editor,aI=aC.toolbar,ay=aL.moduleId.replace("module",""),aH=aI.find(".tool-border"),aK=aH.find("."+aL.css+"-borderSlideBar"),aP=aK.find(".borderPanel"),aA=150,aN="click.borderSlideBar mouseup.borderSlideBar";var aO=g.top.Site.getModuleAttrPattern(ay).floatBtn.b;var aE=8,az=0,aJ=1,aR=aO.w||0,aQ=null;if(aO.t==0){aR=0}var aD={animate:true,max:aE,min:az,orientation:"horizontal",step:aJ,value:aR,start:function(aS,aT){aQ=aT.value},slide:aM,stop:aG};aP.find(".setBorderSize").slider(aD);aK.find(".inputVal").html(aR+"px");aK.find(".borderSizeBar").css("width",(aR*11)+"px");aK.find(".borderColor").css("background",aO.c);_EditToolBase.getEventCtrl().bindSliderInputEvent(aK.find(".inputVal"),{onChange:function(aS){aP.find(".setBorderSize").slider("value",aS);aK.find(".borderSizeBar").css("width",(aS*11)+"px");aO.t=2;aO.w=aS;ar.setFlBtnBorderChang(ay,aO);g.top.Site.getModuleAttrPattern(ay).changed=true;ar.styleChanged()},maxVal:aE,per:"px"});aK.find(".inputVal").off(".undoBorder").on("focus.undoBorder",function(){if(g.isNull(aQ)){aQ=parseInt(M(this).text())}}).on("blur.undoBorder",function(){aG(null,{value:parseInt(M(this).text())})});function aM(aS,aT){aK.find(".borderSizeBar").css("width",(aT.value*11)+"px");aO.t=2;aO.w=aT.value;aK.find(".inputVal").html(aT.value+"px");ar.setFlBtnBorderChang(ay,aO)}function aG(aS,aT){g.top.Site.getModuleAttrPattern(ay).changed=true;ar.styleChanged();if(aQ===null){return}ar.undoRun(function(aU){aM(null,{value:aU});aP.find(".setBorderSize").slider("value",aU);aK.find(".borderSizeBar").css("width",(aU*11)+"px")},{type:"module.floatBtn",detail:"floatBtnBorderSize",id:ay,doArgs:[aT.value],undoArgs:[aQ]});aQ=null}aK.find(".borderColor").off("click.b").on("click.b",function(aV){g.isMozilla()&&aV.stopPropagation();function aU(aX){aK.find(".borderColor").css("background",aX);aO.t=2;aO.c=aX;ar.setFlBtnBorderChang(ay,aO);g.top.Site.getModuleAttrPattern(ay).changed=true;ar.styleChanged()}function aS(aY,aX){if(aY==2){aK.find(".borderColor").css("background",aX);aO.t=2;aO.c=aX;ar.setFlBtnBorderChang(ay,aO);g.top.Site.getModuleAttrPattern(ay).changed=true;ar.styleChanged()}}var aT=aO.c;var aW={moduleId:ay,target:aK.find(".borderColor"),inputHexStatus:aS,onchange:aU,changeStop:function(aX){ar.undoRun(aU,{type:"module.floatBtn",detail:"floatBtnBordercolor",id:ay,doArgs:[aX],undoArgs:[aT]})},appendToWeb:true,hideAfterSet:true,__left:328,__top:83};M(aH).find(".editToolIcon").faiColorPickerAlp(aW)})};ax.constructor.prototype.showBorderPanel=function(ay){var aA=ay.option,aC=ay.toolbar,aE=200,aB=aC.find(".tool-border"),az=aA.moduleId.replace("module",""),aD=aB.find("."+aA.css+"-borderSlideBar"),aF=aD.find(".borderPanel");if(aF.height()>0){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aA,BtnCommand.Border)}else{aF.addClass("f-borderPanel-show");aB.find(".slideDiv").addClass("slideDivBorder");_EditToolBase.getEventCtrl().editToolBarMask(az)}}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(az){var aD=az.option,aB=az.btn,aA=[],aC=aD.tipTitle,ay="";if(aC){ay=' data-title-tip="'+aB.title+'" '}aA.push('<div class="borderDiv slideDiv" '+K+">");aA.push("</div>");aA.push("<a "+K+' class="f-editToolIcon editToolIcon '+aB.command+'-tool-icon" command ="'+aB.command+'" '+ay+" ></a>");aA.push('<div class=" '+aD.css+"-borderSlideBar f-"+aD.css+'-borderSlideBar ">');aA.push('<div class="f-borderPanel f-fkEditorBar borderPanel fkEditorBar">');aA.push(ax.createBorderPanelDom(aD));aA.push("</div>");aA.push("</div>");aA.push("</div>");az.btnContent=aA.join("");aA=_EditBtnBase.getUICtrl().createHoverBtnToolDom(az);az.btnContent=null;return aA};ax.constructor.prototype.createBorderPanelDom=function(az){var ay=[];ay.push('<div class="f-item">');ay.push('<div class="f-tip">大小</div>');ay.push('<div class="setBorderSize f-slideBar"></div>');ay.push('<div class="borderSizeBar f-select-slideBar"></div>');ay.push('<div class="inputVal f-inputVal">0px</div>');ay.push("</div>");ay.push('<div class="f-item">');ay.push('<div class="f-tip">颜色</div>');ay.push('<div class="borderColor f-color-select"></div>');ay.push("</div>");return ay.join("")}};return at=new aw()}};_EditBorderBtn=new z();var t=function(){var au;var at;var av=this;this._panelHeight=130;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ax=this;ax.constructor.prototype.bindShadowPanelEvent=function(aD){var aO=aD.option,aB=aD.module,aF=aD.editor,aM=aD.toolbar,ay=aO.moduleId.replace("module",""),aQ=aM.find(".tool-shadow"),aT=aQ.find("."+aO.css+"-shadowSlideBar"),aG=aT.find(".shadowPanel"),aA=150,aN="click.shadowSlideBar mouseup.shadowSlideBar";var aI=g.top.Site.getModuleAttrPattern(ay).floatBtn.sh;var aL=aI.dx,aK=aI.dy,aV=aI.f;if(aI.t==0){aL=0;aK=0;aV=0}var aJ=null;var aE={animate:true,max:110,min:0,orientation:"horizontal",step:1,value:aL,start:function(aW,aX){aJ=M.extend({},aI)},slide:aP,stop:aU};var aS={animate:true,max:110,min:0,orientation:"horizontal",step:1,value:aK,start:function(aW,aX){aJ=M.extend({},aI)},slide:az,stop:aU};var aC={animate:true,max:110,min:0,orientation:"horizontal",step:1,value:aV,start:function(aW,aX){aJ=M.extend({},aI)},slide:aH,stop:aU};aG.find(".setShadowX").slider(aE);aT.find(".J_inputValX").html(aL+"px");_EditToolBase.getEventCtrl().bindSliderInputEvent(aT.find(".J_inputValX"),{onChange:function(aW){aG.find(".setShadowX").slider("value",aW);aT.find(".shadowXBar").css("width",aW+"px");aI.t=2;aI.dx=aW;ar.setFlBtnShadowChange(ay,aI);U(ay)},per:"px",maxVal:aE.max,maxLength:4});aG.find(".setShadowY").slider(aS);aT.find(".J_inputValY").html(aK+"px");_EditToolBase.getEventCtrl().bindSliderInputEvent(aT.find(".J_inputValY"),{onChange:function(aW){aG.find(".setShadowY").slider("value",aW);aT.find(".shadowYBar").css("width",aW+"px");aI.t=2;aI.dy=aW;ar.setFlBtnShadowChange(ay,aI);U(ay)},per:"px",maxVal:aS.max,maxLength:4});aG.find(".setShadowStyle").slider(aC);aT.find(".J_inputValS").html(aV+"px");_EditToolBase.getEventCtrl().bindSliderInputEvent(aT.find(".J_inputValS"),{onChange:function(aW){aG.find(".setShadowStyle").slider("value",aW);aT.find(".shadowStyleBar").css("width",aW+"px");aI.t=2;aI.f=aW;ar.setFlBtnShadowChange(ay,aI);U(ay)},per:"px",maxVal:aC.max});aT.find(".shadowXBar").css("width",(aI.dx)+"px");aT.find(".shadowYBar").css("width",(aI.dy)+"px");aT.find(".shadowStyleBar").css("width",(aI.f)+"px");aT.find(".shadowColor").css("background",aI.c);function aP(aW,aX){aT.find(".shadowXBar").css("width",(aX.value)+"px");aT.find(".J_inputValX").html(aX.value+"px");aI.t=2;aI.dx=aX.value;ar.setFlBtnShadowChange(ay,aI);U(ay)}function az(aW,aX){aT.find(".shadowYBar").css("width",(aX.value)+"px");aT.find(".J_inputValY").html(aX.value+"px");aI.t=2;aI.dy=aX.value;ar.setFlBtnShadowChange(ay,aI);U(ay)}function aH(aW,aX){aT.find(".shadowStyleBar").css("width",(aX.value)+"px");aT.find(".J_inputValS").html(aX.value+"px");aI.t=2;aI.f=aX.value;ar.setFlBtnShadowChange(ay,aI);U(ay)}aT.find(".J_inputValY, .J_inputValY, .J_inputValS").off(".undoShadow").on("focus.undoShadow",function(){if(g.isNull(undoCacheOpacity)){undoCacheOpacity=M.extend({},aI)}}).on("blur.undoShadow",function(){aU()});function aU(aW,aX){ar.undoRun(aR,{type:"module.floatBtn",detail:"floatBtnShadow",id:ay,doArgs:[M.extend({},aI)],undoArgs:[M.extend({},aJ)],});undoCacheOpacity=null}function aR(aW){aT.find(".shadowXBar").css("width",(aW.dx)+"px");aT.find(".J_inputValX").html(aW.dx+"px");aG.find(".setShadowX").slider("value",aW.dx);aT.find(".shadowYBar").css("width",(aW.dy)+"px");aT.find(".J_inputValY").html(aW.dy+"px");aG.find(".setShadowY").slider("value",aW.dy);aT.find(".shadowStyleBar").css("width",(aW.f)+"px");aT.find(".J_inputValS").html(aW.f+"px");aG.find(".setShadowStyle").slider("value",aW.f);M.extend(aI,aW);ar.setFlBtnShadowChange(ay,aI);U(ay)}aT.find(".shadowColor").off("click.s").on("click.s",function(aZ){g.isMozilla()&&aZ.stopPropagation();function aY(a1){aT.find(".shadowColor").css("background",a1);aI.t=2;aI.c=a1;ar.setFlBtnShadowChange(ay,aI);g.top.Site.getModuleAttrPattern(ay).changed=true;ar.styleChanged()}function aX(a2,a1){aT.find(".shadowColor").css("background",a1);aI.t=2;aI.c=a1;ar.setFlBtnShadowChange(ay,aI);g.top.Site.getModuleAttrPattern(ay).changed=true;ar.styleChanged()}var aW=aI.c;var a0={moduleId:ay,target:aT.find(".shadowColor"),inputHexStatus:aX,onchange:aY,changeStop:function(a1){ar.undoRun(aY,{type:"module.floatBtn",detail:"floatBtnColor",id:ay,doArgs:[a1],undoArgs:[aW]});aW=null},appendToWeb:true,hideAfterSet:true,__left:328,__top:143};M(aQ).find(".editToolIcon").faiColorPickerAlp(a0)})};ax.constructor.prototype.showShadowPanel=function(ay){var aB=ay.option,aC=ay.toolbar,aF=200,aA=aC.find(".tool-shadow"),az=aB.moduleId.replace("module",""),aE=aA.find("."+aB.css+"-shadowSlideBar"),aD=aE.find(".shadowPanel");if(aD.height()>0){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aB,BtnCommand.Shadow)}else{aD.addClass("f-shadowPanel-show");aA.find(".slideDiv").addClass("slideDivShadow");_EditToolBase.getEventCtrl().editToolBarMask(az)}}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createHoverBtnToolDom=function(az){var aD=az.option,aB=az.btn,aA=[],aC=aD.tipTitle,ay="";if(aC){ay=' data-title-tip="'+aB.title+'" '}aA.push('<div class="shadowDiv slideDiv" '+K+">");aA.push("</div>");aA.push("<a "+K+' class="f-editToolIcon editToolIcon '+aB.command+'-tool-icon" command ="'+aB.command+'" '+ay+" ></a>");aA.push('<div class=" '+aD.css+"-shadowSlideBar f-"+aD.css+'-shadowSlideBar ">');aA.push('<div class="f-shadowPanel f-fkEditorBar shadowPanel fkEditorBar">');aA.push(ax.createShadowPanelDom(aD));aA.push("</div>");aA.push("</div>");aA.push("</div>");az.btnContent=aA.join("");aA=_EditBtnBase.getUICtrl().createHoverBtnToolDom(az);az.btnContent=null;return aA};ax.constructor.prototype.createShadowPanelDom=function(az){var ay=[];ay.push('<div class="f-item">');ay.push('<div class="f-tip">X轴</div>');ay.push('<div class="setShadowX f-slideBar"></div>');ay.push('<div class="shadowXBar f-select-slideBar"></div>');ay.push('<div class="f-inputVal inputVal J_inputValX"></div>');ay.push("</div>");ay.push('<div class="f-item">');ay.push('<div class="f-tip">Y轴</div>');ay.push('<div class="setShadowY f-slideBar"></div>');ay.push('<div class="shadowYBar f-select-slideBar"></div>');ay.push('<div class="f-inputVal inputVal J_inputValY"></div>');ay.push("</div>");ay.push('<div class="f-item">');ay.push('<div class="f-tip">阴影</div>');ay.push('<div class="setShadowStyle f-slideBar"></div>');ay.push('<div class="shadowStyleBar f-select-slideBar"></div>');ay.push('<div class="f-inputVal inputVal J_inputValS"></div>');ay.push("</div>");ay.push('<div class="f-item">');ay.push('<div class="f-tip">颜色</div>');ay.push('<div class="shadowColor f-color-select"></div>');ay.push("</div>");return ay.join("")}};return at=new aw()}};_EditShadowBtn=new t();var W=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ax=this;ax.constructor.prototype.bindRadiusBtnEvent=function(aC){var aP=aC.option,az=aC.module,aO=aC.toolbar,aK,aQ,aV,aM=false,aH=false,ay=aP.moduleId.replace("module",""),aW=ar.getModuleAttrPattern(ay).floatBtn,aI=aW.r,aF=aW.s.w||163,aD=aW.s.h||52,aN;var aG=aO.find(".tool-borderRadius"),aT=aG.find("."+aP.css+"-borderRadiusSlideBar"),aE=aT.find(".borderRadiusPanel");if(parseInt(aF/2)>parseInt(aD/2)){aN=parseInt(aD/2)}else{aN=parseInt(aF/2)}aK=aO.find(".setRadiusBar");if(aK.length<1){return}var aB=90/aN,aL=null;function aA(aY,aZ){aL=aZ.value;aK.data("radiusSliding",true);_EditToolBase.getEventCtrl().editToolLogDog({module:az,command:BtnCommand.Radius})}function aX(aY,aZ){aI.t=2;aI.lb=aZ.value;aI.lt=aZ.value;aI.rb=aZ.value;aI.rt=aZ.value;ar.setFlBtnRadiusChange(ay,aI);aE.find(".borderRadiusLhBar").css("width",aZ.value*aB+"px");aE.find(".ui-slider-handle").css("left",aZ.value*aB+"px")}function aS(aY,aZ){aK.data("radiusSliding",false);g.top.Site.getModuleAttrPattern(ay).changed=true;ar.styleChanged();M(aZ.handle).blur();if(aL===null){return}ar.undoRun(aX,{type:"module.floatBtn",detail:"floatBtnRadoisBarSliding",id:ay,doArgs:[null,aZ],undoArgs:[null,{vulue:aL}]});aL=null}var aU=az.find(".floatBtn"),aR=aI.lt>aN?aN:aI.lt;if(aI.t==0){aR=parseInt(aU.css("borderTopLeftRadius"))}var aJ={max:aN,min:0,orientation:"horizontal",step:1,value:aR,start:aA,slide:aX,stop:aS};aK.slider(aJ);az.off("mouseover.radius").on("mouseover.radius",function(){aO.find(".setRadiusBar").show()}).off("mouseleave.radius").on("mouseleave.radius",function(){if(aO.find(".setRadiusBar").data("radiusSliding")){return}aO.find(".setRadiusBar").hide()});aK.off("mouseover.radius").on("mouseover.radius",function(){aO.find(".setRadiusBar").show()}).off("mouseleave.radius").on("mouseleave.radius",function(){if(aO.find(".setRadiusBar").data("radiusSliding")){return}aO.find(".setRadiusBar").hide()})}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createEditRadiusBtnDom=function(ay){var aA=ay.option,aB=ay.toolbar,az="",aC;aC=aB.find(".setRadiusBar");if(aC.length>0){return}az+="<div class='setRadiusBar f-setRadiusBar' title='左右拖动改变圆角'></div>";aB.append(az);return av}};return at=new aw()}};_EditRadiusBtn=new W();var L=function(){var au;var at;var av=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createBtnToolDom=function(ay){return _EditBtnBase.getUICtrl().createBtnToolDom(ay)}};return at=new aw()}};_EditItalicBtn=new L();var k=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ay=this,ax;ay.constructor.prototype.setLinkAttr=function(az){var aA=az.element;aA.attr("href",az._lurl);aA.attr("_ltype",az._ltype);aA.attr("_lide",az._lide);aA.attr("_lname",az._lname);aA.attr("target",az._target);return av};ay.constructor.prototype.setChildLink=function(aA){var aC=aA.element,az=aA.wrapStr,aE,aD;if(!aC||aC.text().length<=0||!(aC.find("div").length>0||aC.find("p").length>0)){return}for(var aB=0;aB<aC.children().length;aB++){aE=aC.children().eq(aB);if((aE.find("div").length>0||aE.find("p").length>0)&&aE.text().length>0){ay.setChildLink({element:aE,wrapStr:az})}else{if(aE.text().length>0){aD=M(az).html(aE.html());aE.html(aD)}}}return av};ay.constructor.prototype.handTagANotJump=function(az){az.find("a").each(function(){var aA=M(this).attr("href");if(aA!=p&&aA!=""){M(this).attr("_href",aA);M(this).attr("href","")}})};ay.constructor.prototype.setLinkAll=function(aF){var az=aF.text().length,aA,aM,aB=0;if(az<=0||!aF){return av}if(aF.children().length<=0){if(aF.text().length<=0){return av}aA=aF.prop("tagName").toLowerCase();if(aA!="a"){aM=aF.parent("a");if(aM&&aM.length>=0){aM=aM.clone();aM.text(aF.text());aF.html(aM.prop("outerHTML"))}}return av}for(var aG=0;aG<aF.children().length;aG++){aB+=aF.children().eq(aG).text().length}var aD,aJ,aL="'.?+'",aC,aE,aI,aM,aA,aK,aH;if(az!=aB&&aB>0){aD=aF.clone();aJ=[];for(var aG=0;aG<aD.children().length;aG++){aJ.push(aF.children().eq(aG));aD.children().eq(aG).prop("outerHTML",aL)}aC=[];aE=aD.html();aI=0;aM="";aA=aF.prop("tagName").toLowerCase();if(aA!="a"){aM=aF.parent("a")}else{aM=aF}if(aM&&aM.length>=0){for(var aG=0;aG<aJ.length;aG++){aI=aE.indexOf(aL);if(aI<0||aE.length<=0){break}else{if(aI==0){if(!aJ[aG].attr("style")){aJ[aG].attr("style",aM.attr("style"))}aC.push(aJ[aG].prop("outerHTML"));if(aE.length>aL.length){aE=aE.substring(aL.length,aE.length)}else{aE=""}if(aE.length>0){aI=aE.indexOf(aL);if(aI<0){aH=aM.clone();aH.html(aE);aC.push(aH.prop("outerHTML"));aE=""}else{if(aI>0){aK=aE.substr(0,aI);if(aE.length>aL.length){aE=aE.substring(aL.length,aE.length)}else{aE=""}aH=aM.clone();aH.html(aK);aC.push(aH.prop("outerHTML"))}}}}else{aK=aE.substr(0,aI);aH=aM.clone();aH.html(aK);aC.push(aH.prop("outerHTML"));if(aE.length>aI+aL.length){aE=aE.substring(aI+aL.length,aE.length)}else{aE=""}if(!aJ[aG].attr("style")){aJ[aG].attr("style",aM.attr("style"))}aC.push(aJ[aG].prop("outerHTML"))}}}if(aE.length>0){aH=aM.clone();aH.html(aE);aC.push(aH.prop("outerHTML"))}aF.html(aC.join(""))}}for(var aG=0;aG<aF.children().length;aG++){ay.setLinkAll(aF.children().eq(aG))}return av};ay.constructor.prototype.fkEditorSetLink=function(aM){var aK=aM.editor,aF=aM.jumpCtrl,aD=aM.isGloableLink,aH=aM.option,aA=aH.moduleId;if(!aF){return av}if(aH.editorName=="corpTitle"){ar.saveTitleJumpUrl(aF,aK);return}var aG=aF.attr("_ltype"),aB=aF.attr("_lide"),aN=aF.attr("_lname"),aL=aF.attr("_lurl"),az=aF.attr("target"),aO=aF.attr("_linkdeleteclick"),aC,aJ,aE=false,aI;aK.attr(X.Contenteditable,true);if(aD){i.getEventCtrl().setNodeRange(aK[0]);if(aO=="true"&&(typeof(aB)==p||M.trim(aB)=="")){i.getEventCtrl().setSelection("Unlink");setTimeout(function(){var aP=aK.find("a");for(var aQ=0;aQ<aP.length;aQ++){aLink=aP.eq(aQ);if(aLink.text().length<=0){aLink.remove()}}if(!aK.data(u.SimpleTextEdit)){aK.attr(X.Contenteditable,false)}},300);return}}else{i.getEventCtrl().setSelectRange(aK.data(u.Range))}if(typeof(aL)==p){return}if(aG==108){az=""}aJ=M(i.getEventCtrl().getSelectedNode());if(aJ){aE=aJ.css("color")==aK.css("color")}if(aE){i.getEventCtrl().setTagStyle({styleName:"color",styleValue:"#496EE8",isSetLinkColor:true,editor:aK})}aC=aL+"&_saltLurl";i.getEventCtrl().setSelection(BtnCommand.Createlink,aC);clearTimeout(ax);ax=setTimeout(function(){var aP=aK.find("a"),aQ,aS=aK.attr("style");if(aP.length<=0){return}aK.height(aK.height()+"px");for(var aR=0;aR<aP.length;aR++){aQ=aP.eq(aR);if(aQ.text().length<=0){aQ.remove()}if(aC!=aQ.attr("href")){continue}var aU={element:aQ,_lurl:aL,_ltype:aG,_lide:aB,_lname:aN,_target:az};ay.setLinkAttr(aU);aI="<a href='"+aL+"' _ltype='"+aG+"' _lide='"+aB+"' _lname='"+aN+"' target='"+az+"'>";ay.setChildLink({element:aQ,wrapStr:aI});if(aE){aQ.css("color","#496EE8")}if(x){var aT=ae.getEventCtrl().findTagInParent(aQ,"a",aK.data(u.EndCheckClass));if(aT){ay.setLinkAll(aT)}}}aK.attr("style",aS);if(!aK.data(u.SimpleTextEdit)){aK.attr(X.Contenteditable,false)}var aV=(aA||"").replace("module","");ar.removeQrCode(aV);ar.addQrCode(aV)},500);return av};ay.constructor.prototype.getLinkPreData=function(){var aD=0,aJ=1,aB="",aH="",az="",aE={_ltype:aD,_lide:aB,_lname:aH,_target:az,_moduleType:aJ};if(ag){return aE}var aG=i.getEventCtrl().getWindowSelection(),aF;if(!aG.anchorNode||!aG.getRangeAt){return aE}aF=aG.getRangeAt(0);var aI=M(aF.endContainer).find("a");if(aI.length<=0){aI=M(aF.endContainer).closest("a");if(aI.length<=0){return aE}}for(var aC=0;aC<aI.length;aC++){var aA=aI.eq(aC);if(aA.attr("_lide")&&aA.attr("_lide")!=null){aD=aA.attr("_ltype");aB=aA.attr("_lide");aH=aA.attr("_lname");az=aA.attr("target");break}}return aE={_ltype:aD,_lide:aB,_lname:aH,_target:az,_moduleType:aJ}};ay.constructor.prototype.getCorpTitleLinkPreData=function(){var aF=0,aB=1,aA="",aD="",az="",aC={},aE=g.top._titleData.jm.y;if(g.top._titleData.jm.jName==null){g.top._titleData.jm.jType=0;g.top._titleData.jm.f="";g.top._titleData.jm.y=0}if(aE===1){g.top._titleData.jm.y=2}else{if(aE===0){g.top._titleData.jm.jType=0;g.top._titleData.jm.f="";g.top._titleData.jm.jUrl="";g.top._titleData.jm.jName=""}}aF=g.top._titleData.jm.jType||0;aA=g.top._titleData.jm.f||"",aD=g.top._titleData.jm.jName,az=g.top._titleData.jm.ot==1?"_blank":"";aB=8;return aC={_ltype:aF,_lide:aA,_lname:aD,_target:az,_moduleType:aB}};ay.constructor.prototype.getGlobalLinkPreData=function(aF,aG){var aD=0,aJ=1,aB="",aH="",az="",aE={},aC=aG.option;var aI=aF.find("a"),aA;if(aC.btnModuleEdit||aC.simpleTool){aI=aG.module}if(aI.length>1){aA=aI.eq(0)}else{aA=aI}if(aA.attr("_lide")&&aA.attr("_lide")!=null){aD=aA.attr("_ltype");aB=aA.attr("_lide");aH=aA.attr("_lname");az=aA.attr("target")}return aE={_ltype:aD,_lide:aB,_lname:aH,_target:az,_moduleType:aJ}}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createBtnToolDom=function(ay){return _EditBtnBase.getUICtrl().createBtnToolDom(ay)}};return at=new aw()}};_EditLinkBtn=new k();var T=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(){var az=this,ay=false,ax;az.constructor.prototype.showLineHiehgtToolBar=function(aE){var aD=aE.option,aG=aE.toolbar,aI=aG.find(".tool-lineHeight"),aB=aI.find(".selectDiv"),aH=aI.find(".selectDiv span"),aA=aI.find("."+aD.css+"-formatBar"),aF=aA.height()>0,aC=300;if(aF){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aD)}else{aA.addClass("formatBarSlideDown");aA.find(".formatDef").addClass("J_formatDef").removeClass("formatDef");aB.removeClass("selectDivNew");aB.find("span").html(aB.find("span").attr("_value"));aA.parent().find(".fkEditor-tool-iconNew").addClass("edTriangleOnNew");aH.attr(X.Contenteditable,true);clearTimeout(ax);ax=setTimeout(function(){i.getEventCtrl().setNodeRange(aH[0])},aC);_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aD,BtnCommand.LineHeight)}return av};az.constructor.prototype.bindLineHeihgtSliderBarEvent=function(aE){var aC=aE.option,aD=aE.editor,aF=aE.toolbar,aA=aE.module,aI=aF.find(".tool-lineHeight"),aG=aI.find(".selectDiv span"),aB=aI.find("."+aC.css+"-formatBar"),aH;_SelectedTool.getEventCtrl().bindMousewheelAndSlideEvent({formatbar:aB,toolbar:aF});_SelectedTool.getEventCtrl().bindInputEvent({element:aG,command:BtnCommand.LineHeight,editor:aD,btn:aI,option:aC,module:aA});aB.find("a").click(function(aJ){_EditToolBase.getEventCtrl().editToolLogDog({module:aA,command:BtnCommand.ChooseLineHeight});aG.attr(X.Contenteditable,false);i.getEventCtrl().getWindowSelection().removeAllRanges();if(G){aJ.stopPropagation();i.getEventCtrl().setSelectRange(aD.data(u.Range))}aH=M(this).attr(aC.css+"-formatName").replace("px","");aI.find(".selectDiv span").attr("_value",aH).html(aH);i.getEventCtrl().setTagStyle({styleName:"line-height",styleValue:M(this).attr(aC.css+"-formatval"),editor:aD,notCreateNewNode:true,createNewNodeAction:true});_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aC);return false}).hover(function(){aB.find(".formatDef").removeClass("formatDef");M(this).addClass("formatDef")})}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createBtnToolDom=function(ay){var az;ay.selectedData=ay.option.EditLineHeightBtn.selectedData;ay.reSetUnselectable=" ";az=_SelectedTool.getUICtrl().createSelectedSlideToolDom(ay);delete ay.reSetUnselectable;return az}};return at=new aw()}};_EditLineHeightBtn=new T();var c=function(){var au;var at;var av=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createBtnToolDom=function(ay){return _EditBtnBase.getUICtrl().createBtnToolDom(ay)}};return at=new aw()}};_EditUnderlineBtn=new c();var h=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ax=this;ax.constructor.prototype.adjustWritingModeState=function(az){var aD=az.toolbar,aC=az.option.moduleId,aB=az.option,aA=az.editor,ay=aD.find(".tool-textAlign");if(aA.hasClass("fk-editor-vertical-rl")){aD.find(".tool-lineHeight").find(".selectDiv span").addClass("lrLineHeight-tool-icon");ay.find(".selectDiv span").addClass("lrTextAlign-tool-icon");ay.find("."+aB.css+"-formatBarNew").addClass("lrTextAlign");ay.find(".justifyLeft .fkEditor-tool-icon").addClass("lrTextAlignLeft-tool-icon");ay.find(".justifyLeft").parent().find(".formatMg").text("上对齐");ay.find(".justifyCenter .fkEditor-tool-icon").addClass("lrTextAlignCenter-tool-icon");ay.find(".justifyRight .fkEditor-tool-icon").addClass("lrTextAlignRight-tool-icon");ay.find(".justifyRight").parent().find(".formatMg").text("下对齐");ay.find(".justifyFull .fkEditor-tool-icon").addClass("lrTextAlignFull-tool-icon");aD.find(".tool-writingMode").find(".fkEditor-tool-icon").addClass("lrWritingMode-tool-icon")}else{aD.find(".tool-lineHeight").find(".selectDiv span").removeClass("lrLineHeight-tool-icon");ay.find(".selectDiv span").removeClass("lrTextAlign-tool-icon");ay.find("."+aB.css+"-formatBarNew").removeClass("lrTextAlign");ay.find(".justifyLeft .fkEditor-tool-icon").removeClass("lrTextAlignLeft-tool-icon");ay.find(".justifyLeft").parent().find(".formatMg").text("左对齐");ay.find(".justifyCenter .fkEditor-tool-icon").removeClass("lrTextAlignCenter-tool-icon");ay.find(".justifyRight .fkEditor-tool-icon").removeClass("lrTextAlignRight-tool-icon");ay.find(".justifyRight").parent().find(".formatMg").text("右对齐");ay.find(".justifyFull .fkEditor-tool-icon").removeClass("lrTextAlignFull-tool-icon");aD.find(".tool-writingMode").find(".fkEditor-tool-icon").removeClass("lrWritingMode-tool-icon")}return av};ax.constructor.prototype.switchWritingMode=function(aA){var aJ=aA.option,az=aA.module,aI=aA.toolbar,aQ=aJ.moduleId,aD=aA.editor,aG="",aF,aM="1000",ay="40px",aH="40px",aK="10px",aP=521,aE="10px",aL="1200px",aB=az.width(),aO=az.height(),aF,aN=aD.hasClass("fk-editor-vertical-rl"),aC=az.find(".J_resizableTip");if(aD.length==0){return av}az.css({"min-width":"","min-height":"","max-height":"","max-height":""}).find(".fk-editor").css({"min-width":"","min-height":"","max-height":"","max-height":""});if(aN){aD.removeClass("fk-editor-vertical-rl");az.data(u.OldVHeight,aO);az.css("width",(az.data(u.OldHwidth)||aP)+"px");aD.css("width",az.width()+"px");az.css({"max-height":""}).find(".fk-editor").css({"max-height":""});az.css({"min-height":ay,"min-width":aK,"max-width":aL}).find(".fk-editor").css({"min-height":ay,"min-width":aK,"max-width":aL});ar.absModuleAutoHeight(aQ.replace("module",""))}else{aD.addClass("fk-editor-vertical-rl").attr("_autowidth",1);aC.attr({_faiscoTip:"还原模块默认宽度",onclick:"Site.simpleTextAutoWidth('"+aQ+"');return false;"});az.data(u.OldHwidth,aB);az.css({"max-width":""}).find(".fk-editor").css({"max-width":""});az.css({"min-width":aH,"min-height":aE,"max-height":aL}).find(".fk-editor").css({"min-width":aH,"min-height":aE,"max-height":aL})}ax.adjustWritingModeState(aA);if(!aN){aF=aD.height();az.css("height",(az.data(u.OldVHeight)||220)+"px");aD.css("height",(az.data(u.OldVHeight)||220)+"px");ar.simpleTextAutoWidth(aQ)}if(az.attr("_inpack")!=0){az.find(".fk-editor-vertical-rl").attr("_autowidth",1)}ar.createSimpleTextAutoWidthBtn(az);ar.resizeModule.init(az)}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createBtnToolDom=function(ay){return _EditBtnBase.getUICtrl().createBtnToolDom(ay)}};return at=new aw()}};_EditWritingModeBtn=new h();var aj=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ax=this;ax.constructor.prototype.showTextAlignBtnPanel=function(aA){var aC=aA.option,aD=aA.toolbar,aE=aD.find(".tool-textAlign"),az=aE.find("."+aC.css+"-formatBar"),aB=aE.find(".selectDiv"),ay=az.height()>0;if(ay){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aC)}else{aB.removeClass("selectDivNew");az.find(".formatDef").addClass("J_formatDef").removeClass("formatDef");az.find(".justify").removeClass("justifyLeftHover justifyCenterHover justifyRightHover justifyFullHover");az.parent().find(".fkEditor-tool-iconNew").addClass("edTriangleOnNew");az.addClass("textAlignSlideDown formatBarSlideDown");_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aC,BtnCommand.TextAlign)}return av};ax.constructor.prototype.textAlignEmphasize=function(ay){var aA=ay.editor,aB=ay.toolbar,aD=ay.command,aC=aB.find(".tool-textAlign"),az=aC.find(".selectDiv");switch(aD){case BtnCommand.JustifyLeft:az.removeClass("selectJustifyCenter selectJustifyRight selectJustifyFull");break;case BtnCommand.JustifyCenter:az.addClass("selectJustifyCenter").removeClass("selectJustifyRight selectJustifyFull");break;case BtnCommand.JustifyRight:az.addClass("selectJustifyRight").removeClass("selectJustifyCenter selectJustifyFull");break;case BtnCommand.JustifyFull:az.addClass("selectJustifyFull").removeClass("selectJustifyCenter selectJustifyRight");break;default:break}return av};ax.constructor.prototype.bindTextAlignSliderBarEvent=function(aA){var aD=aA.option,aC=aA.editor,aB=aA.module,aE=aA.toolbar,aF,ay,az=aE.find(".tool-textAlign").find("."+aD.css+"-formatBar");az.find("a").click(function(aG){if(G){aG.stopPropagation();i.getEventCtrl().setSelectRange(aC.data(u.Range))}aF=M(this).attr(aD.css+"-formatval");_EditToolBase.getEventCtrl().editToolLogDog({module:aB,command:aF});ax.constructor.prototype.textAlignEmphasize({editor:aC,toolbar:aE,command:aF});i.getEventCtrl().setSelection(aF);_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aD);return false}).hover(function(){ay=M(this);az.find(".formatDef").removeClass("formatDef");az.find(".justify").removeClass("justifyLeftHover justifyCenterHover justifyRightHover justifyFullHover");ay.addClass("formatDef");aF=ay.attr(aD.css+"-formatval");switch(aF){case BtnCommand.JustifyLeft:ay.find(".justify").addClass("justifyLeftHover");break;case BtnCommand.JustifyCenter:ay.find(".justify").addClass("justifyCenterHover");break;case BtnCommand.JustifyRight:ay.find(".justify").addClass("justifyRightHover");break;case BtnCommand.JustifyFull:ay.find(".justify").addClass("justifyFullHover");break;default:break}})}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createBtnToolDom=function(ay){ay.selectedData=ay.option.EditTextAlignBtn.selectedData;return _SelectedTool.getUICtrl().createSelectedSlideToolDom(ay)}};return at=new aw()}};_EditTextAlignBtn=new aj();var af=function(){var au;var at;var av=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.createBtnToolDom=function(ay){return _EditBtnBase.getUICtrl().createBtnToolDom(ay)}};return at=new aw()}};_EditRemoveFormatBtn=new af();var V=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(){var ax=this;ax.constructor.prototype.getOuterFunc=function(){return aw={fkEditorSetLink:_EditLinkBtn.getEventCtrl().fkEditorSetLink,simpleTextColorInputHexStatus:_EditColorBtn.getEventCtrl().simpleTextColorInputHexStatus,simpleTextFormatPasteData:_EditorBase.getEventCtrl().simpleTextFormatPasteData,deleteOrHideToolBar:_EditToolBase.getEventCtrl().deleteOrHideToolBar,animateHideToolSecondPanel:_EditToolBase.getEventCtrl().animateHideToolSecondPanel}}};return au=new aw()};this.getUICtrl=function(){if(at){return at}return at=new func()}};_EditorOuterFunc=new V();var j=function(){var au;var at;var av=this;this.getEventCtrl=function(){if(au){return au}var aw=function(){var aF=this,ax,aI,aE,aD="keypress.fkeditorClick keyup.fkeditorClick keydown.fkeditorClick drop.fkeditorClick cut.fkeditorClick copy.fkeditorClick paste.fkeditorClick DOMCharacterDataModified.fkeditorClick DOMSubtreeModified.fkeditorClick",ay="change.fkeditorClick",az="click.fkeditorClick",aB="mouseover.fkeditorClick",aA="mouseleave.fkeditorClick",aC="mousedown.fkeditorClick",aG="mousemove.fkeditorClick",aJ="mouseup.fkeditorClick",aH="keyup.fkeditorClick";aF.constructor.prototype.bindEditorEvent=function(aK){var aN=aK.option,aL=aK.module,aM=aK.editor,aO=aK.toolbar,aP=aM.find(".editTip");emphasize=aN.css+"-tool-depressedNew",emphasizeHover=aN.css+"-tool-depressedNewHover",emphasizeShow=aN.css+"-tool-depressedNewShow";aP.unbind("click.editTipbutton").bind("click.editTipbutton",function(){aM.focus()});if(aM.data(u.EditorEventBind)){return}aM.data(u.EditorEventBind,true);aM.unbind(aD).bind(aD,function(aQ){M(this).trigger("change");if(!!aN.btnModuleEdit){if(aQ.which==13){return false}}}).unbind(ay).bind(ay,function(){if(aM.data(u.ChangeCount)>aN.changeCount){if(aM.data(u.SetPageChange)&&g.top._changeStyleNum===0){aM.data(u.SetPageChange,false)}if(aN.pageChangeFun&&aN.pageChangeFun!=""&&!aM.data(u.SetPageChange)&&aM.find(".editTip").length<=0){clearTimeout(ax);ax=setTimeout(function(){if(!aM.data(u.SimpleTextEdit)&&aM.data(u.PreHtmlContent)==""){aM.data(u.PreHtmlContent,aM.html())}if(aM.data(u.PreHtmlContent)!=aM.html()){aM.data(u.SetPageChange,true);g.fkEval(aN.pageChangeFun)}},200)}!aN.btnModuleEdit&&_EditorBase.getEventCtrl().refeshEidtorHeight(aK)}if(M(this).hasClass("fk-editor-vertical-rl")&&M(this).attr("_autoWidth")=="1"){aL.css("width",M(this).width()+"px")}aM.data(u.ChangeCount,(parseInt(aM.data(u.ChangeCount))+1));if(!aM.data(u.RemoveUselessChildIng)){aM.data(u.HasRemoveUselessChild,false)}clearTimeout(aE);aE=setTimeout(function(){_EditToolBase.getEventCtrl().calcuToolBarPos(aK)},300)}).unbind(az).bind(az,function(aQ){_EditColorBtn.getEventCtrl().backTextSelectedStatus(aK);_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aN);!aN.btnModuleEdit&&_EditorBase.getEventCtrl().refeshEidtorHeight(aK);_EditorBase.getEventCtrl().logEditorSingleClick(aK);_EditorBase.getEventCtrl().stopBannerJump({clickEvent:aQ})}).unbind(aB).bind(aB,function(){_EditToolBase.getEventCtrl().showToolBar(aK)}).unbind(aA).bind(aA,function(){aL.data(u.HoverToolOn,false);if(aM.data(u.HasRefreshClick)){i.getEventCtrl().getSelectText(aM,false)}}).unbind(aC).bind(aC,function(aQ){if(aQ.button!=0){return}aL.data(u.Mousemove,false);aL.data(u.Mousedown,true);aL.data(u.ScreenX,aQ.screenX);aL.data(u.ScreenY,aQ.screenY);setTimeout(function(){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aN);_EditBtnBase.getEventCtrl().buttonEmphasize(aK)},100);aM.data(u.HasRefreshClick,true)}).unbind(aG).bind(aG,function(aT){if(!aL.data(u.Mousedown)){return}if(aL.data(u.ScreenX)>0){var aS=aT.screenX,aR=aT.screenY,aQ=Math.pow((aL.data(u.ScreenX)-aS),2)+Math.pow((aL.data(u.ScreenY)-aR),2);if(aQ>1){aL.data(u.Mousemove,true)}}}).unbind(aJ).bind(aJ,function(aS){if(aS.button!=0){return}var aR=aM.attr(X.Contenteditable),aQ;if(!aL.data(u.Mousemove)&&(aR==true||aR=="true")){aL.addClass("formLockEdit");aL.removeClass("fk-hoverModule");aM.focus().find(".editTip").remove();clearTimeout(aI);aI=setTimeout(function(){_EditLinkBtn.getEventCtrl().handTagANotJump(aM);aM.css("cursor","text").attr(X.Contenteditable,true);if(!aM.data(u.FirstChooseEditor)){aM.data(u.FirstChooseEditor,true);ae.getEventCtrl().textPositionCorrect(aM);if(aM.find(".editTip").length>0){aM.data(u.PreHtmlContent,"")}else{aM.data(u.PreHtmlContent,aM.html())}}aM.trigger("mouseover")},50);aM.trigger("mouseover");!aN.btnModuleEdit&&_EditorBase.getEventCtrl().refeshEidtorHeight(aK)}if(!aL.data(u.Mousemove)){aL.data(u.Mousedown,false)}aL.data(u.Mousemove,false)}).unbind(aH).bind(aH,function(){setTimeout(function(){_EditBtnBase.getEventCtrl().buttonEmphasize(aK)},100)}).focus(function(){if(aN.focusFun&&aN.focusFun!=""){g.fkEval(aN.focusFun)}if(S){var aQ=f.createRange();aQ.selectNodeContents(aM[0]);aQ.collapse(false);i.getEventCtrl().setSelectRange(aQ)}}).focusout(function(){var aQ=aO.find(".tool");aL.data(u.Mousedown,false);if(aN.blurFun&&aN.blurFun!=""){g.fkEval(aN.blurFun)}aM.data(u.Onfocused,false)})}};return au=new aw()};this.getUICtrl=function(){if(at){return at}var aw=function(){var ax=this;ax.constructor.prototype.creatFkEditorWrapDom=function(az){var aD=az.option,aB=az.element,ay=aB.parent("."+aD.css+"-wrap"),aC,aA;if(ay.length>0){return}aB.wrap('<div class="'+aD.css+'-wrap"></div>');ay=aB.parent("."+aD.css+"-wrap");aA=[];aA.push('<div id="'+aD.css+"-"+aD.moduleId+'" class="fk-editor fkEditor '+aD.extClasses+'" style="width:'+aD.editorWidth+"; height:"+aD.editorHeight+'; border:0px;" _width="'+aD.editorWidth+'" _height="'+aD.editorHeight+'" onpaste="Site.simpleTextFormatPasteData(event, \''+aD.moduleId+"')\" "+X.Contenteditable+"=false >");if(aD.showEditTipWord){aA.push('<div class="editTip">'+aD.editTipWord+"</div>")}else{aA.push(aB.html())}aA.push("</div>");ay.html(aA.join(""));return av}};return at=new aw()}};_FkEditor=new j();ar.checkSimpleTextHideTool=function(at){if(ar.simpleTextList.checking!=false){return}ar.simpleTextList.checking=true;var au=ar.hasPopupModuleOpen();setTimeout(function(){if(ar.simpleTextList.allEditors){var aK="",ax,ay,aH,aG="",aC,aD,aL,aM,aw=300,aA,av,aI=false,az=false,aE=false,aJ,aB;for(var aF=0;aF<ar.simpleTextList.allEditors.length;aF++){aK=ar.simpleTextList.allEditors[aF]["moduleId"];if(at==aK){continue}ax=g.top.$("#"+aK);aB=ar.checkNestModule(ax);if(au&&!aB.inPopupZone){continue}ay=ax.find("#fkEditor-"+aK);if(!ay||ay.length<1){ay=ar.simpleTextList.allEditors[aF].editor}aI=ay.attr("contenteditable");az=ax.data("hoverToolOn");aE=ax.data("mousedown");aH=g.top.$("#fkEditor-toolBar-"+aK);aM=aH.find(".fkEditor-linkSlideBar");if(_EditToolBase.getEventCtrl().isShowHoverToolPanel(aH)){_EditToolBase.getEventCtrl().deleteOrHideToolBar(ay.data("option"));ax.data(u.Mousedown,false);continue}if(!az&&!aE&&(aI=="true")){aJ=aH.find(".simpleTextHoverTool");aC=aH.find(".tool-formats").find(".fkEditor-formatBar");aD=aH.find(".tool-fontSize").find(".fkEditor-formatBar");fsizebarTextDiv=aH.find(".tool-fontSize").find(".selectDiv");aL=aH.find(".tool-lineHeight").find(".fkEditor-formatBar");lhbarTextDiv=aH.find(".tool-lineHeight").find(".selectDiv");aA=aH.find(".tool-textAlign").find(".fkEditor-formatBar");aG=ar.simpleTextList.colorToolShow;if(aJ.is(":visible")||aC.height()>0||aD.height()>0||aL.height()>0||aA.height()>0||aG){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(ay.data("option"))}else{_EditToolBase.getEventCtrl().deleteOrHideToolBar(ay.data("option"))}}ax.data(u.Mousedown,false)}}},50);setTimeout(function(){ar.simpleTextList.checking=false},300)};ar.simpleTextFormatPasteData=function(ax,aw){var av="",at="";if(ar.simpleTextList.allEditors){for(var au=0;au<ar.simpleTextList.allEditors.length;au++){if(ar.simpleTextList.allEditors[au]["moduleId"]==aw){at=ar.simpleTextList.allEditors[au]["editor"];break}}}setTimeout(function(){_EditorBase.getEventCtrl().simpleTextFormatPasteData(at.data("editor"),av)},20);return true};ar.simpleTextSetJumpCtrl=function(){if(g.top._subNavPackEdit){ar.logDog(200256,11)}var at=g.top.$("#jumpCtrl");var aw=at.data("moduleId");if(!ar.simpleTextList.allEditors){return}for(var au=0;au<ar.simpleTextList.allEditors.length;au++){if(ar.simpleTextList.allEditors[au]["moduleId"]==aw){var av=ar.simpleTextList.allEditors[au]["editor"];_EditLinkBtn.getEventCtrl().fkEditorSetLink({editor:av.data("editor"),option:av.data("option"),jumpCtrl:at,isGloableLink:false});break}}};ar.simpleTextSetTextColor=function(at,av){var au=ar.simpleTextList.chooseEditor;if(au){_EditColorBtn.getEventCtrl().simpleTextColorInputHexStatus({state:2,editor:au.data("editor"),option:au.data("option"),color:at,rgbaColor:av})}};ar.simpleTextColoronShowStatus=function(at){var au=at==1?true:false;ar.simpleTextList.colorToolShow=au;setTimeout(function(){ar.simpleTextList.colorToolShow=!au},200)};ar.simpleTextShowGlobalJumpCtrl=function(au,at){var at={showFullMeasure:true,inputId:"jumpHref"+au,jumpCusId:"jumpCtrl"+au,moduleType:at._moduleType,jumpType:at._ltype,jumpIde:at._lide,jumpName:at._lname,jumpTarget:at._target,showWeixinService:true};ar.jumpControl(at)};ar.saveTitleJumpUrl=function(av,aw){if(av.length<1){return}var az=g.top._titleData,ay=g.top.$("#corpTitle"),au=av.attr("_lurl"),ax=av.attr("_linkdeleteclick"),at=parseInt(av.attr("_ltype"));if(typeof(au)==p&&!ax){return}if(at==108){az.jm.ot=0}else{az.jm.ot=av.attr("target")=="_blank"?1:0}if(au!=null){az.jm.f=av.attr("_lide");az.jm.jType=at;az.jm.jUrl=au;az.jm.y=2;if(at===2||at===103){az.jm.jName=au}else{az.jm.jName=av.attr("_lname")||az.jm.jName}ay.attr("_href",au);ay.css("cursor","pointer")}else{az.jm.jType=0;az.jm.f="";az.jm.y=0;ay.removeAttr("_href");ay.css("cursor","move")}g.top._titleChanged++;ar.styleChanged();aw.attr(X.Contenteditable,false);return true};ar.simpleTextSaveJumpCtrl=function(aw){var at=g.top.$("#jumpCtrl"+aw);if(!ar.simpleTextList.allEditors){return false}for(var au=0;au<ar.simpleTextList.allEditors.length;au++){if(ar.simpleTextList.allEditors[au]["moduleId"]==aw){var av=ar.simpleTextList.allEditors[au]["editor"];_EditLinkBtn.getEventCtrl().fkEditorSetLink({editor:av.data("editor"),option:av.data("option"),jumpCtrl:at,isGloableLink:true});g.top.$("#fkEditor-"+aw).attr(X.Contenteditable,false);return true}}return false};ar.simpleTextShowJumpCtrl=function(au,at){g.top.$("#jumpCtrl").remove();var at={showFullMeasure:true,inputId:"simpleTextLinkInputVal-"+au,moduleType:at._moduleType,jumpType:at._ltype,jumpIde:at._lide,jumpName:at._lname,jumpTarget:at._target,setPageChange:ar.simpleTextSetJumpCtrl,showWeixinService:true};ar.jumpControl(at);setTimeout(function(){g.top.$("#jumpCtrl").data("moduleId",au).click()},300)};M(function(){var at="click.simpleTextBodyClick";M(g.top.document.body).children().unbind(at).bind(at,function(au){if(au.button!=0){return}ar.checkSimpleTextHideTool()});M(g.top.document).live("mouseup.simpleTextScrollingMouseup",function(){var au=M(".J_fkSingleTool");if(au.length<=0&&!au.data(ToolAttr.Scrolling)){return}setTimeout(function(){au.data(ToolAttr.Scrolling,false)},0)})});function U(at){g.top.Site.getModuleAttrPattern(at).changed=true;ar.styleChanged()}M.fn.fkEditor=function(ax){var aw={moduleId:"module0",editorName:"",css:"fkEditor",endCheckClass:"fkEditor-wrap",editSignClass:"fk-c-",btnModuleEdit:false,simpleTool:false,tipTitle:false,editorWidth:"200px",editorHeight:"60px",defultContent:"",showEditTipWord:false,editTipWord:"双击输入内容...",changeCount:1,systemModule:"",extClasses:"",toolExtClasses:"",isSystemModule:false,toolBarWidth:"154px",changeFun:"",focusFun:"",blurFun:"",pageChangeFun:"",deleteFun:"",jumpCtrlFun:"",globalJumpCtrlFun:"",saveGlobalJumpCtrlFun:"",cancelGlobalJumpCtrlFun:"",animationFun:"",editModuleFun:"",positionFixedFun:"",logoDisplayFun:"",EditContentBtn:{name:"编辑文本"},EditFormatsBtn:{name:"字体",selectedData:[["宋体, SimSun","宋体"],["新细明体, PMingLiU","新细明体"],["仿宋_GB2312,FangSong_GB2312","仿宋_GB2312"],["微软雅黑, Microsoft YaHei","微软雅黑"],["Arial,微软雅黑","Arial"],["隶书, SimLi","隶书"],["幼圆","幼圆"],["华文楷体 ,STKaiti","华文楷体"],["方正舒体","方正舒体"],["华文行楷","华文行楷"],["华文彩云","华文彩云"],["华文宋体","华文宋体"],["楷体,楷体_GB2312,SimKai","楷体"],["黑体, SimHei","黑体"],["Tahoma, 微软雅黑","Tahoma"],["impact, 微软雅黑","impact"],["Arial Serif, 微软雅黑","Arial Serif"],["Times New Roman, 微软雅黑","Times New Roman"],["Georgia, 微软雅黑","Georgia"],["Garamond, 微软雅黑","Garamond"],["andale mono, 微软雅黑","andale mono"],["arial black, avant garde, 微软雅黑","arial black"],["comic sans ms, 微软雅黑","comic sans ms"],["Aa甜甜圈, 微软雅黑","甜甜圈","","needTip"],["字体管家幻影伯爵, 微软雅黑","幻影伯爵","","needTip"],["字体管家润行, 微软雅黑","润行","","needTip"],["字体管家棉花糖, 微软雅黑","棉花糖","","needTip"],["Aa鬼泣, 微软雅黑","鬼泣","","needTip"],["字体管家版宋, 微软雅黑","版宋","","needTip"],["Aa夕禾, 微软雅黑","夕禾","","needTip"],["思源黑体 CN Light, 微软雅黑","思源黑体 Light","","needTip"],["思源黑体 CN Medium, 微软雅黑","思源黑体 Medium","","needTip"],["思源黑体 CN Heavy, 微软雅黑","思源黑体 Heavy","","needTip"],["思源宋体 CN Light, 微软雅黑","思源宋体 Light","","needTip"],["思源宋体 CN Medium, 微软雅黑","思源宋体 Medium","","needTip"],["思源宋体 CN Heavy, 微软雅黑","思源宋体 Heavy","","needTip"],["站酷高端黑, 微软雅黑","站酷高端黑","","needTip"],["站酷酷黑, 微软雅黑","站酷酷黑","","needTip"],["站酷快乐体2016修订版, 微软雅黑","站酷快乐体","","needTip"],["庞门正道标题体, 微软雅黑","庞门正道标题体","","needTip"],["AaBiaoTiChuYuan, 微软雅黑","Aa粗圆","","needTip"],["字体管家波点, 微软雅黑","Aa波点","","needTip"],["Aa语文老师的字, 微软雅黑","Aa林老师的字","","needTip"],["站酷小薇LOGO体, 微软雅黑","站酷小薇","","needTip"],["'ZCOOL Addict 01', 微软雅黑","ZCOOL Addict Italic 01","","needTip"],["'ZCOOL Addict 02', 微软雅黑","ZCOOL Addict Italic 02","","needTip"]]},EditFontSizeBtn:{name:"大小",selectedData:[["12px","12px"],["14px","14px"],["16px","16px"],["18px","18px"],["20px","20px"],["24px","24px"],["30px","30px"],["36px","36px"],["48px","48px"],["60px","60px"],["72px","72px"],["84px","84px"],["96px","96px"],["108px","108px"],["120px","120px"]]},EditLineHeightBtn:{name:"行高",selectedData:[["12px","12px"],["14px","14px"],["16px","16px"],["18px","18px"],["20px","20px"],["24px","24px"],["30px","30px"],["36px","36px"],["48px","48px"],["60px","60px"],["72px","72px"],["84px","84px"],["96px","96px"],["108px","108px"],["120px","120px"]]},EditTextAlignBtn:{name:"对齐方式",selectedData:[["justifyLeft","左对齐","justify justifyLeft"],["justifyCenter","居中对齐","justify justifyCenter"],["justifyRight","右对齐","justify justifyRight"],["justifyFull","两端对齐","justify justifyFull"]]},HoverTool:{show:true,width:"154px",animationShowWidth:"186px",height:"42px",ToolBtnOrder:["EditContentBtn","EditSeperatorBtn","EditAnimationBtn","EditGlobalLinkBtn","EditDeleteBtn"]},Tool:{show:true,width:"300px",height:"82px",ToolBtnOrder:["EditColorBtn","EditFormatsBtn","EditFontSizeBtn","EditBreakLineBtn","EditBoldBtn","EditItalicBtn","EditUnderlineBtn","EditSeperatorBtn","EditWritingModeBtn","EditLineHeightBtn","EditTextAlignBtn","EditSeperatorBtn","EditLinkBtn","EditRemoveFormatBtn"]}};var aA=M.extend(aw,ax),at=M(this),az,av,au,ay=_EditorBase.getEventCtrl().getModule({option:aA});if(!ay||ay.length<=0){return}x?aA.changeCount++:"";if(aA.btnModuleEdit){az=ay.find("#"+aA.moduleId+"FlBtn");if(!az||az.length<=0){az=ay.find(".J_floatBtnBox .floatBtn")}av=az;_EditorBase.getEventCtrl().bindAllEvent({option:aA,module:ay,editor:az,fkEditorWrap:av})}else{if(aA.simpleTool){az=ay;az.data(u.SimpleTextEdit,false);_EditorBase.getEventCtrl().bindSimpleToolAllEvent({option:aA,module:ay,editor:az})}else{_FkEditor.getUICtrl().creatFkEditorWrapDom({option:aA,element:at});az=M("#"+aA.css+"-"+aA.moduleId);av=at.parent("."+aA.css+"-wrap");_EditorBase.getEventCtrl().bindAllEvent({option:aA,module:ay,editor:az,fkEditorWrap:av})}}az.data(u.ScrollChangeChecking,false);az.data(u.Onfocused,false);az.data(u.SetPageChange,false);az.data(u.LinkHasClick,false);az.data(u.ClearSpanCursoring,false);az.data(u.HasRefreshClick,false);az.data(u.PreHtmlContent,"");az.data(u.HasRsChildStyle,0);az.data(u.EditSignClass,aA.editSignClass);az.data(u.SignClassNum,1);az.data(u.ChangeCount,0);az.data(u.FirstChooseEditor,false);az.data(u.HasRemoveUselessChild,true);az.data(u.RemoveUselessChildIng,false);az.data(u.EndCheckClass,aA.endCheckClass);az.data(u.EditorEventBind,false);az.data(u.Option,aA);az.data(u.OuterFun,_EditorOuterFunc.getEventCtrl().getOuterFunc());az.data(u.Editor,az);ar.simpleTextList.allEditors.push({moduleId:aA.moduleId,editor:az});return az}})(jQuery,window,document,Fai?Fai:{},"undefined");