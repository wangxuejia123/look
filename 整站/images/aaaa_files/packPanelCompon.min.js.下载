(function(g,n,t){t.commData=t.commData||{};t.commFun=t.commFun||{};var q=t.commData,l=t.commFun;q.subNavPackModule={historyModules:[]};var w={tabText:"设置模块",compon:"packModuleAddCompon",isActive:true};var a={tabText:"历史模块",compon:"historyModuleCompon",isActive:false};t.packPanelDef={module:[{tab:w},{tab:a}]};l.bindContentScrollBar=function(y,z){setTimeout(function(){n.top.$(y).mCustomScrollbar({mouseWheel:true,theme:"fk-gray",scrollbarPosition:"outside",advanced:{updateOnContentResize:true},axis:"y"});if(typeof z=="function"){z()}},400)};l.bgColorPickerClick=function(z){var A=z.base;if(A.length<1){return}z.advance=true;z.showInTop=false;z.appendToWeb=true;var y=z.onchange;z.inputHexStatus=function(C,B){y.call(null,B||C)};z.onchange=function(C,B){y.call(null,B||C)};g(this.$el).faiColorPickerAlp(z)};var x=t.packPanelDef;Vue.component("fk-packpanel",{props:["curpanel","panelleft"],data:function(){return{packPanelDef:x,switchOn:false,animateSart:false,packOuterPanelStyle:{}}},computed:{curPanel:function(){return this.packPanelDef.module},curTab:function(){var z=this.curPanel,A=0,y=z.length;for(;A<y;A++){if(z[A].tab.isActive){return z[A].tab}}return z[0].tab},curTabIndex:function(){var A=this.curPanel,y=this.curTab,B=0,z=A.length;for(;B<z;B++){if(A[B].tab.compon==y.compon){return B}}return 0},triangleActiveStyle:function(){var A=this.curTabIndex;var z=83,y=A*z+z/2-7;return{left:y+"px"}}},watch:{curTabIndex:function(z,y){if(y<z){this.animateSart=true}else{this.animateSart=false}}},template:"<div class='packOuterPanel' @click='packPanelClick' :style='{left:panelleft + \"px\"}'><div class='packMainNav'><div class='curMainSetingNav'><div class='mainSettingTab' v-for='(item, index) in curPanel' @click='tabClick(item.tab, index)'>{{item.tab.tabText}}</div><div class='triangleActive' :style='triangleActiveStyle'></div></div><div class='closeFunPanel' @click='closeFunPanel'></div></div><div class='packSettingContent' :class='{outPanelAnimateStart:animateSart}'><transition name='translate-fade' mode='out-in'><keep-alive><component :is='curTab.compon' packpaneldef='packPanelDef'></component></keep-alive></transition></div></div>",methods:{tabClick:function(z,y){this.curTab.isActive=false;z.isActive=true;this.curTab=z},packPanelClick:function(){this.switchOn=false},closeFunPanel:function(){Site.logDog(200256,16);t["packPanel"+Site.inSubNavPackEdit.colId].panelOpen=false;Site.inSubNavPackEdit.exitSubNavPackEdit()}},mounted:function(){Site.inSubNavPackEdit.colIdActivedArr=Site.inSubNavPackEdit.colIdActivedArr||[];if(g.inArray(Site.inSubNavPackEdit.colId,Site.inSubNavPackEdit.colIdActivedArr)<0){Site.inSubNavPackEdit.colIdActivedArr.push(Site.inSubNavPackEdit.colId)}c();u()}});function c(){g(".packOuterPanel").draggable("destroy").draggable({containment:"body",distance:3,cursor:"move",axis:"x,y",scroll:false,start:function(){n.top.$("#funPanelOverLay").show();n.top.$("#colorpanel").remove();n.top.$(".faiColorPicker").remove()},stop:function(){n.top.$("#funPanelOverLay").hide();var A=g(this).offset().left,z=g(this).offset().top,y=n.top.$("#g_main").offset().top;if(z<y){z=y;g(this).offset({top:y})}}}).delegate("input,textarea,.colModuleNameText","click.input",function(y){y.stopPropagation()}).off("click.funPanel").on("click.funPanel",function(){var y=g(this).find(":focus");if(y.length<1||y.hasClass("colModuleName")){return}g(this).find(":focus").blur()})}function u(){g(".funOuterPanel").resizable("destroy").resizable({handles:"e,w",minWidth:350,maxWidth:640,create:function(y,z){g(this).find(".ui-resizable-handle").addClass("funPanelResizeHandle")}})}t.commData.addModuleList=[];var r=false;l.refreshAddModuleList=function(){if(!r){return}q.addModuleList=s()};Vue.component("packModuleAddCompon",{data:function(){r=true;q.addModuleList=s();var y=Site.inSubNavPackEdit.subNavPackObj["col"+Site.inSubNavPackEdit.colId],D=y.bgData,C={deleteFun:function A(F){var E=Site.inSubNavPackEdit.subNavPackObj["col"+Site.inSubNavPackEdit.colId].bgData;E.pi="";E.ph="";E.ps=0;E.pp=-1;B.imgId=E.pi;B.imgPath=E.ph;B.picScale=E.ps;B.picPos=E.pp;m(E)}},z=[{value:0,label:"平铺",type:"Tiling",hidden:false},{value:1,label:"不平铺",type:"not-tile",hidden:false},{value:2,label:"拉伸",type:"stretch",hidden:false}],B;if(y.bgc&&typeof D.t=="undefined"){D.t=2;D.c=y.bgc}D.t=D.t||0;B={imgPath:D.ph,imgId:D.pi,picScale:D.ps,repeat:D.pp,color:D.c?D.c:"#fff",bgRepeatLists:z,uploadData:{title:"添加图片",maxSize:n.top._internal?3:1,type:["jpg","jpeg","gif","png","bmp"],from:"bg",entry:"webBg"},showEffect:false};return{commData:q,setStyleData:y,bgData:D,bgOpts:B}},computed:{totalModules:function(){return this.commData.addModuleList},setBgUseShortHeight:function(){return this.bgOpts.type==0||!this.bgData.ph}},activated:function(){q.addModuleList=s()},template:"<div class='panelInnerContent panelInnerContent_addModule'><div class='moduleFieldset' v-for='fieldset in totalModules' ><div class='legend'><span class='legendText'>{{fieldset.groupName}}</span></div><transition name='component-addmodule' mode='out-in'><div class='moduleViewList'><div class='moduleAloneArea' :class='\"moduleArea_\" + module.keyword' @click='addModuleClick(module.keyword)' v-for='module in fieldset.list'><div class='moduleAloneIcon'></div><div class='moduleAloneText'>{{module.name}}</div></div></div></transition></div><div class='setStyle'><div class='legend'><span class='legendText'>设置样式</span></div><div class='item'><div class='itemTit'>通栏：</div><switch-component ref='fullMeasureType' style='margin-left:16px' v-model='setStyleData.ifm' v-undo.switchBtn @on-change='fullMeasureChange'></switch-component></div><div :class='{ \"f-item-bg-short-height\" : setBgUseShortHeight }' class='f-item-bg item'><span class='itemTit' slot='title'>背景：</span><span slot='radioswitch'><radio-group-component ref='bgDataType' class='fk-bg-radio-wrap' v-model='bgData.t' v-undo:t.radio='bgData' @on-change='bgTypeChange'><radio-component :label='0' >默认</radio-component><radio-component :label='2' >自定义</radio-component></radio-group-component></span><background-component slot='itemsetting' ref='panelBg' :data='bgOpts'  v-show='bgData.t==2' v-undo.bg @img-change='bgImgChange' @bg-scale-change='bgScaleChange' @bg-repeat-change='bgTilingChange' @bg-effect-change='bgEffectChange'@bg-color-change='bgColorChange'></background-component></div></div></div>",methods:{fullMeasureChange:function(J){this.setStyleData.ifm=!!J;var I=Site.inSubNavPackEdit,A=I.colId,O=g("#fk-subNavPack"+A),G=g("#fk-subNavPack"+A).find(".container"),y=g("#fk-subNavPack"+A).find(".editSubNavPack"),H=n.top.$("#nav"+A),D=n.top.$("#webContainer"),E,M,P=n.top.$("#web").width(),F,B,N,C,L,z,K;if(D.length<1){return}F=D.width();B=D.offset().left;if(J){I.subNavPackBindResizable(O,"s");I.subNavPackObj["col"+A].ifm=true;C="100%";if(document.getElementById("g_main").scrollHeight>document.getElementById("g_main").clientHeight){C="99%"}O.css({width:""+C+"",left:""});G.css("margin-left",B+"px");G.width(F);y.css("left",B+10+"px")}else{E=F;M=O.data("packSizeData");N=F+B;I.subNavPackBindResizable(O,"s,w,e");I.subNavPackObj["col"+A].ifm=false;if(M.lt==1){subPackLeft=M.nl+H.offset().left;subPackLeft=subPackLeft<0?0:subPackLeft;O.css("left",Math.floor(subPackLeft)+"px");if(B>subPackLeft){G.css("margin-left",(B-subPackLeft)+"px")}else{G.css("margin-left",0)}if(subPackLeft+M.w>P){O.width(P-subPackLeft)}else{O.width(M.w)}L=M.w+subPackLeft;minRight=Math.min(L,N);maxLeft=Math.max(B,subPackLeft);E=minRight-maxLeft;G.width(E)}else{O.css("left",B+"px");G.css("margin-left",0);E=F;O.width(E);G.width(E);M.lt=0;O.data("packSizeData",M)}y.css("left","")}Site.logDog(200256,12);Site.styleChanged()},addModuleClick:function(y){e(y)},bgScaleChange:function(y){this.bgData.ps=y;if(y==0){this.bgData.pp=3}else{if(y==1){this.bgData.pp=0}}this.bgOpts.picPos=this.bgData.pp;m(this.bgData)},bgTilingChange:function(y){this.bgData.pp=y;m(this.bgData)},bgEffectChange:function(y){},bgTypeChange:function(y){this.bgData.t=y;m(this.bgData);y==2&&Site.logDog(200256,22)},bgColorChange:function(B,z){var A=this;y(B);function y(D){var F=A.bgData,E=n.top.Site.inSubNavPackEdit.colId,C=n.top.$("#fk-subNavPack"+E);F.c=D;A.bgOpts.color=D;(D=="transparent"||/rgba\((\d{1,3},\s*){1,3}0\)/.test(D))?C.addClass("fk-subNavPack-no-shadow"):C.removeClass("fk-subNavPack-no-shadow");m(F)}},bgImgChange:function(y){var A=this;if(y){var B=g.parseJSON(y),z=B.data[0]||{};A.bgData.ph=z.filePath;A.bgData.pi=z.fileId;A.bgOpts.imgPath=z.filePath;A.bgOpts.imgId=z.fileId;if(A.bgData.pp==-1||typeof A.bgData.pp=="undefined"){A.bgData.ps=0;A.bgData.pp=3;A.bgOpts.picScale=0;A.bgOpts.picPos=3}m(A.bgData)}}},mounted:function(){h();this.$nextTick(function(){t.commFun.bindContentScrollBar(".panelInnerContent_addModule")})}});function m(z){var A="",y=n.top.Site.inSubNavPackEdit.colId;A=n.top.Site.buildNavV2BgStyle(z);n.top.$("#fk-subNavPack"+y).css({background:A});Site.showRepeatTip(z.pp);Site.styleChanged()}var s=function(){var y=[],z=[];y.push({name:"文本",keyword:"simpleText",show:true});y.push({name:"图片",keyword:"floatImg",show:true});y.push({name:"按钮",keyword:"floatBtn",show:true});z.push({groupName:"添加模块",list:y});return z};function e(N){if(n.top._subNavPackEdit){n.top._appendArea="fk-subNavPack"+Site.inSubNavPackEdit.colId+" .container"}var D=n.top._colId;var E=n.top._extId;var F=n.top._funPanelOption?n.top._funPanelOption.sysIndex:"";var H=n.top._funPanelOption?n.top._funPanelOption.schemeCust:"";var L=undefined;var B=[];if(N=="floatImg"){Site.logDog(200256,9);n.ing("正在保存……",false);g.ajax({type:"post",url:"ajax/module_h.jsp?cmd=add&subNavPackModule=true&style=79&colId="+D+"&extId="+E,data:"name="+n.encodeUrl("图片"),error:function(){n.ing("服务繁忙，请稍候重试",false)},success:function(R){var Q=g.parseJSON(R);if(n.successHandle(R,"","系统错误","",3,1)){Site.addNewModule(Q.id,Q.div,null,null,{returnModuledata:Q.moduleData});B.push(Q.id);Site.inSubNavPackEdit.addModuleSave(B,Site.inSubNavPackEdit.colId)}}})}else{if(N=="simpleText"){Site.logDog(200256,8);n.ing("正在保存……",false);g.ajax({type:"post",url:"ajax/module_h.jsp?cmd=add&subNavPackModule=true&style=86&colId="+D+"&extId="+E,data:"name="+n.encodeUrl("文本"),error:function(){n.ing("服务繁忙，请稍候重试",false)},success:function(R){var Q=g.parseJSON(R);if(n.successHandle(R,"","系统错误","",3,1)){Site.addNewModule(Q.id,Q.div,null,null,{returnModuledata:Q.moduleData});if(g("#module"+Q.id).length>0){g("#module"+Q.id).data("breakWord",true).find(".fk-editor").addClass("fk-editor-break-word");g("#module"+Q.id).data("fixTextTrim",true)}B.push(Q.id);Site.inSubNavPackEdit.addModuleSave(B,Site.inSubNavPackEdit.colId)}}})}else{if(N=="floatBtn"){Site.logDog(200256,10);var I="ajax/module_h.jsp?cmd=add&subNavPackModule=true&style=81&colId="+D+"&extId="+E+"&flag1=true";var A=[],K={};var M={bns:101,bs:{v:"按钮",hn:"",h:"",hi:""}};A.push("&prop1="+n.encodeUrl(g.toJSON(M)));var y;if(!n.top._isTemplateVersion2){A.push("&prop2=0");var J="#b7031c";var P=G(J,1);P=O(P,0.5);y={imc:0,cc:J,utc:0,gcc:P}}else{var C=n.top._majorColorData;var z=G(C,1);z=O(z,0.5);y={imc:0,cc:C,utc:1,gcc:z}}A.push("&prop3="+n.encodeUrl(g.toJSON(y)));A.push("&prop4=0");K.w=163;K.h=52;K.cb={};K.cb.y=1;K.e=1;K.d={};K.d.y=1;K.i={};K.i.t=0;K.i.b=0;K.i.l=0;K.i.r=0;K.i.y=0;K.cl={};K.cl.y=1;K.cl.ls=12;K.cl.f="微软雅黑";K.vfb={};A.push("&pattern="+n.encodeUrl(g.toJSON(K)));A.push("&name="+n.encodeUrl("按钮"));function G(R,Q){return"rgba("+parseInt("0x"+R.slice(1,3))+","+parseInt("0x"+R.slice(3,5))+","+parseInt("0x"+R.slice(5,7))+","+Q+")"}function O(R,U){if(R.indexOf("#")!==-1){R=G(R,1)}var T=R.split(",");var Q=[];Q.push(T[0].substr(5));Q.push(T[1].substr(0));Q.push(T[2].substr(0));Q.push(T[3].substr(0,T[3].length-1));for(var S=0;S<3;S++){Q[S]=Math.floor((255-parseInt(Q[S]))*U+parseInt(Q[S]))}return"rgba("+Q[0]+","+Q[1]+","+Q[2]+","+Q[3]+")"}n.ing("正在保存……",false);g.ajax({type:"post",url:I,data:A.join(""),error:function(){n.ing("服务繁忙，请稍候重试",false)},success:function(R){var Q=g.parseJSON(R);if(n.successHandle(R,"","系统错误","",3,1)){if(top.$("link[href='"+Q.styleLink+"']").length==0){top.$('<link type="text/css" href="'+Q.styleLink+'" rel="stylesheet">').appendTo(top.$("head"))}Site.addNewModule(Q.id,Q.div,null,null,{returnModuledata:Q.moduleData});g("#module"+Q.id).css({width:"162px",height:"52px"});B.push(Q.id);Site.inSubNavPackEdit.addModuleSave(B,Site.inSubNavPackEdit.colId)}}})}}}Site.setRefreshInfo("moduleEdit",true)}function d(z){var y=[];y.push(z);Site.inSubNavPackEdit.addModuleSave(y,Site.inSubNavPackEdit.colId)}function h(){var z=n.top.$("#fk-packPanel .panelInnerContent_addModule"),y=z.find(".moduleAloneArea"),B=y.filter(".moduleArea_fullmeasure"),A=".J_moduleZone:visible, .column:visible, .fullmeasureContent:visible, .J_packContent:visible, .formTabButtonList:visible, .formTabButtonYList:visible";if(n.top._subNavPackEdit){A=".J_subNavPack:visible"}y.draggable("destroy").draggable({helper:function(){return"<div id='panelInnerContentDrag' class='panelInnerContent panelInnerContentDrag'><div class='"+g(this).attr("class")+" moduleAloneAreaDrag'><div class='moduleAloneIcon'></div><div class='moduleAloneText'>"+g(this).find(".moduleAloneText").text()+"</div></div></div>"},appendTo:"#g_main",cursor:"move",zIndex:9999,opacity:0.6,connectToSortable:A,start:function(C,D){n.top.dragToAddModule=true},stop:function(C,D){g(this).children().eq(0).trigger("click");Site.sortableHelper.replaceAddModuleBtn(D);if(n.top._subNavPackEdit){n.top.$(".J_subNavPack").find("div.moduleAloneArea").remove()}n.top.dragToAddModule=false}})}function i(C){if(!C.show){return}n.top.$("#fk-packPanelArea"+n.top.Site.inSubNavPackEdit.colId).find(".moduleId"+C.id).find(".historyModuleViewSwitch").click();if(!n.top.$(".packOuterPanel").attr("panelopen")){return}var B=g("<div></div>");n.top.$("body").append(B);B.css({border:"2px solid #ff4400",position:"absolute",zIndex:"9999",top:C.top,left:C.left,height:C.height+"px",width:C.width+"px"});var A=g("#fk-packPanelArea"+n.top.Site.inSubNavPackEdit.colId),y=A.find(".historyModuleContainer"),z=0;y.mCustomScrollbar("scrollTo",".moduleId"+C.id,{scrollInertia:300});if(y.find(".mCSB_scrollTools_vertical").is(":visible")){z=400}setTimeout(function(){Vue.nextTick(function(){var D=A.find(".moduleId"+C.id);if(D.length<1){D=A.find(".historyModuleListWrap").first()}B.animate({top:D.offset().top+"px",left:D.offset().left+"px",width:D.outerWidth()+"px",height:D.outerHeight()+"px"},850,function(){B.remove()})})},z)}Site.goToPackPanel=function(z,A){if(!t||!t.packPanelDef||!t.packPanelDef.module){return}for(var y=0;y<t.packPanelDef.module.length;y++){t.packPanelDef.module[y].tab.isActive=false}t.packPanelDef.module[z].tab.isActive=true;if(typeof A=="function"){Vue.nextTick(function(){A()})}};Site.bindGobalEvent("site_subNavPack_hideModule",function(z,y){if(!y.show){return}Site.goToPackPanel(1,function(){setTimeout(function(){i(y)},300)})});var j=q.subNavPackModule;l.refreshHisModuleListData=function(){k(j)};l.setHisModuleListData=function(){historyModuleList=[]};function k(y){g.ajax({type:"post",url:Site.genAjaxUrl("col_h.jsp"),data:"cmd=getColSubNavPackModule&id="+top.Site.inSubNavPackEdit.colId,async:false,error:function(){n.ing("系统繁忙，请稍候重试",false)},success:function(z){var A=g.parseJSON(z);v(A);A=p(A);b(A);y.historyModules=A}})}function v(A){var z,B=n.top.$("#fk-subNavPack"+top.Site.inSubNavPackEdit.colId);for(var y=0;y<A.length;y++){A[y].orName=A[y].name;z=B.find("#module"+A[y].id);A[y].s=!!z.is(":visible")}}function b(y){y.map(function(D,B){var C=D.id,z,A=n.top.$("#module"+C);if(D.name=="文本"){if(A.length>0&&A.find(".fkEditor-wrap .editTip").length<1){D.name=A.text().trim()}}else{if(D.name=="图片"){z=A.find("#float_img_"+C);if(z.length>0){D.name=z.attr("alt")||"图片"}}else{if(D.name=="按钮"){z=A.find("#module"+C+"FlBtn");if(z.length>0){D.name=z.text().trim()}}}}return D})}function p(B){var A=[],y=[];for(var z=0;z<B.length;z++){if(B[z].s){A.push(B[z])}else{y.push(B[z])}}B=A.concat(y);return B}function f(A){var C=A.id,B=A.style,z=A.name,y=A.orName;if(g.trim(z)==""||z==y){A.title=y;return}if(z!=y){g.ajax({type:"post",url:Site.genAjaxUrl("module_h.jsp"),data:"cmd=setBack&id="+C+"&name="+n.encodeUrl(z)+"&colId="+n.top._colId,error:function(){n.ing("系统繁忙，请稍候重试",false)},success:function(D){var E=g.parseJSON(D);if(E.success){Site.refreshModule(E.id,E.div,z)}}})}}function o(z){var y=false;g.ajax({type:"post",url:Site.genAjaxUrl("module_h.jsp"),data:"cmd=del&id="+z,async:false,error:function(){n.ing("系统繁忙，请稍候重试",false)},success:function(A){var B=g.parseJSON(A);if(B.success){n.top.$("#module"+z).remove();y=true}}});return y}Vue.component("historyModuleCompon",{data:function(){return{subNavPackModule:j}},beforeCreate:function(){k(j)},template:"<div class='historyModuleContainer'><div class='historyModuleListWrap'><ul class='historyModuleStaUl topModuleList'><li is='moduleLiCompon' class='topModuleLi' v-for='model in subNavPackModule.historyModules' :model='model' :modellist='subNavPackModule.historyModules'></li></ul></div></div>"});Vue.component("moduleLiCompon",{props:["model","modellist"],data:function(){return{editName:false,}},template:"<div class='historyModuleStatcLine' :class='[\"moduleId\" + model.id, \"moduleStyle\" + model.style]' title='双击修改模块名称' @dblclick.stop='toggleEdit($event)'><span class='historyModuleLineLeft' @click='showThisModule(model)'><span class='historyModuleNameText' :class='{showModuleNameText:model.s}' v-if='!editName'>{{model.name? model.name: '&nbsp;'}}</span><input maxlength='50' class='historyModuleName' v-if='editName' v-model='model.name' @blur='editNameBlur'/></span><span class='historyModuleLineRight'><div class='historyModuleViewSwitch' :class='{historyModuleViewBlock:model.s}' :title='model.iconTitle' @click='moduleViewSwitchSwitch'></div><div class='historyModuleDel' title='删除模块' @click='delModelClick'></div></span></div>",methods:{toggleEdit:function(y){this.editName=!this.editName;if(this.editName){Vue.nextTick(function(){g(".historyModuleName").focus()})}},editNameBlur:function(){this.editName=false;f(this.model)},moduleViewSwitchSwitch:function(){Site.styleChanged();this.model.s=!this.model.s;historyModuleList=p(this.modellist);for(var y=0;y<historyModuleList.length;y++){this.modellist.splice(y,1,historyModuleList[y])}if(this.model.s){n.top.$("#module"+this.model.id).show()}else{n.top.$("#module"+this.model.id).hide()}},delModelClick:function(){Site.styleChanged();var y=o(this.model.id);if(y){for(var z=0;z<this.modellist.length;z++){if(this.modellist[z].id==this.model.id){this.modellist.splice(z,1);return}}}},showThisModule:function(y){if(!y){return}Site.triggerGobalEvent("showFindModuleDiv",y.id)}},mounted:function(){g("#fk-packPanelArea .historyModuleLineLeft, .historyModuleStatcList").focusin(function(y){y.stopPropagation()});t.commFun.bindContentScrollBar(".historyModuleContainer")}})})($,Fai,Fai.top.v_packPanel||(v_packPanel={}));